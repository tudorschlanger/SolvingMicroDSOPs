<!DOCTYPE html> 
<html lang="en" xml:lang="en" > 
<head> <title>Solution Methods for Microeconomic
Dynamic Stochastic Optimization Problems</title> 
<meta  charset="utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="viewport" content="width=device-width,initial-scale=1" /> 
<link rel="stylesheet" type="text/css" href="SolvingMicroDSOPs.css" /> 
<meta name="src" content="SolvingMicroDSOPs.tex"> 
</head><body 
>
  <title><span 
class="ecrm-1728">Solution Methods for Microeconomic</span>
<span 
class="ecrm-1728">Dynamic Stochastic Optimization Problems</span></title> 
<meta  charset="utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="viewport" content="width=device-width,initial-scale=1" /> 
<link rel="stylesheet" type="text/css" href="SolvingMicroDSOPs.css" /> 
<meta name="src" content="SolvingMicroDSOPs.tex"> 
</head><body 
>
  <div class="maketitle">
<h2 class="titleHead"><span 
class="ecbx-1728">Solution Methods for Microeconomic</span><br />
<span 
class="ecbx-1728">Dynamic Stochastic Optimization Problems</span></h2>
<div class="date" >June 4, 2024</div>
¬†
 <div class="author" >Christopher D. Carroll<sup class="textsuperscript">1</sup></div>
<br />
</div>
<!--l. 23--><p class="noindent" >Note: The GitHub repo   <a 
href="https://github.com/llorracc/SolvingMicroDSOPs" >SolvingMicroDSOPs</a> associated with this document contains python code that
produces all results, from scratch, except for the last section on indirect inference. The numerical results have
been conÔ¨Årmed by showing that the answers that the raw python produces correspond to the answers
produced by tools available in the  <a 
href="https://econ-ark.org" >Econ-ARK</a> toolkit, more speciÔ¨Åcally those in the   <a 
href="https://github.com/econ-ark/HARK" >HARK</a> which
has full  <a 
href="https://docs.econ-ark.org" >documentation</a>. The MSM results at the end have have been superseded by tools in the
<a 
href="https://github.com/llorracc/EstimatingMicroDSOPs" >EstimatingMicroDSOPs repo</a>.
<!--l. 27--><p class="indent" >  <a 
 id="abstract"></a> <section role="doc-abstract" class="abstract"> 

<!--l. 28--><p class="noindent" > <br 
class="newline" />_____________________________________________________________________________________
<!--l. 28--><p class="noindent" >Abstract<br 
class="newline" />   These notes describe tools for solving microeconomic dynamic stochastic optimization problems,
and show how to use those tools for eÔ¨Éciently estimating a standard life cycle consumption/saving
model using microeconomic data. No attempt is made at a systematic overview of the many possible
technical choices; instead, I present a speciÔ¨Åc set of methods that have proven useful in my own work
(and explain why other popular methods, such as value function iteration, are a bad idea).
Paired with these notes is Python code that solves the problems described in the text.
<br 
class="newline" />
        <blockquote class="quote">
                     <dl class="list2"><dt class="list">
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†Keywords¬†</dt><dd 
class="list">
                 <!--l. 30--><p class="noindent" >Dynamic  Stochastic  Optimization,  Method  of  Simulated
                   Moments, Structural Estimation, Indirect Inference
                   </dd><dt class="list">
¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†JEL codes¬†</dt><dd 
class="list">
                                                                                     
                                                                                     
              <!--l. 30--><p class="noindent" >E21, F41
              <!--l. 30--><p class="noindent" > <a 
href="https://econ-ark.org" > <img 
src=".resources/econ-ark/PoweredByEconARK.png" alt="pict"  
 width="105.39374pt" > </a></dd></dl>
      </blockquote>
</section>
<div class="center" 
>
<!--l. 34--><p class="noindent" >
<table  
cellpadding="0" border="0"  
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">¬†¬†¬†¬†PDF:¬† </td><td  
class="tabbing"></td><td  
class="tabbing"> <a 
href="https://github.com/llorracc/SolvingMicroDSOPs/blob/master/SolvingMicroDSOPs.pdf" >https://github.com/llorracc/SolvingMicroDSOPs/blob/master/SolvingMicroDSOPs.pdf</a>
</td></tr></table>
<!--l. 36--><p class="noindent" ><table  
cellpadding="0" border="0"  
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">¬†Slides:¬† </td><td  
class="tabbing"></td><td  
class="tabbing"> <a 
href="https://github.com/llorracc/SolvingMicroDSOPs/blob/master/SolvingMicroDSOPs-Slides.pdf" >https://github.com/llorracc/SolvingMicroDSOPs/blob/master/SolvingMicroDSOPs-Slides.pdf</a></td></tr></table>
<!--l. 37--><p class="noindent" >                               <table  
cellpadding="0" border="0"  
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">¬†¬†¬†¬†Web:¬† </td><td  
class="tabbing"></td><td  
class="tabbing"> <a 
href="https://llorracc.github.io/SolvingMicroDSOPs" >https://llorracc.github.io/SolvingMicroDSOPs</a></td></tr></table>
<!--l. 38--><p class="noindent" >             <table  
cellpadding="0" border="0"  
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">¬†¬†¬†Code:¬† </td><td  
class="tabbing"></td><td  
class="tabbing"> <a 
href="https://github.com/llorracc/SolvingMicroDSOPs/tree/master/Code" >https://github.com/llorracc/SolvingMicroDSOPs/tree/master/Code</a></td></tr></table>
<!--l. 39--><p class="noindent" >                              <table  
cellpadding="0" border="0"  
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">Archive:¬† </td><td  
class="tabbing"></td><td  
class="tabbing"> <a 
href="https://github.com/llorracc/SolvingMicroDSOPs" >https://github.com/llorracc/SolvingMicroDSOPs</a></td></tr></table>
<!--l. 40--><p class="noindent" >     <table  
cellpadding="0" border="0"  
class="tabbing"><tr  
style="vertical-align:baseline;" class="tabbing"><td style="width:75;" 
class="tabbing">¬†¬†¬†¬†¬†¬†¬†¬†¬† </td><td  
class="tabbing"></td><td  
class="tabbing">(Contains LaTeX code for this document and software producing Ô¨Ågures and results)</td></tr></table>
<!--l. 42--><p class="noindent" >
</div>
<!--l. 49--><p class="noindent" ><span class="footnote-mark"><sup class="textsuperscript"></sup></span>
<!--l. 51--><p class="indent" >  <span class="footnote-mark"><sup class="textsuperscript"></sup></span>
      <sup class="textsuperscript"></sup>
<!--l. 48--><p class="noindent" ><sup class="textsuperscript">1</sup>Carroll: Department of Economics, Johns Hopkins University, Baltimore, MD,   <a 
href="mailto:ccarroll@jhu.edu" >ccarroll@jhu.edu</a>¬†¬†¬†¬†
      <sup class="textsuperscript"></sup>The notes were originally written for my Advanced Topics in Macroeconomic Theory class at
Johns Hopkins University; instructors elsewhere are welcome to use them for teaching purposes. Relative
to earlier drafts, this version incorporates several improvements related to new results in the paper
<a 
href="http://econ-ark.github.io/BufferStockTheory" >‚ÄúTheoretical Foundations of BuÔ¨Äer Stock Saving‚Äù</a> (especially tools for approximating the consumption
and value functions). Like the last major draft, it also builds on material in ‚ÄúThe Method of Endogenous
Gridpoints  for  Solving  Dynamic  Stochastic  Optimization  Problems‚Äù   published  in  Economics
Letters,  available  at  <a 
href="http://www.econ2.jhu.edu/people/ccarroll/EndogenousArchive.zip" class="url" >http://www.econ2.jhu.edu/people/ccarroll/EndogenousArchive.zip</a>,  and
by  including  sample  code  for  a  method  of  simulated  moments  estimation  of  the  life  cycle
model  a  la  <a 
href="#XgpLifecycle">Gourinchas  and  Parker</a>¬†(<a 
href="#XgpLifecycle">2002</a>)  and  Cagetti¬†(<a 
href="#XcagettiWprofiles">2003</a>).  Background  derivations,  notation,
and   related   subjects   are   treated   in   my   class   notes   for   Ô¨Årst   year   macro,   available   at
<a 
href="http://www.econ2.jhu.edu/people/ccarroll/public/lecturenotes/consumption" class="url" >http://www.econ2.jhu.edu/people/ccarroll/public/lecturenotes/consumption</a>.  I  am  grateful
to several generations of graduate students in helping me to reÔ¨Åne these notes, to Marc Chan for help
in updating the text and software to be consistent with <a 
href="#XcarrollEGM">Carroll</a>¬†(<a 
href="#XcarrollEGM">2006</a>), to Kiichi Tokuoka for drafting
the section on structural estimation, to Damiano Sandri for exceptionally insightful help in revising and
updating the method of simulated moments estimation section, and to Weifeng Wu and Metin Uyanik
for revising to be consistent with the ‚Äòmethod of moderation‚Äô and other improvements. All errors are
my own. This document can be cited as <a 
href="#XSolvingMicroDSOPs">Carroll</a>¬†(<a 
href="#XSolvingMicroDSOPs">2023a</a>) in the references.
                                                                                     
                                                                                     
<!--l. 59--><p class="indent" >
                                                                                     
                                                                                     
<!--l. 6--><p class="indent" >  <a 
 id="introduction"></a>
  <h3 class="sectionHead"><span class="titlemark">1  </span> <a 
 id="x1-10001"></a>Introduction</h3>                                                                      {sec:introduction}
<!--l. 9--><p class="noindent" >These lecture notes provide a gentle introduction to a particular set of solution tools for the
canonical consumption-saving/portfolio allocation problem. SpeciÔ¨Åcally, the notes describe and
solve optimization problems for a consumer facing uninsurable idiosyncratic risk to nonÔ¨Ånancial
income (e.g., labor or transfer income), Ô¨Årst without and then with optimal portfolio
choice,<span class="footnote-mark"><a 
href="SolvingMicroDSOPs2.html#fn1x0"><sup class="textsuperscript"><span 
class="ecrm-0600">1</span></sup></a></span><a 
 id="x1-1001f1"></a>  
with detailed intuitive discussion of various mathematical and computational techniques that,
together, speed the solution by many orders of magnitude. The problem is solved with and
without liquidity constraints, and the inÔ¨Ånite horizon solution is obtained as the limit of the
Ô¨Ånite horizon solution. After the basic consumption/saving problem with a deterministic
interest rate is described and solved, an extension with portfolio choice between a riskless and
a risky asset is also solved. Finally, a simple example shows how to use these methods (via the
statistical ‚Äòmethod of simulated moments‚Äô (MSM for short)) to estimate structural parameters
like the coeÔ¨Écient of relative risk aversion (a la Gourinchas and Parker¬†(<a 
href="#XgpLifecycle">2002</a>) and
Cagetti¬†(<a 
href="#XcagettiWprofiles">2003</a>)).
<!--l. 6--><p class="indent" >  <a 
 id="the-problem"></a>
  <h3 class="sectionHead"><span class="titlemark">2  </span> <a 
 id="x1-20002"></a>The Problem</h3>                                                                      {sec:the-problem}
<!--l. 9--><p class="noindent" >The usual analysis of dynamic stochastic programming problems packs a great many events
(intertemporal choice, stochastic shocks, intertemporal returns, income growth, the taking of
expectations, time discounting, and more) into a complex decision in which the agent
makes an optimal choice simultaneously taking all these elements into account.
For the dissection here, we will be careful to break down everything that happens
into distinct operations so that each element can be scrutinized and understood in
isolation.
<!--l. 11--><p class="indent" >  We are interested in the behavior a consumer who begins period <img 
src="SolvingMicroDSOPs0x.svg" alt="</span>t  " class="math";align="absmiddle"> with a certain amount
of ‚Äòcapital‚Äô <img 
src="SolvingMicroDSOPs1x.svg" alt="</span></span></span></span>kkk t  " class="math";align="absmiddle">, which is immediately rewarded by a return factor <img 
src="SolvingMicroDSOPs2x.svg" alt="</span></span>Rt  " class="math";align="absmiddle"> with the proceeds
deposited in a bank balance:
  <table 
class="equation"><tr><td>
                                                                                     
                                                                                     
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs3x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>bbbt = kkktRt.
" class="math-display" ><a 
 id="x1-2001r1"></a></div>
  </td><td class="equation-label">(1)</td></tr></table>
<!--l. 14--><p class="nopar" >
<!--l. 16--><p class="indent" >  Simultaneously with the realization of the capital return, the consumer also receives
noncapital income <img 
src="SolvingMicroDSOPs4x.svg" alt="</span></span></span></span>yyyt  " class="math";align="absmiddle">, which is determined by multiplying the consumer‚Äôs ‚Äòpermanent
income‚Äô <img 
src="SolvingMicroDSOPs5x.svg" alt="</span></span></span></span>pppt  " class="math";align="absmiddle"> by a transitory shock <img 
src="SolvingMicroDSOPs6x.svg" alt="</span></span>ùúÉt  " class="math";align="absmiddle">:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs7x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span>yyy t = ppptùúÉt
" class="math-display" ><a 
 id="x1-2002r2"></a></div>
  </td><td class="equation-label">(2)</td></tr></table>
<!--l. 19--><p class="nopar" >whose whose expectation is 1 (that is, before realization of the transitory shock, the
consumer‚Äôs expectation is that actual income will on average be equal to permanent income
<img 
src="SolvingMicroDSOPs8x.svg" alt="</span></span></span></span>pppt " class="math";align="absmiddle">).
<!--l. 22--><p class="indent" >  The combination of bank balances <img 
src="SolvingMicroDSOPs9x.svg" alt="</span></span></span>bbb  " class="math";align="absmiddle"> and income <img 
src="SolvingMicroDSOPs10x.svg" alt="</span></span></span>yyy  " class="math";align="absmiddle"> deÔ¨Åne‚Äôs the consumer‚Äôs ‚Äòmarket
resources‚Äô (sometimes called ‚Äòcash-on-hand,‚Äô following¬†<a 
href="#XdeatonUnderstandingC">Deaton</a>¬†(<a 
href="#XdeatonUnderstandingC">1992</a>)):
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs11x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>mmmt =  bbbt + yyy t,
" class="math-display" ><a 
 id="x1-2003r3"></a></div>
  </td><td class="equation-label">(3)</td></tr></table>
<!--l. 25--><p class="nopar" >available to be spent on consumption <img 
src="SolvingMicroDSOPs12x.svg" alt="</span></span></span></span>ccct  " class="math";align="absmiddle"> for a consumer subject to a liquidity constraint that
requires <img 
src="SolvingMicroDSOPs13x.svg" alt="</span></span></span></span></span></span></span>ccc ‚â§ mmm  " class="math";align="absmiddle"> (though we are not imposing such a constraint yet - see subsection¬†<a 
href="#x1-170006.7">6.7<!--tex4ht:ref: subsec:LiqConstrSelfImposed --></a>).
Finally we deÔ¨Åne
                                                                                     
                                                                                     
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs14x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>aaa  = mmm   ‚àí ccc
  t    t    t
" class="math-display" ><a 
 id="x1-2004r4"></a></div>
  </td><td class="equation-label">(4)</td></tr></table>
<!--l. 29--><p class="nopar" >mnemnoically as ‚Äòassets-after-all-actions-are-accomplished.‚Äô
<!--l. 32--><p class="indent" >  The consumer‚Äôs goal is to maximize discounted utility from consumption over the rest of a
lifetime ending at date <img 
src="SolvingMicroDSOPs15x.svg" alt="</span>T  " class="math";align="absmiddle">:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs16x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>        [              ]
         ‚àëT‚àít
max  ùîºt      Œ≤nu (ccct+n ) .
          n=0
" class="math-display" ><a 
 id="x1-2005r5"></a></div>
  </td><td class="equation-label">(5)</td></tr></table>
<!--l. 3--><p class="nopar" >Income evolves according to:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs17x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>            pppt+1 = ùí¢t+1pppt  ‚Äì permanent  labor income  dynamics
                  2    2
log  ùúÉt+n ‚àº  ùí© (‚àí œÉùúÉ‚àï2,œÉùúÉ)  ‚Äì lognormal  transitory shocks ‚àÄ n &#x003E; 0.
" class="math-display" ><a 
 id="x1-2006r6"></a></div>
  </td><td class="equation-label">(6)</td></tr></table>
<!--l. 4--><p class="nopar" >
                                                                                     
                                                                                     
<!--l. 49--><p class="indent" >  Equation (<a 
href="#x1-2006r6">6<!--tex4ht:ref: eq:permincgrow --></a>) indicates that we are allowing for a predictable average proÔ¨Åle of income
growth over the lifetime <img 
src="SolvingMicroDSOPs18x.svg" alt="</span></span></span>{ùí¢ }T0   " class="math";align="absmiddle"> (to capture typical career wage paths, pension arrangements,
etc).<span class="footnote-mark"><a 
href="SolvingMicroDSOPs3.html#fn2x0"><sup class="textsuperscript"><span 
class="ecrm-0600">2</span></sup></a></span><a 
 id="x1-2007f2"></a>  
Finally, the utility function is of the Constant Relative Risk Aversion (CRRA), form,
<img 
src="SolvingMicroDSOPs19x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>         1‚àí œÅ
u(‚àô ) = ‚àô   ‚àï(1 ‚àí œÅ )  " class="math";align="absmiddle">.
<!--l. 51--><p class="indent" >  It is well known that this problem can be rewritten in recursive (Bellman) form:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs20x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>v (mmm ,ppp ) = max   u(ccc) + Œ≤ ùîº [v  (mmm    ,ppp   )]
 t   t  t     ccc             t t+1   t+1   t+1
" class="math-display" ><a 
 id="x1-2009r7"></a></div>
  </td><td class="equation-label">(7)</td></tr></table>
<!--l. 3--><p class="nopar" >subject to the Dynamic Budget Constraint (DBC) implicitly deÔ¨Åned by equations¬†(<a 
href="#x1-2001r1">1<!--tex4ht:ref: eq:bLvl --></a>)-(<a 
href="#x1-2003r3">3<!--tex4ht:ref: eq:mLvl --></a>) and
to the transition equation that deÔ¨Ånes next period‚Äôs initial capital as this period‚Äôs
end-of-period assets:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs21x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span>kkk   =  aaa .
 t+1    t
" class="math-display" ><a 
 id="x1-2010r8"></a></div>
  </td><td class="equation-label">(8)</td></tr></table>
<!--l. 61--><p class="nopar" >
                                                                                     
                                                                                     
<!--l. 5--><p class="indent" >  <a 
 id="normalization"></a>
  <h3 class="sectionHead"><span class="titlemark">3  </span> <a 
 id="x1-30003"></a>Normalization</h3>                                                                     {sec:normalization}
<!--l. 8--><p class="noindent" >The single most powerful method for speeding the solution of such models is to redeÔ¨Åne the
problem in a way that reduces the number of state variables (if at all possible). In the
consumption context, the obvious idea is to see whether the problem can be rewritten in terms
of the ratio of various variables to permanent noncapital (‚Äòlabor‚Äô) income <img 
src="SolvingMicroDSOPs22x.svg" alt="</span></span></span></span>pppt  " class="math";align="absmiddle"> (henceforth for
brevity, ‚Äòpermanent income.‚Äô)
<!--l. 10--><p class="indent" >  In the last period of life <img 
src="SolvingMicroDSOPs23x.svg" alt="</span>T  " class="math";align="absmiddle">, there is no future value, <img 
src="SolvingMicroDSOPs24x.svg" alt="</span></span></span></span></span></span>vvvT+1 = 0  " class="math";align="absmiddle">, so the optimal plan is to
consume everything:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs25x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>               mmm1 ‚àíœÅ
vT (mmmT ,pppT ) = --T--.
               1 ‚àí œÅ
" class="math-display" ><a 
 id="x1-3001r9"></a></div>
  </td><td class="equation-label">(9)</td></tr></table>
<!--l. 13--><p class="nopar" >Now deÔ¨Åne nonbold variables as the bold variable divided by the level of permanent
income in the same period, so that, for example, <img 
src="SolvingMicroDSOPs26x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>mT  = mmmT ‚àïpppT  " class="math";align="absmiddle">; and deÔ¨Åne
<img 
src="SolvingMicroDSOPs27x.svg" alt="</span></span></span></span></span></span></span></span></span>vT (mT ) = u(mT )  " class="math";align="absmiddle">.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs4.html#fn3x0"><sup class="textsuperscript"><span 
class="ecrm-0600">3</span></sup></a></span><a 
 id="x1-3002f3"></a>  
For our CRRA utility function, <img 
src="SolvingMicroDSOPs30x.svg" alt="</span></span></span></span></span></span></span></span></span></span>u(xy) = x1‚àíœÅu (y )  " class="math";align="absmiddle">, so (<a 
href="#x1-3001r9">9<!--tex4ht:ref: eq:levelTm1 --></a>) can be rewritten as
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs31x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                     1‚àí œÅ
v  (mmm   ,ppp ) = ppp1‚àíœÅ m-T---
 T   T   T     T   1 ‚àí œÅ
               1‚àíœÅ  1‚àíœÅ
            = pppT ‚àí1ùí¢T  vT (mT ).
                                                                                     
                                                                                     
" class="math-display" ><a 
 id="x1-3004r10"></a></div>
  </td><td class="equation-label">(10)</td></tr></table>
<!--l. 19--><p class="nopar" >
<!--l. 21--><p class="indent" >  Now deÔ¨Åne a new optimization problem:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs32x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>vt(mt ) = max  u (ct) + Œ≤ ùîºt[ùí¢1t+‚àí1œÅvt+1(mt+1)]
           ct
      s.t.
     a = m   ‚àí c
      t    t    t
  kt+1 = at
   bt+1 = (R ‚àïùí¢t+1)kt+1
         ‚óü---‚óù‚óú--‚óû
           ‚â° ‚Ñõt+1
  mt+1 = bt+1 + ùúÉt+1,
" class="math-display" ><a 
 id="x1-3005r11"></a></div>
  </td><td class="equation-label">(11)</td></tr></table>
<!--l. 8--><p class="nopar" >where division by <img 
src="SolvingMicroDSOPs33x.svg" alt="</span>ùí¢ " class="math";align="absmiddle"> in second-to-last equation yields a normalized return factor <img 
src="SolvingMicroDSOPs34x.svg" alt="</span>‚Ñõ  " class="math";align="absmiddle">
which is the consequence of the fact that we have divided <img 
src="SolvingMicroDSOPs35x.svg" alt="</span></span>t + 1  " class="math";align="absmiddle"> level variables by
<img 
src="SolvingMicroDSOPs36x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>pppt+1 = ùí¢t+1pppt  " class="math";align="absmiddle">.
<!--l. 39--><p class="indent" >  Then it is easy to see that for <img 
src="SolvingMicroDSOPs37x.svg" alt="</span></span></span></span></span>t = T ‚àí 1  " class="math";align="absmiddle">, we can write boldface (nonnormalized) <img 
src="SolvingMicroDSOPs38x.svg" alt="</span>v  " class="math";align="absmiddle"> as a
function of <img 
src="SolvingMicroDSOPs39x.svg" alt="</span>v  " class="math";align="absmiddle"> (normalized value) and permanent income:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs40x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>              1‚àí œÅ
vt(mmmt,pppt) = ppp t  vt(mt ),
" class="math-display" ><a 
 id="x1-3006r12"></a></div>
  </td><td class="equation-label">(12)</td></tr></table>
<!--l. 42--><p class="nopar" >and so on back to all earlier periods. Hence, if we solve the problem (<a 
href="#x1-3005r11">11<!--tex4ht:ref: eq:vNormed --></a>) which has only a
single state variable <img 
src="SolvingMicroDSOPs41x.svg" alt="</span></span>mt  " class="math";align="absmiddle">, we can obtain the levels of the value function from (<a 
href="#x1-3006r12">12<!--tex4ht:ref: eq:vLvlFromvFunc --></a>), and of
                                                                                     
                                                                                     
consumption and all other variables from the corresponding permanent-income-normalized
solution objects by multiplying each by <img 
src="SolvingMicroDSOPs42x.svg" alt="</span></span></span></span>pppt  " class="math";align="absmiddle">, e.g.¬†
  <table 
class="equation-star"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs43x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                 -mt-
                ‚óú ‚óû‚óü ‚óù
ct(mmmt, pppt) = ppptct(mmmt ‚àïpppt).
" class="math-display" ></div>
  </td></tr></table>
<!--l. 46--><p class="nopar" >
<!--l. 49--><p class="indent" >  We have thus reduced the problem from two continuous state variables to one (and thereby
enormously simpliÔ¨Åed its solution).
<!--l. 51--><p class="indent" >  For future reference it is useful to write (<a 
href="#x1-3005r11">11<!--tex4ht:ref: eq:vNormed --></a>) in the traditional way, by substituting
<img 
src="SolvingMicroDSOPs44x.svg" alt="</span></span></span></span></span></span></span>bt+1,kt+1,  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs45x.svg" alt="</span></span>at  " class="math";align="absmiddle"> into <img 
src="SolvingMicroDSOPs46x.svg" alt="</span></span></span>mt+1   " class="math";align="absmiddle">:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs47x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                                    ‚óú---------m‚óût‚óü+1--------‚óù
                            1‚àíœÅ
vt(mt) = maxc   u (c) + Œ≤ ùîºt[ùí¢t+1vt+1((mt ‚àí c)(R‚àïùí¢t+1 ) + ùúÉt+1)].
" class="math-display" ><a 
 id="x1-3007r13"></a></div>
  </td><td class="equation-label">(13)</td></tr></table>
<!--l. 54--><p class="nopar" >
<!--l. 6--><p class="indent" >  <a 
 id="notation"></a>
  <h3 class="sectionHead"><span class="titlemark">4  </span> <a 
 id="x1-40004"></a>Notation</h3>                                                                          {sec:notation}
                                                                                     
                                                                                     
<!--l. 9--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">4.1  </span> <a 
 id="x1-50004.1"></a>Periods, Stages, Steps</h4>
<!--l. 11--><p class="noindent" >The problem so far assumes that the agent has only one decision problem to solve in any
period. But it is increasingly common to model agents who have multiple choice stages per
period; a problem might have, say, a consumption decision (call it the <img 
src="SolvingMicroDSOPs48x.svg" alt="</span>c  " class="math";align="absmiddle"> stage), a labor
supply stage (call it <img 
src="SolvingMicroDSOPs49x.svg" alt="</span>‚Ñì  " class="math";align="absmiddle">) and a choice of what proportion <img 
src="SolvingMicroDSOPs50x.svg" alt="</span>œÇ  " class="math";align="absmiddle"> of their assets to invest in a risky
asset (the portfolio-choice stage).
<!--l. 13--><p class="indent" >  The modeler might well want to explore whether the order in which the stages are solved
makes any diÔ¨Äerence, either to the substantive results or to aspects of the computational
solution like speed and accuracy.
<!--l. 15--><p class="indent" >  If, as in section <a 
href="#x1-20002">2<!--tex4ht:ref: sec:the-problem --></a>, we hard-wire into the solution code for each stage an assumption
that its successor stage will be something in particular (say, the consumption stage
assumes that the portfolio choice is next), then if we want to change the order of
the stages (say, labor supply after consumption, followed by portfolio choice), we
will need to re-hard-wire each of the stages to know particular things about its
new successor (for example, the speciÔ¨Åcs of the distribution of the rate of return
on the risky asset must be known by whatever stage precedes the portfolio choice
stage).
<!--l. 17--><p class="indent" >  But one of the cardinal insights of Bellman‚Äôs (1957, ‚ÄúDynamic Programming‚Äù) original work
is that everything that matters for the solution to the current problem is encoded in a
‚Äòcontinuation-value function.‚Äô Using Bellman‚Äôs insight, we describe here a framework for
isolating the stage problems within a period from each other, and the period from its
successors in any future period; the advantage of this is that the isolated stage and period
problems will then be ‚Äòmodular‚Äô: We can solve them in any order without changing
any code (only transitions need to be rewired). After considering the stage-order
<img 
src="SolvingMicroDSOPs51x.svg" alt="</span></span></span></span></span>[‚Ñì,c,œÇ]  " class="math";align="absmiddle">, the modeler can costlessly reorder the stages to consider, say, the order
<img 
src="SolvingMicroDSOPs52x.svg" alt="</span></span></span>[‚Ñì,œÇ,c]  " class="math";align="absmiddle">.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs5.html#fn4x0"><sup class="textsuperscript"><span 
class="ecrm-0600">4</span></sup></a></span><a 
 id="x1-5001f4"></a>  
<!--l. 20--><p class="indent" >  <a 
 id="moves"></a>
  <h4 class="subsectionHead"><span class="titlemark">4.2  </span> <a 
 id="x1-60004.2"></a>Steps</h4>                                                                           {subsec:steps}
<!--l. 23--><p class="noindent" >The key is to distinguish, within each stage‚Äôs Bellman problem, three steps:
<!--l. 25--><p class="indent" >
      <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-6002x1">
      <!--l. 26--><p class="noindent" >Arrival: Incoming state variables (e.g., <img 
src="SolvingMicroDSOPs53x.svg" alt="</span>k  " class="math";align="absmiddle">) are known, but any shocks associated
      with the period have not been realized and decision(s) have not yet been made
                                                                                     
                                                                                     
      </li>
<li 
  class="enumerate" id="x1-6004x2">
      <!--l. 27--><p class="noindent" >Decision: The agent solves the decision problem for the period
      </li>
<li 
  class="enumerate" id="x1-6006x3">
      <!--l. 28--><p class="noindent" >Continuation:  After  all  decisions  have  been  made,  their  consequences  are
      measured  by  evaluation  of  the  continuing-value  function  at  the  values  of  the
      ‚Äòoutgoing‚Äô state variables (sometimes called ‚Äòpost-state‚Äô variables).</li></ol>
<!--l. 31--><p class="indent" >  Notice that this speciÔ¨Åcation is silent about when the stochastic shocks are realized; this
may occur either before or after the decision stage. In the consumption problem we are
studying, the natural choice is to assume that the shocks have been realized before the
decision is made so that the consumer knows what their income has been for the period. In the
portfolio problem we will examine below, the portfolio share decision must be made before the
stochastic returns are realized.
<!--l. 34--><p class="indent" >  When we want to refer to a speciÔ¨Åc step in the stage we will do so by using an indicator
which identiÔ¨Åes that step. Here we use the consumption stage problem described above to
exemplify the usage:
<div class="center" 
>
<!--l. 35--><p class="noindent" >
<div class="pic-tabular">
<img 
src="SolvingMicroDSOPs54x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>               |          |       |       |
---------Step--|Indicator-|State--|Usage--|Explanation----------------------------
       Arrival |    ‚Üº     |  k    |v‚Üº (k) |value at entry to stage (before shocks )
   Decision(s) | (blank)  |  m    |v(m )  |value of stage-decision (after shocks)
               |          |       |       |
-Continuation--|----‚áÅ--------a-----v‚áÅ-(a)--value-at-exit-(after decision-)----------
               |
" ></div></div>
<!--l. 46--><p class="indent" >  Notice that the value functions at diÔ¨Äerent steps of the stage have distinct state variables.
Only <img 
src="SolvingMicroDSOPs55x.svg" alt="</span>k  " class="math";align="absmiddle"> is known at the beginning of the stage, and other variables take on their values with
equations like <img 
src="SolvingMicroDSOPs56x.svg" alt="</span></span></span></span>b = k ‚Ñõ  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs57x.svg" alt="</span></span></span></span></span>m =  b + ùúÉ.  " class="math";align="absmiddle"> We will refer to such within-the-stage creation of
variables as ‚Äòevolutions.‚Äô So, the consumption stage problem has two evolutions: from <img 
src="SolvingMicroDSOPs58x.svg" alt="</span>k  " class="math";align="absmiddle"> to
<img 
src="SolvingMicroDSOPs59x.svg" alt="</span>m  " class="math";align="absmiddle"> and from <img 
src="SolvingMicroDSOPs60x.svg" alt="</span>m  " class="math";align="absmiddle"> to <img 
src="SolvingMicroDSOPs61x.svg" alt="</span>a  " class="math";align="absmiddle">.
<!--l. 52--><p class="indent" >  <a 
 id="transitions"></a>
  <h4 class="subsectionHead"><span class="titlemark">4.3  </span> <a 
 id="x1-70004.3"></a>Transitions</h4>                                                                      {subsec:transitions}
<!--l. 55--><p class="noindent" >In the backward-induction world of Bellman solutions, to solve the problem of a particular
period we must start with an end-of-period (continuation) value function, which we designate
                                                                                     
                                                                                     
by explicitly including the period indicator in the subscript (the <img 
src="SolvingMicroDSOPs62x.svg" alt="</span>:=  " class="math";align="absmiddle"> symbol denotes that the
object on the right hand side is assigned to the object on the left hand side; the left object
‚Äògets‚Äô the right object):needs discussion: It‚Äôs made at the time of execution of Matt‚Äôs link structure; but is it a pointer, a deepcopy, an
algorithm, or what?
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs63x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                   ‚óú=‚óûk‚óü‚óù
vt‚áÅ (a) := Œ≤v ‚Üº(t+1)( a ),
" class="math-display" ><a 
 id="x1-7001r14"></a></div>
  </td><td class="equation-label">(14)</td></tr></table>
<!--l. 58--><p class="nopar" >and we are not done solving the problem of period t until we have constructed a
beginning-of-period value function <img 
src="SolvingMicroDSOPs64x.svg" alt="</span></span></span></span></span></span>v  (k)
 ‚Üºt  " class="math";align="absmiddle">.
<!--l. 61--><p class="indent" >  Similarly, in order to solve the problem of any stage, we must endow it with an end-of-stage
continuation-value function. For the last stage in a period, the end-of-stage function is taken
to be end-of-period value function; in our case where there is only one stage, this can be
written cleanly as:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs65x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span>v ‚áÅ(a) :=  vt‚áÅ(a).
" class="math-display" ><a 
 id="x1-7002r15"></a></div>
  </td><td class="equation-label">(15)</td></tr></table>
<!--l. 64--><p class="nopar" >
  <div class="marginpar">
<!--l. 66--><p class="indent" >  pseudocode?   </div>
                                                                                     
                                                                                     
<!--l. 68--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">4.4  </span> <a 
 id="x1-80004.4"></a>The Decision Problem in the New Notation</h4>                                      {subsec:decision-problem}
<!--l. 68--><p class="noindent" ><a 
 id="decision-problem"></a>
<!--l. 70--><p class="indent" >  From ‚Äòinside‚Äô the decision stage, the Decision problem can now be written much more
cleanly than in equation (<a 
href="#x1-3005r11">11<!--tex4ht:ref: eq:vNormed --></a>):
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs66x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                         =a
                       ‚óú-‚óû‚óü-‚óù
v(m ) = maxc  u(c) + v ‚áÅ(m ‚àí c)
" class="math-display" ><a 
 id="x1-8001r16"></a></div>
  </td><td class="equation-label">(16)</td></tr></table>
<!--l. 3--><p class="nopar" >
<!--l. 6--><p class="indent" >  <a 
 id="the-usual-theory"></a>
  <h3 class="sectionHead"><span class="titlemark">5  </span> <a 
 id="x1-90005"></a>The Usual Theory, and a Bit More Notation</h3>                                       {sec:the-usual-theory}
<!--l. 10--><p class="noindent" >For reference and to illustrate our new notation, we will now derive the Euler equation and
other standard results for the problem described above. Since we can write value as of the end
of the consumption stage as a function of <img 
src="SolvingMicroDSOPs67x.svg" alt="</span>a  " class="math";align="absmiddle">:
  <table 
class="equation-star"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs68x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                                                          m
                                                   ‚óú------‚óût+‚óü1-----‚óù
v‚áÅ(a) :=  vt‚áÅ(a) :=  Œ≤v‚Üº (t+1)(a) = Œ≤ ùîº‚Üº (t+1)[ùí¢1‚àít+1œÅvt+1 (a (R ‚àïùí¢t+1) + ùúÉt+1 )],
" class="math-display" ></div>
  </td></tr></table>
<!--l. 14--><p class="nopar" >the Ô¨Årst order condition for (<a 
href="#x1-3007r13">13<!--tex4ht:ref: eq:vusual --></a>) with respect to <img 
src="SolvingMicroDSOPs69x.svg" alt="</span>a  " class="math";align="absmiddle"> (given <img 
src="SolvingMicroDSOPs70x.svg" alt="</span></span>m
  t  " class="math";align="absmiddle">) is
  <table 
class="equation"><tr><td>
                                                                                     
                                                                                     
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs71x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>uc(m   ‚àí a) = va (a) = ùîº      [Œ≤‚Ñõ    ùí¢1‚àíœÅvm  (m    )]
    t         t‚áÅ        ‚Üº(t+1 )   t+1  t+1 t+1   t+1
                    = ùîº ‚Üº(t+1 )[Œ≤R    ùí¢t‚àí+1œÅvmt+1(mt+1 )]
" class="math-display" ><a 
 id="x1-9001r17"></a></div>
  </td><td class="equation-label">(17)</td></tr></table>
<!--l. 19--><p class="nopar" >and because the  <a 
href="https://www.econ2.jhu.edu/people/ccarroll/public/lecturenotes/consumption/Envelope" >Envelope</a> theorem tells us that
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs72x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> m                    ‚àíœÅ  m
vt (mt ) = ùîº‚Üº (t+1)[Œ≤Rùí¢ t+1v t+1(mt+1 )]
" class="math-display" ><a 
 id="x1-9002r18"></a></div>
  </td><td class="equation-label">(18)</td></tr></table>
<!--l. 23--><p class="nopar" >we can substitute the LHS of (<a 
href="#x1-9002r18">18<!--tex4ht:ref: eq:envelope --></a>) for the RHS of (<a 
href="#x1-9001r17">17<!--tex4ht:ref: eq:upceqEvtp1 --></a>) to get
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs73x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>uc(ct) = vmt (mt )
" class="math-display" ><a 
 id="x1-9003r19"></a></div>
  </td><td class="equation-label">(19)</td></tr></table>
<!--l. 3--><p class="nopar" >and rolling forward one period,
  <table 
class="equation"><tr><td>
                                                                                     
                                                                                     
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs74x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> c          m
u (ct+1) = vt+1 (at‚Ñõt+1 + ùúÉt+1)
" class="math-display" ><a 
 id="x1-9004r20"></a></div>
  </td><td class="equation-label">(20)</td></tr></table>
<!--l. 35--><p class="nopar" >so that substituting the LHS in equation (<a 
href="#x1-9001r17">17<!--tex4ht:ref: eq:upceqEvtp1 --></a>) Ô¨Ånally gives us the Euler equation for
consumption:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs75x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>uc(c ) = ùîº   [Œ≤R ùí¢‚àí œÅuc(c   )].
    t     t‚áÅ     t+1    t+1
" class="math-display" ><a 
 id="x1-9005r21"></a></div>
  </td><td class="equation-label">(21)</td></tr></table>
<!--l. 3--><p class="nopar" >
<!--l. 44--><p class="indent" >  We can now restate the problem (<a 
href="#x1-3007r13">13<!--tex4ht:ref: eq:vusual --></a>) with our new within-stage notation:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs76x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>v(m ) = maxc   u(c) + v‚áÅ (m  ‚àí c)
" class="math-display" ><a 
 id="x1-9006r22"></a></div>
  </td><td class="equation-label">(22)</td></tr></table>
<!--l. 47--><p class="nopar" >whose Ô¨Årst order condition with respect to <img 
src="SolvingMicroDSOPs77x.svg" alt="</span>c  " class="math";align="absmiddle"> is
  <table 
class="equation"><tr><td>
                                                                                     
                                                                                     
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs78x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span> c       a
u (c) = v ‚áÅ(m ‚àí  c)
" class="math-display" ><a 
 id="x1-9007r23"></a></div>
  </td><td class="equation-label">(23)</td></tr></table>
<!--l. 51--><p class="nopar" >which is mathematically equivalent to the usual Euler equation for consumption.
<!--l. 54--><p class="indent" >  We will revert to this formulation when we reach section¬†<a 
href="#x1-180006.8">6.8<!--tex4ht:ref: subsec:egm --></a>.
<!--l. 7--><p class="indent" >  <a 
 id="solving-the-next-to-last-period"></a> <a 
 id="solving-the-next"></a>
  <h3 class="sectionHead"><span class="titlemark">6  </span> <a 
 id="x1-100006"></a>Solving the Next-to-Last Period</h3>                                                   {sec:solving-the-next}
<!--l. 11--><p class="noindent" >To reduce clutter, we now temporarily assume that <img 
src="SolvingMicroDSOPs79x.svg" alt="</span></span></span>ùí¢t = 1  " class="math";align="absmiddle"> for all <img 
src="SolvingMicroDSOPs80x.svg" alt="</span>t  " class="math";align="absmiddle">, so that the <img 
src="SolvingMicroDSOPs81x.svg" alt="</span>ùí¢ " class="math";align="absmiddle"> terms
from the earlier derivations disappear, and setting <img 
src="SolvingMicroDSOPs82x.svg" alt="</span></span></span>t = T  " class="math";align="absmiddle"> the problem in the second-to-last
period of life can now be expressed as
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs83x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                                 - a-
v    (m ) = max   u(c) + v      (‚óúm ‚óû‚óü‚àí ‚óùc)
 (t‚àí1)        c           (t‚àí 1)‚áÅ
" class="math-display" ><a 
 id="x1-10001r24"></a></div>
  </td><td class="equation-label">(24)</td></tr></table>
<!--l. 4--><p class="nopar" >where
  <table 
class="equation-star"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs84x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                              ‚åä            ‚åã

v      (a) :=  Œ≤v  (a) ‚â° Œ≤ ùîº   ‚åàv  (a ‚Ñõ +  ùúÉ)‚åâ
  (t‚àí1)‚áÅ          ‚Üºt          ‚Üºt   t‚óü--t‚óù‚óú--‚óût
                                     mt
" class="math-display" ></div>
  </td></tr></table>
<!--l. 23--><p class="nopar" >
<!--l. 31--><p class="indent" >  Using (0) <img 
src="SolvingMicroDSOPs85x.svg" alt="</span></span></span>t = T  " class="math";align="absmiddle">; (1) <img 
src="SolvingMicroDSOPs86x.svg" alt="</span></span></span></span></span></span></span>vt(m ) = u(m )  " class="math";align="absmiddle">; (2) the deÔ¨Ånition of <img 
src="SolvingMicroDSOPs87x.svg" alt="</span></span></span>u (m )  " class="math";align="absmiddle">; and (3) the deÔ¨Ånition of
the expectations operator,
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs88x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>          ‚à´
            ‚àû (a‚Ñõt-+--ùúó)1‚àíœÅ
v‚Üºt(a ) =         1 ‚àí œÅ    d‚Ñ± (ùúó)
           0
" class="math-display" ><a 
 id="x1-10002r25"></a></div>
  </td><td class="equation-label">(25)</td></tr></table>
<!--l. 34--><p class="nopar" >where <img 
src="SolvingMicroDSOPs89x.svg" alt="</span></span></span></span>‚Ñ± (ùúÉ )  " class="math";align="absmiddle"> is the cumulative distribution function for <img 
src="SolvingMicroDSOPs90x.svg" alt="</span>ùúÉ  " class="math";align="absmiddle">.
<!--l. 41--><p class="indent" >  This maximization problem implicitly deÔ¨Ånes a ‚Äòlocal function‚Äô <img 
src="SolvingMicroDSOPs91x.svg" alt="</span></span></span></span></span></span></span>ct‚àí 1(m )  " class="math";align="absmiddle"> that yields
optimal consumption in period <img 
src="SolvingMicroDSOPs92x.svg" alt="</span></span></span>t ‚àí 1  " class="math";align="absmiddle"> for any speciÔ¨Åc numerical level of resources like
<img 
src="SolvingMicroDSOPs93x.svg" alt="</span></span></span></span>m  = 1.7  " class="math";align="absmiddle">.
<!--l. 43--><p class="indent" >  But because there is no general analytical solution to this problem, for any given <img 
src="SolvingMicroDSOPs94x.svg" alt="</span>m  " class="math";align="absmiddle"> we
must use numerical computational tools to Ô¨Ånd the <img 
src="SolvingMicroDSOPs95x.svg" alt="</span>c  " class="math";align="absmiddle"> that maximizes the expression. This is
excruciatingly slow because for every potential <img 
src="SolvingMicroDSOPs96x.svg" alt="</span>c  " class="math";align="absmiddle"> to be considered, a deÔ¨Ånite integral over the
interval <img 
src="SolvingMicroDSOPs97x.svg" alt="</span></span></span></span>(0,‚àû  )  " class="math";align="absmiddle"> must be calculated numerically, and numerical integration is very slow
(especially over an unbounded domain!).
<!--l. 45--><p class="indent" >  <a 
 id="discretizing-the-distribution"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.1  </span> <a 
 id="x1-110006.1"></a>Discretizing the Distribution</h4>
<!--l. 47--><p class="noindent" >Our Ô¨Årst speedup trick is therefore to construct a discrete approximation to the
lognormal distribution that can be used in place of numerical integration. That is, we
want to approximate the expectation over <img 
src="SolvingMicroDSOPs98x.svg" alt="</span>ùúÉ  " class="math";align="absmiddle"> of a function <img 
src="SolvingMicroDSOPs99x.svg" alt="</span></span></span></span>g(ùúÉ)  " class="math";align="absmiddle"> by calculating its
value at set of <img 
src="SolvingMicroDSOPs100x.svg" alt="</span></span>nùúÉ  " class="math";align="absmiddle"> points <img 
src="SolvingMicroDSOPs101x.svg" alt="</span></span>ùúÉi  " class="math";align="absmiddle">, each of which has an associated probability weight
<img 
src="SolvingMicroDSOPs102x.svg" alt="</span></span>wi  " class="math";align="absmiddle">:
  <table 
class="equation-star"><tr><td>
                                                                                     
                                                                                     
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs103x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>          ‚à´  ùúÉ
ùîº [g(ùúÉ)] =   (ùúó )d‚Ñ± (ùúó )
            ùúÉ
          ‚àën
        ‚âà     wig(ùúÉi)
           ùúÉ=1
" class="math-display" ></div>
  </td></tr></table>
<!--l. 51--><p class="nopar" >(because adding <img 
src="SolvingMicroDSOPs104x.svg" alt="</span>n  " class="math";align="absmiddle"> weighted values to each other is enormously faster than general-purpose
numerical integration).
<!--l. 54--><p class="indent" >  Such a procedure is called a ‚Äòquadrature‚Äô method of integration; <a 
href="#XTanaka2013-bc">Tanaka and Toda</a>¬†(<a 
href="#XTanaka2013-bc">2013</a>)
survey a number of options, but for our purposes we choose the one which is easiest to
understand: An ‚Äòequiprobable‚Äô approximation (that is, one where each of the values of <img 
src="SolvingMicroDSOPs105x.svg" alt="</span></span>ùúÉ
 i  " class="math";align="absmiddle"> has
an equal probability, equal to <img 
src="SolvingMicroDSOPs106x.svg" alt="</span></span></span>1‚àïnùúÉ  " class="math";align="absmiddle">).
<!--l. 56--><p class="indent" >  We calculate such an <img 
src="SolvingMicroDSOPs107x.svg" alt="</span>n  " class="math";align="absmiddle">-point approximation as follows.
<!--l. 58--><p class="indent" >  DeÔ¨Åne a set of points from <img 
src="SolvingMicroDSOPs108x.svg" alt="</span></span>‚ôØ0   " class="math";align="absmiddle"> to <img 
src="SolvingMicroDSOPs109x.svg" alt="</span></span></span>‚ôØnùúÉ   " class="math";align="absmiddle"> on the <img 
src="SolvingMicroDSOPs110x.svg" alt="</span></span></span>[0,1]  " class="math";align="absmiddle"> interval as the elements of the set
<img 
src="SolvingMicroDSOPs111x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>‚ôØ = {0,1 ‚àïn,2‚àïn, ...,1} " class="math";align="absmiddle">.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs6.html#fn5x0"><sup class="textsuperscript"><span 
class="ecrm-0600">5</span></sup></a></span><a 
 id="x1-11001f5"></a>  
Call the inverse of the <img 
src="SolvingMicroDSOPs113x.svg" alt="</span>ùúÉ  " class="math";align="absmiddle"> distribution <img 
src="SolvingMicroDSOPs114x.svg" alt="</span></span></span>‚Ñ± ‚àí1   " class="math";align="absmiddle">, and deÔ¨Åne the points <img 
src="SolvingMicroDSOPs115x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>‚ôØ‚àí1 = ‚Ñ± ‚àí1(‚ôØ )
 i          i  " class="math";align="absmiddle">. Then the
conditional mean of <img 
src="SolvingMicroDSOPs116x.svg" alt="</span>ùúÉ  " class="math";align="absmiddle"> in each of the intervals numbered 1 to <img 
src="SolvingMicroDSOPs117x.svg" alt="</span>n  " class="math";align="absmiddle"> is:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs118x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                          ‚à´  ‚ôØ‚àíi1
ùúÉi ‚â° ùîº[ùúÉ|‚ôØ‚àíi‚àí11 ‚â§ ùúÉ &#x003C; ‚ôØ‚àíi 1] =      ùúó d‚Ñ± (ùúó),
                            ‚ôØ‚àíi1‚àí1
" class="math-display" ><a 
 id="x1-11003r26"></a></div>
  </td><td class="equation-label">(26)</td></tr></table>
<!--l. 64--><p class="nopar" >and when the integral is evaluated numerically for each <img 
src="SolvingMicroDSOPs119x.svg" alt="</span>i  " class="math";align="absmiddle"> the result is a set of values of <img 
src="SolvingMicroDSOPs120x.svg" alt="</span>ùúÉ  " class="math";align="absmiddle">
that correspond to the mean value in each of the <img 
src="SolvingMicroDSOPs121x.svg" alt="</span>n  " class="math";align="absmiddle"> intervals.
<!--l. 67--><p class="indent" >  The method is illustrated in Figure¬†<a 
href="#x1-110061">1<!--tex4ht:ref: fig:discreteapprox --></a>. The solid continuous curve represents the ‚Äútrue‚Äù CDF
<img 
src="SolvingMicroDSOPs122x.svg" alt="</span></span></span></span>‚Ñ± (ùúÉ)  " class="math";align="absmiddle"> for a lognormal distribution such that <img 
src="SolvingMicroDSOPs123x.svg" alt="</span></span></span></span>ùîº [ùúÉ ] = 1  " class="math";align="absmiddle">, <img 
src="SolvingMicroDSOPs124x.svg" alt="</span></span></span></span></span>œÉùúÉ = 0.1  " class="math";align="absmiddle">. The short vertical line
                                                                                     
                                                                                     
segments represent the <img 
src="SolvingMicroDSOPs125x.svg" alt="</span></span>n ùúÉ  " class="math";align="absmiddle"> equiprobable values of <img 
src="SolvingMicroDSOPs126x.svg" alt="</span></span>ùúÉi  " class="math";align="absmiddle"> which are used to approximate this
distribution.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs7.html#fn6x0"><sup class="textsuperscript"><span 
class="ecrm-0600">6</span></sup></a></span><a 
 id="x1-11004f6"></a>   <a 
 id="discreteApprox"></a>
<div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-110061"></a>
                                                                                     
                                                                                     
<!--l. 3--><p class="noindent" > <img 
src="./Figures/discreteApprox.png" alt="pict"  
 width="358.50612pt" >
<figcaption class="caption" ><span class="id">Figure¬†1: </span><span  
class="content">Equiprobable Discrete Approximation to Lognormal Distribution <img 
src="SolvingMicroDSOPs127x.svg" alt="</span>‚Ñ± " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-110061 -->          {Ô¨Åg:discreteapprox}
                                                                                     
                                                                                     
  </div>
<!--l. 84--><p class="indent" >  Because one of the purposes of these notes is to connect the math to the code that solves
the math, we display here a brief snippet from the notebook that constructs these
points.
<!--l. 96--><p class="indent" >  We now substitute our approximation (<a 
href="#x1-11007r27">27<!--tex4ht:ref: eq:vDiscrete --></a>) for <img 
src="SolvingMicroDSOPs128x.svg" alt="</span></span></span></span></span></span></span></span></span>v(t‚àí1)‚áÅ (a)  " class="math";align="absmiddle"> in (<a 
href="#x1-10001r24">24<!--tex4ht:ref: eq:vEndPrdTm1 --></a>) which is simply the sum
of <img 
src="SolvingMicroDSOPs129x.svg" alt="</span></span>nùúÉ  " class="math";align="absmiddle"> numbers and is therefore easy to calculate (compared to the full-Ô¨Çedged numerical
integration (<a 
href="#x1-10002r25">25<!--tex4ht:ref: eq:NumDefInt --></a>) that it replaces).
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs130x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>              (   ) ‚àënùúÉ           1‚àí œÅ
v     (a) = Œ≤  -1-      (‚Ñõta-+-ùúÉi)---
  t‚àí1‚áÅ          n ùúÉ          1 ‚àí œÅ
                    i=1
" class="math-display" ><a 
 id="x1-11007r27"></a></div>
  </td><td class="equation-label">(27)</td></tr></table>
<!--l. 3--><p class="nopar" >
<!--l. 122--><p class="indent" >  <a 
 id="the-approximate-consumption-and-value-functions"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.2  </span> <a 
 id="x1-120006.2"></a>The Approximate Consumption and Value Functions</h4>
<!--l. 125--><p class="noindent" >Given any particular value of <img 
src="SolvingMicroDSOPs131x.svg" alt="</span>m  " class="math";align="absmiddle">, a numerical maximization tool can now Ô¨Ånd the <img 
src="SolvingMicroDSOPs132x.svg" alt="</span>c  " class="math";align="absmiddle"> that
solves (<a 
href="#x1-10001r24">24<!--tex4ht:ref: eq:vEndPrdTm1 --></a>) in a reasonable amount of time.
<!--l. 133--><p class="indent" >  The notebook code responsible for computing an estimated consumption function
begins in ‚ÄúSolving the Model by Value Function Maximization,‚Äù where a vector
containing a set of possible values of market resources <img 
src="SolvingMicroDSOPs133x.svg" alt="</span>m  " class="math";align="absmiddle"> is created (in the code,
various <img 
src="SolvingMicroDSOPs134x.svg" alt="</span>m  " class="math";align="absmiddle"> vectors have names beginning mVec; in these notes we will use a boldface
monotype (computer) font to represent vectors, so for example we can refer to our
collection of <img 
src="SolvingMicroDSOPs135x.svg" alt="</span>m  " class="math";align="absmiddle"> points as <img 
src="SolvingMicroDSOPs136x.svg" alt="</span></span></span>mmm " class="math";align="absmiddle"> with values indexed by brackets: <img 
src="SolvingMicroDSOPs137x.svg" alt="</span></span></span></span>mmm[1]  " class="math";align="absmiddle"> is the Ô¨Årst
entry in the vector, up to a last entry <img 
src="SolvingMicroDSOPs138x.svg" alt="</span></span></span></span></span></span>mmm[‚àí 1]  " class="math";align="absmiddle">; we arbitrarily (and suboptimally)
pick the Ô¨Årst Ô¨Åve integers as our Ô¨Åve mVec gridpoints (in the code, <img 
src="SolvingMicroDSOPs139x.svg" alt="</span></span>mVec-int " class="math";align="absmiddle">=
<img 
src="SolvingMicroDSOPs140x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>{0.,1.,2.,3.,4.} " class="math";align="absmiddle">)).
<!--l. 138--><p class="indent" >  <a 
 id="an-interpolated-consumption-function"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.3  </span> <a 
 id="x1-130006.3"></a>An Interpolated Consumption Function</h4>                                          {subsec:LinInterp}
<!--l. 142--><p class="noindent" >This is accomplished in ‚ÄúAn Interpolated Consumption Function,‚Äù which generates an
interpolating function that we designate <img 
src="SolvingMicroDSOPs141x.svg" alt="</span></span></span></span></span></span></span></span></span>`c(t‚àí1)(m )  " class="math";align="absmiddle">.
                                                                                     
                                                                                     
<!--l. 145--><p class="indent" >  Figures <a 
href="#x1-130032">2<!--tex4ht:ref: fig:PlotcTm1Simple --></a> and¬†<a 
href="#x1-130043">3<!--tex4ht:ref: fig:PlotVTm1Simple --></a> show plots of the constructed <img 
src="SolvingMicroDSOPs142x.svg" alt="</span></span></span></span></span>`ct‚àí 1   " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs143x.svg" alt="</span></span></span></span></span>`vt‚àí1   " class="math";align="absmiddle">. While the <img 
src="SolvingMicroDSOPs144x.svg" alt="</span></span></span></span></span>`ct‚àí1   " class="math";align="absmiddle">
function looks very smooth, the fact that the <img 
src="SolvingMicroDSOPs145x.svg" alt="</span></span></span></span></span>`vt‚àí1   " class="math";align="absmiddle">  function is a set of line
segments is very evident. This Ô¨Ågure provides the beginning of the intuition for
why trying to approximate the value function directly is a bad idea (in this
context).<span class="footnote-mark"><a 
href="SolvingMicroDSOPs8.html#fn7x0"><sup class="textsuperscript"><span 
class="ecrm-0600">7</span></sup></a></span><a 
 id="x1-13001f7"></a>  
<!--l. 148--><p class="indent" >  <a 
 id="PlotcTm1Simple"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-130032"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/PlotcTm1Simple.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†2: </span><span  
class="content"><img 
src="SolvingMicroDSOPs146x.svg" alt="</span></span></span></span></span></span></span>cT‚àí 1(m )  " class="math";align="absmiddle"> (solid) versus <img 
src="SolvingMicroDSOPs147x.svg" alt="</span></span></span></span></span></span></span></span>`cT‚àí 1(m )  " class="math";align="absmiddle"> (dashed)</span></figcaption><!--tex4ht:label?: x1-130032 -->                                   {Ô¨Åg:PlotcTm1Simple}
                                                                                     
                                                                                     
  </div>
<!--l. 155--><p class="indent" >  <a 
 id="PlotvTm1Simple"></a>  <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-130043"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                          <img 
src="./Figures/PlotVTm1Simple.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†3: </span><span  
class="content"><img 
src="SolvingMicroDSOPs148x.svg" alt="</span></span></span></span>vT ‚àí1   " class="math";align="absmiddle"> (solid) versus <img 
src="SolvingMicroDSOPs149x.svg" alt="</span></span></span></span></span></span></span></span>`vT‚àí1(m )  " class="math";align="absmiddle"> (dashed)</span></figcaption><!--tex4ht:label?: x1-130043 -->                                      {Ô¨Åg:PlotVTm1Simple}
                                                                                     
                                                                                     
  </div>
<!--l. 164--><p class="indent" >  <a 
 id="interpolating-expectations"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.4  </span> <a 
 id="x1-140006.4"></a>Interpolating Expectations</h4>
<!--l. 168--><p class="noindent" >Piecewise linear ‚Äòspline‚Äô interpolation as described above works well for generating a good
approximation to the true optimal consumption function. However, there is a clear ineÔ¨Éciency
in the program: Since it uses equation (<a 
href="#x1-10001r24">24<!--tex4ht:ref: eq:vEndPrdTm1 --></a>), for every value of <img 
src="SolvingMicroDSOPs150x.svg" alt="</span>m  " class="math";align="absmiddle"> the program must calculate
the utility consequences of various possible choices of <img 
src="SolvingMicroDSOPs151x.svg" alt="</span>c  " class="math";align="absmiddle"> (and therefore <img 
src="SolvingMicroDSOPs152x.svg" alt="</span></span></span></span>at‚àí 1   " class="math";align="absmiddle">) as it searches
for the best choice.
<!--l. 170--><p class="indent" >  For any given index <img 
src="SolvingMicroDSOPs153x.svg" alt="</span>j  " class="math";align="absmiddle"> in <img 
src="SolvingMicroDSOPs154x.svg" alt="</span></span></span></span></span></span>mmm[j]  " class="math";align="absmiddle">, as it searches for the corresponding optimal <img 
src="SolvingMicroDSOPs155x.svg" alt="</span>a  " class="math";align="absmiddle">, the
algorithm will end up calculating <img 
src="SolvingMicroDSOPs156x.svg" alt="</span></span></span></span></span></span></span></span></span></span>v(t‚àí1)‚áÅ (Àúa)  " class="math";align="absmiddle"> for many <img 
src="SolvingMicroDSOPs157x.svg" alt="</span></span>Àúa  " class="math";align="absmiddle"> values close to the optimal <img 
src="SolvingMicroDSOPs158x.svg" alt="</span></span></span></span>at‚àí 1   " class="math";align="absmiddle">.
Indeed, even when searching for the optimal <img 
src="SolvingMicroDSOPs159x.svg" alt="</span>a  " class="math";align="absmiddle"> for a diÔ¨Äerent <img 
src="SolvingMicroDSOPs160x.svg" alt="</span>m  " class="math";align="absmiddle"> (say <img 
src="SolvingMicroDSOPs161x.svg" alt="</span></span></span></span></span></span>mmm[k ]  " class="math";align="absmiddle"> for <img 
src="SolvingMicroDSOPs162x.svg" alt="</span></span></span></span>k ‚ÅÑ= j  " class="math";align="absmiddle">) the
search process might compute <img 
src="SolvingMicroDSOPs163x.svg" alt="</span></span></span></span></span></span></span></span></span>v(t‚àí1)‚áÅ (a)  " class="math";align="absmiddle"> for an <img 
src="SolvingMicroDSOPs164x.svg" alt="</span>a  " class="math";align="absmiddle"> close to the correct optimal <img 
src="SolvingMicroDSOPs165x.svg" alt="</span>a  " class="math";align="absmiddle"> for <img 
src="SolvingMicroDSOPs166x.svg" alt="</span></span></span></span></span></span>mmm[j]  " class="math";align="absmiddle">.
But if that diÔ¨Écult computation does not correspond to the exact solution to the <img 
src="SolvingMicroDSOPs167x.svg" alt="</span></span></span></span></span></span>mmm[k]  " class="math";align="absmiddle">
problem, it is discarded.
<!--l. 174--><p class="indent" >  The notebook section ‚ÄúInterpolating Expectations,‚Äù now interpolates
the expected value of ending the period with a given amount of
assets.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs9.html#fn8x0"><sup class="textsuperscript"><span 
class="ecrm-0600">8</span></sup></a></span><a 
 id="x1-14001f8"></a>  
<!--l. 176--><p class="indent" >  Figure¬†<a 
href="#x1-140034">4<!--tex4ht:ref: fig:PlotOTm1RawVSInt --></a> compares the true value function to the approximation produced by following the
interpolation procedure; the approximated and exact functions are of course identical at
the gridpoints of <img 
src="SolvingMicroDSOPs168x.svg" alt="</span></span></span>aaa " class="math";align="absmiddle"> and they appear reasonably close except in the region below
<img 
src="SolvingMicroDSOPs169x.svg" alt="</span></span>m  = 1  " class="math";align="absmiddle">.
<!--l. 178--><p class="indent" >  <a 
 id="PlotOTm1RawVSInt"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-140034"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/PlotOTm1RawVSInt.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†4: </span><span  
class="content">End-Of-Period Value <img 
src="SolvingMicroDSOPs170x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>v (t‚àí1) (at‚àí1)
      ‚áÅ  " class="math";align="absmiddle"> (solid) versus <img 
src="SolvingMicroDSOPs171x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>`v(T‚àí1) (aT‚àí 1)
     ‚áÅ  " class="math";align="absmiddle"> (dashed)</span></figcaption><!--tex4ht:label?: x1-140034 -->
                                                                                        {Ô¨Åg:PlotOTm1RawVSInt}
                                                                                     
                                                                                     
  </div>
<!--l. 185--><p class="indent" >  <a 
 id="PlotComparecTm1AB"></a>  <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-140045"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                          <img 
src="./Figures/PlotComparecTm1AB.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†5: </span><span  
class="content"><img 
src="SolvingMicroDSOPs172x.svg" alt="</span></span></span></span></span></span></span>cT‚àí 1(m )  " class="math";align="absmiddle"> (solid) versus <img 
src="SolvingMicroDSOPs173x.svg" alt="</span></span></span></span></span></span></span></span>`cT‚àí 1(m )  " class="math";align="absmiddle"> (dashed)</span></figcaption><!--tex4ht:label?: x1-140045 -->                                   {Ô¨Åg:PlotComparecTm1AB}
                                                                                     
                                                                                     
  </div>
  <div class="marginpar">
<!--l. 192--><p class="indent" >  In all Ô¨Ågs, replace gothic h with notation corresponding to the lecture notes.</div>
<!--l. 194--><p class="indent" >  Nevertheless, the consumption rule obtained when the approximating <img 
src="SolvingMicroDSOPs174x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>`v      (a   )
 (t‚àí 1)‚áÅ   t‚àí 1  " class="math";align="absmiddle"> is used
instead of <img 
src="SolvingMicroDSOPs175x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>v (t‚àí1)‚áÅ(at‚àí1)  " class="math";align="absmiddle"> is surprisingly bad, as shown in Ô¨Ågure <a 
href="#x1-140045">5<!--tex4ht:ref: fig:PlotComparecTm1AB --></a>. For example, when <img 
src="SolvingMicroDSOPs176x.svg" alt="</span>m  " class="math";align="absmiddle"> goes
from 2 to 3, <img 
src="SolvingMicroDSOPs177x.svg" alt="</span></span></span></span></span>`ct‚àí1   " class="math";align="absmiddle"> goes from about 1 to about 2, yet when <img 
src="SolvingMicroDSOPs178x.svg" alt="</span>m  " class="math";align="absmiddle"> goes from 3 to 4, <img 
src="SolvingMicroDSOPs179x.svg" alt="</span></span>`c " class="math";align="absmiddle"> goes from
about 2 to about 2.05. The function fails even to be concave, which is distressing because
Carroll and Kimball¬†(<a 
href="#XckConcavity">1996</a>) prove that the correct consumption function is strictly concave in
a wide class of problems that includes this one.
<!--l. 196--><p class="indent" >  <a 
 id="value-function-versus-first-order-condition"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.5  </span> <a 
 id="x1-150006.5"></a>Value Function versus First Order Condition</h4>                                     {subsec:vVsuP}
<!--l. 199--><p class="noindent" >Loosely speaking, our diÔ¨Éculty reÔ¨Çects the fact that the consumption choice is governed by
the marginal value function, not by the level of the value function (which is the object that we
approximated). To understand this point, recall that a quadratic utility function exhibits risk
aversion because with a stochastic <img 
src="SolvingMicroDSOPs180x.svg" alt="</span>c  " class="math";align="absmiddle">,
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs181x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>ùîº [‚àí (c ‚àí c)2] &#x003C; ‚àí (ùîº[c] ‚àí c)2
         /              /
" class="math-display" ><a 
 id="x1-15001r28"></a></div>
  </td><td class="equation-label">(28)</td></tr></table>
<!--l. 207--><p class="nopar" >(where <img 
src="SolvingMicroDSOPs182x.svg" alt="</span></span>/c  " class="math";align="absmiddle"> is the ‚Äòbliss point‚Äô which is assumed always to exceed feasible <img 
src="SolvingMicroDSOPs183x.svg" alt="</span>c  " class="math";align="absmiddle">). However, unlike
the CRRA utility function, with quadratic utility the consumption/saving behavior of
consumers is unaÔ¨Äected by risk since behavior is determined by the Ô¨Årst order condition,
which depends on marginal utility, and when utility is quadratic, marginal utility is unaÔ¨Äected
by risk:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs184x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>ùîº[‚àí 2(c ‚àí /c)] = ‚àí 2(ùîº[c] ‚àí /c).
" class="math-display" ><a 
 id="x1-15002r29"></a></div>
  </td><td class="equation-label">(29)</td></tr></table>
<!--l. 215--><p class="nopar" >
<!--l. 217--><p class="indent" >  Intuitively, if one‚Äôs goal is to accurately capture choices that are governed by marginal
value, numerical techniques that approximate the marginal value function will yield a more
accurate approximation to optimal behavior than techniques that approximate the level of the
value function.
<!--l. 224--><p class="indent" >  The Ô¨Årst order condition of the maximization problem in period <img 
src="SolvingMicroDSOPs185x.svg" alt="</span></span></span>T ‚àí 1  " class="math";align="absmiddle"> is:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs186x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> c                  c
u (c) = Œ≤ ùîº ‚áÅ(T‚àí1)[Ru (ct)]
           ( 1 ) ‚àënùúÉ
 c‚àí œÅ = R Œ≤  ---     (R(m  ‚àí c) + ùúÉi)‚àíœÅ .
             nùúÉ  i=1
" class="math-display" ><a 
 id="x1-15003r30"></a></div>
  </td><td class="equation-label">(30)</td></tr></table>
<!--l. 4--><p class="nopar" ><a 
 id="PlotuPrimeVSOPrime"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-150046"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/PlotuPrimeVSOPrime.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†6: </span><span  
class="content"><img 
src="SolvingMicroDSOPs187x.svg" alt="</span></span></span></span></span>uc(c)  " class="math";align="absmiddle"> versus <img 
src="SolvingMicroDSOPs188x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>va     (3 ‚àí c),va     (4 ‚àí c),`va     (3 ‚àí c),`va     (4 ‚àí c)
 (T‚àí1)‚áÅ         (T‚àí1)‚áÅ         (T‚àí1)‚áÅ          (T ‚àí1)‚áÅ  " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-150046 -->    {Ô¨Åg:PlotuPrimeVSOPrime}
                                                                                     
                                                                                     
  </div>
<!--l. 241--><p class="indent" >  The downward-sloping curve in Figure <a 
href="#x1-150046">6<!--tex4ht:ref: fig:PlotuPrimeVSOPrime --></a> shows the value of <img 
src="SolvingMicroDSOPs189x.svg" alt="</span></span></span>c‚àíœÅ  " class="math";align="absmiddle"> for our baseline parameter
values for <img 
src="SolvingMicroDSOPs190x.svg" alt="</span></span></span></span></span>0 ‚â§ c ‚â§ 4  " class="math";align="absmiddle"> (the horizontal axis). The solid upward-sloping curve shows the value of
the RHS of (<a 
href="#x1-15003r30">30<!--tex4ht:ref: eq:FOCTm1 --></a>) as a function of <img 
src="SolvingMicroDSOPs191x.svg" alt="</span>c  " class="math";align="absmiddle"> under the assumption that <img 
src="SolvingMicroDSOPs192x.svg" alt="</span></span>m  = 3  " class="math";align="absmiddle">. Constructing this
Ô¨Ågure is time-consuming, because for every value of <img 
src="SolvingMicroDSOPs193x.svg" alt="</span>c  " class="math";align="absmiddle"> plotted we must calculate
the RHS of (<a 
href="#x1-15003r30">30<!--tex4ht:ref: eq:FOCTm1 --></a>). The value of <img 
src="SolvingMicroDSOPs194x.svg" alt="</span>c  " class="math";align="absmiddle"> for which the RHS and LHS of (<a 
href="#x1-15003r30">30<!--tex4ht:ref: eq:FOCTm1 --></a>) are equal
is the optimal level of consumption given that <img 
src="SolvingMicroDSOPs195x.svg" alt="</span></span>m  = 3  " class="math";align="absmiddle">, so the intersection of the
downward-sloping and the upward-sloping curves gives the (approximated) optimal
value of <img 
src="SolvingMicroDSOPs196x.svg" alt="</span>c  " class="math";align="absmiddle">. As we can see, the two curves intersect just below <img 
src="SolvingMicroDSOPs197x.svg" alt="</span></span>c = 2  " class="math";align="absmiddle">. Similarly, the
upward-sloping dashed curve shows the expected value of the RHS of (<a 
href="#x1-15003r30">30<!--tex4ht:ref: eq:FOCTm1 --></a>) under the
assumption that <img 
src="SolvingMicroDSOPs198x.svg" alt="</span></span>m  = 4  " class="math";align="absmiddle">, and the intersection of this curve with <img 
src="SolvingMicroDSOPs199x.svg" alt="</span></span></span></span></span>uc (c)  " class="math";align="absmiddle"> yields the
optimal level of consumption if <img 
src="SolvingMicroDSOPs200x.svg" alt="</span></span>m =  4  " class="math";align="absmiddle">. These two curves intersect slightly below
<img 
src="SolvingMicroDSOPs201x.svg" alt="</span></span></span></span>c = 2.5  " class="math";align="absmiddle">. Thus, increasing <img 
src="SolvingMicroDSOPs202x.svg" alt="</span>m  " class="math";align="absmiddle"> from 3 to 4 increases optimal consumption by about
0.5.
<!--l. 260--><p class="indent" >  Now consider the derivative of our function <img 
src="SolvingMicroDSOPs203x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>`v(t‚àí1)(at‚àí 1)  " class="math";align="absmiddle">. Because we have constructed
<img 
src="SolvingMicroDSOPs204x.svg" alt="</span></span></span></span></span></span>`v(t‚àí1)   " class="math";align="absmiddle"> as a linear interpolation, the slope of <img 
src="SolvingMicroDSOPs205x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>`v (t‚àí1)(at‚àí1)  " class="math";align="absmiddle"> between any two adjacent points
<img 
src="SolvingMicroDSOPs206x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>{aaa [i],aaa[i + 1]} " class="math";align="absmiddle"> is constant. The level of the slope immediately below any particular gridpoint
is diÔ¨Äerent, of course, from the slope above that gridpoint, a fact which implies that the
derivative of <img 
src="SolvingMicroDSOPs207x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>`v(t‚àí 1)‚áÅ (at‚àí 1)  " class="math";align="absmiddle"> follows a step function.
<!--l. 267--><p class="indent" >  The solid-line step function in Figure <a 
href="#x1-150046">6<!--tex4ht:ref: fig:PlotuPrimeVSOPrime --></a> depicts the actual value of <img 
src="SolvingMicroDSOPs208x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span> a
`v(t‚àí1)‚áÅ(3 ‚àí c)  " class="math";align="absmiddle">. When we
attempt to Ô¨Ånd optimal values of <img 
src="SolvingMicroDSOPs209x.svg" alt="</span>c  " class="math";align="absmiddle"> given <img 
src="SolvingMicroDSOPs210x.svg" alt="</span>m  " class="math";align="absmiddle"> using <img 
src="SolvingMicroDSOPs211x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>`v(t‚àí 1)‚áÅ (at‚àí1)  " class="math";align="absmiddle">, the numerical
optimization routine will return the <img 
src="SolvingMicroDSOPs212x.svg" alt="</span>c  " class="math";align="absmiddle"> for which <img 
src="SolvingMicroDSOPs213x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>uc(c) = `va    (m ‚àí  c)
         (t‚àí1)‚áÅ  " class="math";align="absmiddle">. Thus, for <img 
src="SolvingMicroDSOPs214x.svg" alt="</span></span>m  = 3  " class="math";align="absmiddle">
the program will return the value of <img 
src="SolvingMicroDSOPs215x.svg" alt="</span>c  " class="math";align="absmiddle"> for which the downward-sloping <img 
src="SolvingMicroDSOPs216x.svg" alt="</span></span></span></span></span> c
u (c)  " class="math";align="absmiddle"> curve intersects
with the <img 
src="SolvingMicroDSOPs217x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>  a
`v(t‚àí1)‚áÅ (3 ‚àí c)  " class="math";align="absmiddle">; as the diagram shows, this value is exactly equal to 2.
Similarly, if we ask the routine to Ô¨Ånd the optimal <img 
src="SolvingMicroDSOPs218x.svg" alt="</span>c  " class="math";align="absmiddle"> for <img 
src="SolvingMicroDSOPs219x.svg" alt="</span></span>m  = 4  " class="math";align="absmiddle">, it Ô¨Ånds the point of
intersection of <img 
src="SolvingMicroDSOPs220x.svg" alt="</span></span></span></span></span>uc(c)  " class="math";align="absmiddle"> with <img 
src="SolvingMicroDSOPs221x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>`va     (4 ‚àí c)
 (t‚àí1)‚áÅ  " class="math";align="absmiddle">; and as the diagram shows, this intersection is
only slightly above 2. Hence, this Ô¨Ågure illustrates why the numerical consumption
function plotted earlier returned values very close to <img 
src="SolvingMicroDSOPs222x.svg" alt="</span></span>c = 2  " class="math";align="absmiddle"> for both <img 
src="SolvingMicroDSOPs223x.svg" alt="</span></span>m =  3  " class="math";align="absmiddle"> and
<img 
src="SolvingMicroDSOPs224x.svg" alt="</span></span>m  = 4  " class="math";align="absmiddle">.
<!--l. 280--><p class="indent" >  We would obviously obtain much better estimates of the point of intersection between
<img 
src="SolvingMicroDSOPs225x.svg" alt="</span></span></span></span></span>uc(c)  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs226x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>va    (m  ‚àí c)
 (t‚àí1)‚áÅ  " class="math";align="absmiddle"> if our estimate of <img 
src="SolvingMicroDSOPs227x.svg" alt="</span></span></span></span></span></span></span></span>`va
  (t‚àí1)‚áÅ   " class="math";align="absmiddle"> were not a step function. In fact, we
already know how to construct linear interpolations to functions, so the obvious next step is to
construct a linear interpolating approximation to the expected marginal value of end-of-period
assets function at the points in <img 
src="SolvingMicroDSOPs228x.svg" alt="</span></span></span>aaa " class="math";align="absmiddle">:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs229x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                ( 1 ) ‚àënùúÉ
va(t‚àí1)‚áÅ(aaa) = Œ≤R   ---      (‚Ñõtaaa + ùúÉi)‚àí œÅ
                 n ùúÉ  i=1
" class="math-display" ><a 
 id="x1-15005r31"></a></div>
  </td><td class="equation-label">(31)</td></tr></table>
<!--l. 283--><p class="nopar" >yielding <img 
src="SolvingMicroDSOPs230x.svg" alt="</span></span></span></span></span></span></span></span></span>vvva(t‚àí1)‚áÅ   " class="math";align="absmiddle"> (the vector of expected end-of-period-<img 
src="SolvingMicroDSOPs231x.svg" alt="</span></span></span></span>(T  ‚àí 1)  " class="math";align="absmiddle"> marginal values of assets
corresponding to <img 
src="SolvingMicroDSOPs232x.svg" alt="</span>aVec " class="math";align="absmiddle">), and construct <img 
src="SolvingMicroDSOPs233x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>`va     (at‚àí1)
 (t‚àí 1)‚áÅ  " class="math";align="absmiddle"> as the linear interpolating function
that Ô¨Åts this set of points.
<!--l. 289--><p class="indent" >  <a 
 id="PlotOPRawVSFOC"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-150067"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/PlotOPRawVSFOC.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†7: </span><span  
class="content"><img 
src="SolvingMicroDSOPs234x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>va     (at‚àí1)
 (t‚àí1)‚áÅ  " class="math";align="absmiddle"> versus <img 
src="SolvingMicroDSOPs235x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>`va    (at‚àí1)
 (t‚àí1)‚áÅ  " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-150067 -->
                                                                                        {Ô¨Åg:PlotOPRawVSFOC}
                                                                                     
                                                                                     
  </div>
<!--l. 298--><p class="indent" >  The results are shown in Figure <a 
href="#x1-150067">7<!--tex4ht:ref: fig:PlotOPRawVSFOC --></a>. The linear interpolating approximation looks roughly as
good (or bad) for the marginal value function as it was for the level of the value function.
However, Figure <a 
href="#x1-150078">8<!--tex4ht:ref: fig:PlotcTm1ABC --></a> shows that the new consumption function (long dashes) is a
considerably better approximation of the true consumption function (solid) than was the
consumption function obtained by approximating the level of the value function (short
dashes).
<!--l. 300--><p class="indent" >  <a 
 id="PlotcTm1ABC"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-150078"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/PlotcTm1ABC.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†8: </span><span  
class="content"><img 
src="SolvingMicroDSOPs236x.svg" alt="</span></span></span></span></span></span></span>ct‚àí1(m )  " class="math";align="absmiddle"> (solid) Versus Two Methods for Constructing <img 
src="SolvingMicroDSOPs237x.svg" alt="</span></span></span></span></span></span></span></span>`ct‚àí 1(m)  " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-150078 -->              {Ô¨Åg:PlotcTm1ABC}
                                                                                     
                                                                                     
  </div>
<!--l. 307--><p class="indent" >  <a 
 id="transformation"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.6  </span> <a 
 id="x1-160006.6"></a>Transformation</h4>                                                                  {subsec:transformation}
<!--l. 310--><p class="noindent" >Even the new-and-improved consumption function diverges notably from the true solution,
especially at lower values of <img 
src="SolvingMicroDSOPs238x.svg" alt="</span>m  " class="math";align="absmiddle">. That is because the linear interpolation does an
increasingly poor job of capturing the nonlinearity of <img 
src="SolvingMicroDSOPs239x.svg" alt="</span></span></span></span></span></span></span> a
v(t‚àí 1)‚áÅ   " class="math";align="absmiddle"> at lower and lower levels of
<img 
src="SolvingMicroDSOPs240x.svg" alt="</span>a  " class="math";align="absmiddle">.
<!--l. 312--><p class="indent" >  This is where we unveil our next trick. To understand the logic, start by considering the
case where <img 
src="SolvingMicroDSOPs241x.svg" alt="</span></span></span></span></span></span></span></span>‚Ñõ  =  Œ≤ = ùí¢  = 1
  t         t  " class="math";align="absmiddle"> and there is no uncertainty (that is, we know for sure that
income next period will be <img 
src="SolvingMicroDSOPs242x.svg" alt="</span></span></span>ùúÉt = 1  " class="math";align="absmiddle">). The Ô¨Ånal Euler equation (recall that we are still assuming
that <img 
src="SolvingMicroDSOPs243x.svg" alt="</span></span></span>t = T  " class="math";align="absmiddle">) is then:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs244x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span> ‚àí œÅ    ‚àíœÅ
ct‚àí1 = ct .
" class="math-display" ><a 
 id="x1-16001r32"></a></div>
  </td><td class="equation-label">(32)</td></tr></table>
<!--l. 315--><p class="nopar" >
<!--l. 317--><p class="indent" >  In the case we are now considering with no uncertainty and no liquidity constraints, the
optimizing consumer does not care whether a unit of income is scheduled to be received in the
future period <img 
src="SolvingMicroDSOPs245x.svg" alt="</span>t  " class="math";align="absmiddle"> or the current period <img 
src="SolvingMicroDSOPs246x.svg" alt="</span></span></span>t ‚àí 1  " class="math";align="absmiddle">; there is perfect certainty that the income
will be received, so the consumer treats its PDV as equivalent to a unit of current
wealth. Total resources available at the point when the consumption decision is
made is therefore comprised of two types: current market resources <img 
src="SolvingMicroDSOPs247x.svg" alt="</span>m  " class="math";align="absmiddle"> and ‚Äòhuman
wealth‚Äô (the PDV of future income) of <img 
src="SolvingMicroDSOPs248x.svg" alt="</span></span></span></span></span>ht‚àí1 = 1  " class="math";align="absmiddle"> (because it is the value of human
wealth as of the end of the period, there is only one more period of income of 1
left).
  <table 
class="equation"><tr><td>
  <div class="math-display" >
                                                                                     
                                                                                     
<img 
src="SolvingMicroDSOPs249x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>            (       ) ‚àíœÅ
vm(t‚àí1)(m ) =   m--+-1    .
                2
" class="math-display" ><a 
 id="x1-16002r33"></a></div>
  </td><td class="equation-label">(33)</td></tr></table>
<!--l. 321--><p class="nopar" >Of course, this is a highly nonlinear function. However, if we raise both sides of (<a 
href="#x1-16002r33">33<!--tex4ht:ref: eq:vPLin --></a>) to the
power <img 
src="SolvingMicroDSOPs250x.svg" alt="</span></span></span></span></span>(‚àí 1 ‚àïœÅ)  " class="math";align="absmiddle"> the result is a linear function:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs251x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>[         ]       m  + 1
 vm(t‚àí1)(m ) ‚àí1‚àïœÅ = ------.
                     2
" class="math-display" ><a 
 id="x1-16003r34"></a></div>
  </td><td class="equation-label">(34)</td></tr></table>
<!--l. 326--><p class="nopar" >This is a speciÔ¨Åc example of a general phenomenon: A theoretical literature discussed
in¬†<a 
href="#XckConcavity">Carroll and Kimball</a>¬†(<a 
href="#XckConcavity">1996</a>) establishes that under perfect certainty, if the period-by-period
marginal utility function is of the form <img 
src="SolvingMicroDSOPs252x.svg" alt="</span></span></span></span>c‚àítœÅ  " class="math";align="absmiddle">, the marginal value function will be of the form
<img 
src="SolvingMicroDSOPs253x.svg" alt="</span></span></span></span></span></span></span></span>(Œ≥m   + Œ∂)‚àíœÅ
    t  " class="math";align="absmiddle"> for some constants <img 
src="SolvingMicroDSOPs254x.svg" alt="</span></span></span>{Œ≥, Œ∂} " class="math";align="absmiddle">. This means that if we were solving the perfect
foresight problem numerically, we could always calculate a numerically exact (because linear)
interpolation.
<!--l. 329--><p class="indent" >  To put the key insight in intuitive terms, the nonlinearity we are facing springs in
large part from the fact that the marginal value function is highly nonlinear. But
we have a compelling solution to that problem, because the nonlinearity springs
largely from the fact that we are raising something to the power <img 
src="SolvingMicroDSOPs255x.svg" alt="</span></span>‚àí œÅ  " class="math";align="absmiddle">. In eÔ¨Äect,
we can ‚Äòunwind‚Äô all of the nonlinearity owing to that operation and the remaining
nonlinearity will not be nearly so great. SpeciÔ¨Åcally, applying the foregoing insights to the
end-of-period value function <img 
src="SolvingMicroDSOPs256x.svg" alt="</span></span></span></span></span></span></span></span></span>va   (a)
 (t‚àí1)  " class="math";align="absmiddle">, we can deÔ¨Åne an ‚Äòinverse marginal value‚Äô
function
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs257x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> a       ( a    ) ‚àí1‚àïœÅ
Œõt‚áÅ(a) ‚â°  vt‚áÅ (a )
" class="math-display" ><a 
 id="x1-16004r35"></a></div>
  </td><td class="equation-label">(35)</td></tr></table>
<!--l. 332--><p class="nopar" >which would be linear in the perfect foresight
case.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs10.html#fn9x0"><sup class="textsuperscript"><span 
class="ecrm-0600">9</span></sup></a></span><a 
 id="x1-16005f9"></a>  
We then construct a piecewise-linear interpolating approximation to the <img 
src="SolvingMicroDSOPs259x.svg" alt="</span></span></span> a
Œõt  " class="math";align="absmiddle"> function,
<img 
src="SolvingMicroDSOPs260x.svg" alt="</span></span></span></span></span></span></span></span></span> a
`Œõt‚áÅ (at)  " class="math";align="absmiddle">, and for any <img 
src="SolvingMicroDSOPs261x.svg" alt="</span>a  " class="math";align="absmiddle"> that falls in the range <img 
src="SolvingMicroDSOPs262x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>{aaa[1],aaa[‚àí 1]} " class="math";align="absmiddle"> we obtain our approximation of
marginal value from:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs263x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  a       a    ‚àíœÅ
`v t(a ) = [`Œõt(a)]
" class="math-display" ><a 
 id="x1-16007r36"></a></div>
  </td><td class="equation-label">(36)</td></tr></table>
<!--l. 337--><p class="nopar" >
<!--l. 339--><p class="indent" >  The most interesting thing about all of this, though, is that the <img 
src="SolvingMicroDSOPs264x.svg" alt="</span></span></span> a
Œõt  " class="math";align="absmiddle"> function has another
interpretation. Recall our point in (<a 
href="#x1-9007r23">23<!--tex4ht:ref: eq:upEqbetaOp --></a>) that <img 
src="SolvingMicroDSOPs265x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>uc(ct) = va‚áÅ (mt ‚àí ct)  " class="math";align="absmiddle">. Since with CRRA utility
<img 
src="SolvingMicroDSOPs266x.svg" alt="</span></span></span></span></span></span></span></span>uc(c) = c‚àíœÅ  " class="math";align="absmiddle">, this can be rewritten and inverted
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs267x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>   ‚àíœÅ    a
(ct)   = v‚áÅ (at)
    ct = (va (a))‚àí1‚àïœÅ .
          t‚áÅ
" class="math-display" ><a 
 id="x1-16008r37"></a></div>
  </td><td class="equation-label">(37)</td></tr></table>
<!--l. 344--><p class="nopar" >
                                                                                     
                                                                                     
<!--l. 346--><p class="indent" >  What this means is that for any given <img 
src="SolvingMicroDSOPs268x.svg" alt="</span>a  " class="math";align="absmiddle">, if we can calculate the marginal value associated
with ending the period with that <img 
src="SolvingMicroDSOPs269x.svg" alt="</span>a  " class="math";align="absmiddle">, then we can learn the level of <img 
src="SolvingMicroDSOPs270x.svg" alt="</span>c  " class="math";align="absmiddle"> that the
consumer must have chosen if they ended up with that <img 
src="SolvingMicroDSOPs271x.svg" alt="</span>a  " class="math";align="absmiddle"> as the result of an optimal
unconstrained choice. This leads us to an alternative interpretation of <img 
src="SolvingMicroDSOPs272x.svg" alt="</span></span>Œõa  " class="math";align="absmiddle">. It is the
function that reveals, for any ending <img 
src="SolvingMicroDSOPs273x.svg" alt="</span>a  " class="math";align="absmiddle">, how much the agent must have consumed to
(optimally) get to that <img 
src="SolvingMicroDSOPs274x.svg" alt="</span>a  " class="math";align="absmiddle">. We will therefore henceforth refer to it as the ‚Äòconsumed
function:‚Äô
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs275x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>           a
`ct‚áÅ(at) ‚â° `Œõt‚áÅ (at).
" class="math-display" ><a 
 id="x1-16009r38"></a></div>
  </td><td class="equation-label">(38)</td></tr></table>
<!--l. 349--><p class="nopar" >
<!--l. 352--><p class="indent" >  Thus, for example, for period <img 
src="SolvingMicroDSOPs276x.svg" alt="</span></span></span>t ‚àí 1  " class="math";align="absmiddle"> our procedure is to calculate the vector of <img 
src="SolvingMicroDSOPs277x.svg" alt="</span></span></span>ccc " class="math";align="absmiddle"> points on
the consumed function:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs278x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>ccc = c(t‚àí1)‚áÅ(aaa )
" class="math-display" ><a 
 id="x1-16010r39"></a></div>
  </td><td class="equation-label">(39)</td></tr></table>
<!--l. 355--><p class="nopar" >with the idea that we will construct an approximation of the consumed function <img 
src="SolvingMicroDSOPs279x.svg" alt="</span></span></span></span></span></span></span></span></span></span>`c      (a )
 (t‚àí 1)‚áÅ  " class="math";align="absmiddle"> as
the interpolating function connecting these <img 
src="SolvingMicroDSOPs280x.svg" alt="</span></span></span></span></span></span></span></span></span>{aaa,ccc } " class="math";align="absmiddle"> points.
<!--l. 358--><p class="indent" >  <a 
 id="the-natural-borrowing-constraint-and-the-a-lower-bound"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.7  </span> <a 
 id="x1-170006.7"></a>The Natural Borrowing Constraint and the <img 
src="SolvingMicroDSOPs281x.svg" alt="</span></span></span></span>at‚àí1   " class="math";align="absmiddle"> Lower Bound</h4>                  {subsec:LiqConstrSelfImposed}
<!--l. 362--><p class="noindent" >This is the appropriate moment to ask an awkward question: How should an interpolated,
approximated ‚Äòconsumed‚Äô function like <img 
src="SolvingMicroDSOPs282x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>`c     (a   )
 (t‚àí1)‚áÅ   t‚àí1  " class="math";align="absmiddle"> be extrapolated to return an
                                                                                     
                                                                                     
estimated ‚Äòconsumed‚Äô amount when evaluated at an <img 
src="SolvingMicroDSOPs283x.svg" alt="</span></span></span></span>at‚àí1   " class="math";align="absmiddle"> outside the range spanned by
<img 
src="SolvingMicroDSOPs284x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>{aaa [1],...,aaa[n]} " class="math";align="absmiddle">?
<!--l. 365--><p class="indent" >  For most canned piecewise-linear interpolation tools like  <a 
href="https://docs.scipy.org/doc/scipy/tutorial/interpolate.html" >scipy.interpolate</a>, when the
‚Äòinterpolating‚Äô function is evaluated at a point outside the provided range, the algorithm
extrapolates under the assumption that the slope of the function remains constant
beyond its measured boundaries (that is, the slope is assumed to be equal to the
slope of nearest piecewise segment within the interpolated range); for example, if
the bottommost gridpoint is <img 
src="SolvingMicroDSOPs285x.svg" alt="</span></span></span></span></span></span></span>a1 = aaa[1]  " class="math";align="absmiddle"> and the corresponding consumed level is
<img 
src="SolvingMicroDSOPs286x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>c1 = c(t‚àí 1)‚áÅ (a1 )  " class="math";align="absmiddle"> we could calculate the ‚Äòmarginal propensity to have consumed‚Äô
<img 
src="SolvingMicroDSOPs287x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>       a
œ∞1 =  `c(t‚àí1)‚áÅ(a1)  " class="math";align="absmiddle"> and construct the approximation as the linear extrapolation below <img 
src="SolvingMicroDSOPs288x.svg" alt="</span></span></span></span>aaa[1]  " class="math";align="absmiddle">
from:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs289x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>`c(t‚àí1)‚áÅ(a) ‚â° c1 + (a ‚àí a1)œ∞1.
" class="math-display" ><a 
 id="x1-17001r40"></a></div>
  </td><td class="equation-label">(40)</td></tr></table>
<!--l. 369--><p class="nopar" >
<!--l. 371--><p class="indent" >  To see that this will lead us into diÔ¨Éculties, consider what happens to the true (not
approximated) <img 
src="SolvingMicroDSOPs290x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>  a
v(t‚àí1)‚áÅ (at‚àí1)  " class="math";align="absmiddle"> as <img 
src="SolvingMicroDSOPs291x.svg" alt="</span></span></span></span>at‚àí 1   " class="math";align="absmiddle"> approaches a quantity we will call the ‚Äònatural
borrowing constraint‚Äô: <img 
src="SolvingMicroDSOPs292x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span>at‚àí 1 = ‚àí ùúÉ‚Ñõ ‚àít1  " class="math";align="absmiddle">. From (<a 
href="#x1-15005r31">31<!--tex4ht:ref: eq:vEndPrimeTm1 --></a>) we have
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs293x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                          (    )  nùúÉ
 lim  va     (a) =  lim  Œ≤R   -1-  ‚àë  (a ‚Ñõ +  ùúÉ)‚àíœÅ .
a‚Üìat‚àí1 (t‚àí1)‚áÅ       a‚Üìat‚àí1     n ùúÉ         t    i
                                 i=1
" class="math-display" ><a 
 id="x1-17002r41"></a></div>
  </td><td class="equation-label">(41)</td></tr></table>
<!--l. 376--><p class="nopar" >
                                                                                     
                                                                                     
<!--l. 378--><p class="indent" >  But since <img 
src="SolvingMicroDSOPs294x.svg" alt="</span></span></span></span>ùúÉ-=  ùúÉ1   " class="math";align="absmiddle">, exactly at <img 
src="SolvingMicroDSOPs295x.svg" alt="</span></span></span></span></span></span>a = at‚àí1   " class="math";align="absmiddle"> the Ô¨Årst term in the summation would be
<img 
src="SolvingMicroDSOPs296x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>(‚àí ùúÉ-+ ùúÉ1)‚àíœÅ = 1‚àï0œÅ  " class="math";align="absmiddle"> which is inÔ¨Ånity. The reason is simple: <img 
src="SolvingMicroDSOPs297x.svg" alt="</span></span></span></span></span>‚àí at‚àí1   " class="math";align="absmiddle"> is the PDV, as of <img 
src="SolvingMicroDSOPs298x.svg" alt="</span></span></span>t ‚àí 1  " class="math";align="absmiddle">,
of the minimum possible realization of income in <img 
src="SolvingMicroDSOPs299x.svg" alt="</span>t  " class="math";align="absmiddle"> (<img 
src="SolvingMicroDSOPs300x.svg" alt="</span></span></span></span></span></span></span></span></span></span>‚Ñõta--  =  ‚àí ùúÉ1
    t‚àí 1   " class="math";align="absmiddle">). Thus, if the consumer
borrows an amount greater than or equal to <img 
src="SolvingMicroDSOPs301x.svg" alt="</span></span></span></span></span>ùúÉ‚Ñõ ‚àí1
-- t  " class="math";align="absmiddle"> (that is, if the consumer ends <img 
src="SolvingMicroDSOPs302x.svg" alt="</span></span></span>t ‚àí 1  " class="math";align="absmiddle"> with
<img 
src="SolvingMicroDSOPs303x.svg" alt="</span></span></span></span></span></span></span></span></span></span>            ‚àí1
at‚àí1 ‚â§ ‚àí ùúÉ‚Ñõ t  " class="math";align="absmiddle">) and then draws the worst possible income shock in period <img 
src="SolvingMicroDSOPs304x.svg" alt="</span>t  " class="math";align="absmiddle">, they will
have to consume zero in period <img 
src="SolvingMicroDSOPs305x.svg" alt="</span>t  " class="math";align="absmiddle">, which yields <img 
src="SolvingMicroDSOPs306x.svg" alt="</span>‚àí ‚àû " class="math";align="absmiddle"> utility and <img 
src="SolvingMicroDSOPs307x.svg" alt="</span></span>+ ‚àû " class="math";align="absmiddle"> marginal
utility.
<!--l. 380--><p class="indent" >  As <a 
href="#XzeldesStochastic">Zeldes</a>¬†(<a 
href="#XzeldesStochastic">1989</a>) Ô¨Årst noticed, this means that the consumer faces a ‚Äòself-imposed‚Äô (or, as
above, ‚Äònatural‚Äô) borrowing constraint (which springs from the precautionary motive):
They will never borrow an amount greater than or equal to <img 
src="SolvingMicroDSOPs308x.svg" alt="</span></span></span></span></span>  ‚àí 1
ùúÉ‚Ñõt  " class="math";align="absmiddle"> (that is, assets
will never reach the lower bound of <img 
src="SolvingMicroDSOPs309x.svg" alt="</span></span></span></span>at‚àí1   " class="math";align="absmiddle">). The constraint is ‚Äòself-imposed‚Äô in the
precise sense that if the utility function were diÔ¨Äerent (say, Constant Absolute Risk
Aversion), the consumer might be willing to borrow more than <img 
src="SolvingMicroDSOPs310x.svg" alt="</span></span></span></span></span>ùúÉ‚Ñõ ‚àí1
   t  " class="math";align="absmiddle"> because a choice
of zero or negative consumption in period <img 
src="SolvingMicroDSOPs311x.svg" alt="</span>t  " class="math";align="absmiddle"> would yield some Ô¨Ånite amount of
utility.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs11.html#fn10x0"><sup class="textsuperscript"><span 
class="ecrm-0600">10</span></sup></a></span><a 
 id="x1-17003f10"></a>  
<!--l. 383--><p class="indent" >  This self-imposed constraint cannot be captured well when the <img 
src="SolvingMicroDSOPs312x.svg" alt="</span></span></span></span></span></span></span>va(t‚àí 1)‚áÅ   " class="math";align="absmiddle"> function is
approximated by a piecewise linear function like <img 
src="SolvingMicroDSOPs313x.svg" alt="</span></span></span></span></span></span></span></span>`vm(t‚àí 1)‚áÅ   " class="math";align="absmiddle">, because it is impossible for the
linear extrapolation below <img 
src="SolvingMicroDSOPs314x.svg" alt="</span>a
--  " class="math";align="absmiddle"> to correctly predict <img 
src="SolvingMicroDSOPs315x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>va    (a   ) = ‚àû.
 (t‚àí1)‚áÅ -t‚àí1  " class="math";align="absmiddle">
<!--l. 388--><p class="indent" >  So, the marginal value of saving approaches inÔ¨Ånity as <img 
src="SolvingMicroDSOPs316x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>               ‚àí 1
a ‚Üì at‚àí1 = ‚àí ùúÉ‚Ñõt  " class="math";align="absmiddle">. But this implies
that <img 
src="SolvingMicroDSOPs317x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>lima‚Üìat‚àí1 c(t‚àí 1)‚áÅ (a ) = (va(t‚àí1)‚áÅ (a))‚àí1‚àïœÅ = 0  " class="math";align="absmiddle">; that is, as <img 
src="SolvingMicroDSOPs318x.svg" alt="</span>a  " class="math";align="absmiddle"> approaches its ‚Äònatural
borrowing constraint‚Äô minimum possible value, the corresponding amount of worst-case <img 
src="SolvingMicroDSOPs319x.svg" alt="</span>c  " class="math";align="absmiddle">
must approach its lower bound: zero.
<!--l. 390--><p class="indent" >  The upshot is a realization that all we need to do to address these problems is to prepend
each of the <img 
src="SolvingMicroDSOPs320x.svg" alt="</span></span></span></span></span></span>aaat‚àí1  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs321x.svg" alt="</span></span></span></span></span></span>ccct‚àí 1  " class="math";align="absmiddle"> from (<a 
href="#x1-16010r39">39<!--tex4ht:ref: eq:consumedfnvecs --></a>) with an extra point so that the Ô¨Årst element in the
mapping that produces our interpolation function is <img 
src="SolvingMicroDSOPs322x.svg" alt="</span></span></span></span></span></span></span></span></span>{at‚àí1,0.} " class="math";align="absmiddle">. This is done in section ‚ÄúThe
Self-Imposed ‚ÄòNatural‚Äô Borrowing Constraint and the <img 
src="SolvingMicroDSOPs323x.svg" alt="</span></span></span></span>at‚àí1   " class="math";align="absmiddle"> Lower Bound‚Äù of the
notebook.
  <div class="marginpar">
<!--l. 392--><p class="indent" >  The vertical axis should be relabeled - not gothic c anymore, instead <img 
src="SolvingMicroDSOPs324x.svg" alt="</span></span>Œõa  " class="math";align="absmiddle"></div>
<!--l. 394--><p class="indent" >  <a 
 id="GothVInvVSGothC"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-170059"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/GothVInvVSGothC.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†9: </span><span  
class="content">True <img 
src="SolvingMicroDSOPs325x.svg" alt="</span></span></span></span></span></span></span></span></span></span>Œõa    (a)
 (t‚àí1)‚áÅ  " class="math";align="absmiddle"> vs its approximation <img 
src="SolvingMicroDSOPs326x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span>`Œõa     (a)
 (t‚àí 1)‚áÅ  " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-170059 -->
                                                                                        {Ô¨Åg:GothVInvVSGothC}
                                                                                     
                                                                                     
  </div>
<!--l. 402--><p class="indent" >  Figure <a 
href="#x1-170059">9<!--tex4ht:ref: fig:GothVInvVSGothC --></a> shows the result. The solid line calculates the exact numerical value of the
consumed function <img 
src="SolvingMicroDSOPs327x.svg" alt="</span></span></span></span></span></span></span></span></span>c(t‚àí 1) (a)
     ‚áÅ  " class="math";align="absmiddle"> while the dashed line is the linear interpolating approximation
<img 
src="SolvingMicroDSOPs328x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span>`c      (a).
 (t‚àí 1)‚áÅ  " class="math";align="absmiddle"> This Ô¨Ågure illustrates the value of the transformation: The true function is close
to linear, and so the linear approximation is almost indistinguishable from the true function
except at the very lowest values of <img 
src="SolvingMicroDSOPs329x.svg" alt="</span>a  " class="math";align="absmiddle">.
<!--l. 404--><p class="indent" >  Figure¬†<a 
href="#x1-1700810">10<!--tex4ht:ref: fig:GothVVSGothCInv --></a> similarly shows that when we generate <img 
src="SolvingMicroDSOPs330x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>``va(t‚àí 1)‚áÅ (a)  " class="math";align="absmiddle"> using our augmented <img 
src="SolvingMicroDSOPs331x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>[`c(t‚àí1)‚áÅ (a)]‚àí œÅ  " class="math";align="absmiddle">
(dashed line) we obtain a much closer approximation to the true marginal value function <img 
src="SolvingMicroDSOPs332x.svg" alt="</span></span></span></span></span></span></span></span></span></span>va     (a)
 (t‚àí1)‚áÅ  " class="math";align="absmiddle">
(solid line) than we obtained in the previous exercise which did not do the transformation
(Figure¬†<a 
href="#x1-150067">7<!--tex4ht:ref: fig:PlotOPRawVSFOC --></a>).<span class="footnote-mark"><a 
href="SolvingMicroDSOPs12.html#fn11x0"><sup class="textsuperscript"><span 
class="ecrm-0600">11</span></sup></a></span><a 
 id="x1-17006f11"></a>  
  <div class="marginpar">
<!--l. 407--><p class="indent" >  Ô¨Åx the problem articulated in the footnote</div>
<!--l. 409--><p class="indent" >  <a 
 id="GothVVSGothCInv"></a>  <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-1700810"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                          <img 
src="./Figures/GothVVSGothCInv.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†10: </span><span  
class="content">True <img 
src="SolvingMicroDSOPs335x.svg" alt="</span></span></span></span></span></span></span></span></span></span>va    (a)
 (t‚àí1)‚áÅ  " class="math";align="absmiddle"> vs. <img 
src="SolvingMicroDSOPs336x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>``va     (a )
 (t‚àí 1)‚áÅ  " class="math";align="absmiddle"> Constructed Using <img 
src="SolvingMicroDSOPs337x.svg" alt="</span></span></span></span></span></span></span></span></span></span>`c(t‚àí1) (a)
     ‚áÅ  " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-1700810 -->
                                                                                        {Ô¨Åg:GothVVSGothCInv}
                                                                                     
                                                                                     
  </div>
<!--l. 416--><p class="indent" >  <a 
 id="the-method-of-endogenous-gridpoints"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.8  </span> <a 
 id="x1-180006.8"></a>The Method of Endogenous Gridpoints (‚ÄòEGM‚Äô)</h4>                                 {subsec:egm}
<!--l. 419--><p class="noindent" >The solution procedure above for Ô¨Ånding <img 
src="SolvingMicroDSOPs338x.svg" alt="</span></span></span></span></span></span></span>ct‚àí 1(m )  " class="math";align="absmiddle"> still requires us, for each point in <img 
src="SolvingMicroDSOPs339x.svg" alt="</span></span></span></span></span></span>mmmt‚àí 1  " class="math";align="absmiddle">,
to use a numerical rootÔ¨Ånding algorithm to search for the value of <img 
src="SolvingMicroDSOPs340x.svg" alt="</span>c  " class="math";align="absmiddle"> that solves
<img 
src="SolvingMicroDSOPs341x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> c       a
u (c) = v(t‚àí 1)‚áÅ (m ‚àí c)  " class="math";align="absmiddle">. Though sections <a 
href="#x1-160006.6">6.6<!--tex4ht:ref: subsec:transformation --></a> and <a 
href="#x1-170006.7">6.7<!--tex4ht:ref: subsec:LiqConstrSelfImposed --></a> developed a highly eÔ¨Écient and
accurate procedure to calculate <img 
src="SolvingMicroDSOPs342x.svg" alt="</span></span></span></span></span></span></span></span>`va(t‚àí1)‚áÅ   " class="math";align="absmiddle">, those approximations do nothing to eliminate
the need for using a rootÔ¨Ånding operation for calculating, for an arbitrary <img 
src="SolvingMicroDSOPs343x.svg" alt="</span>m  " class="math";align="absmiddle">, the
optimal <img 
src="SolvingMicroDSOPs344x.svg" alt="</span>c  " class="math";align="absmiddle">. And rootÔ¨Ånding is a notoriously computation-intensive (that is, slow!)
operation.
<!--l. 421--><p class="indent" >  Fortunately, it turns out that there is a way to completely skip this slow rootÔ¨Ånding step.
The method can be understood by noting that we have already calculated, for a set of
arbitrary values of <img 
src="SolvingMicroDSOPs345x.svg" alt="</span></span></span></span></span></span></span></span></span></span>aaa = aaat‚àí 1  " class="math";align="absmiddle">, the corresponding <img 
src="SolvingMicroDSOPs346x.svg" alt="</span></span></span>ccc " class="math";align="absmiddle"> values for which this <img 
src="SolvingMicroDSOPs347x.svg" alt="</span></span></span>aaa " class="math";align="absmiddle"> is
optimal.
<!--l. 423--><p class="indent" >  But with mutually consistent values of <img 
src="SolvingMicroDSOPs348x.svg" alt="</span></span></span></span></span></span>ccct‚àí1  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs349x.svg" alt="</span></span></span></span></span></span>aaat‚àí1  " class="math";align="absmiddle"> (consistent, in the sense that they
are the unique optimal values that correspond to the solution to the problem), we can obtain
the <img 
src="SolvingMicroDSOPs350x.svg" alt="</span></span></span></span></span></span>mmmt‚àí1  " class="math";align="absmiddle"> vector that corresponds to both of them from
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs351x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>mmmt‚àí1 = ccct‚àí 1 + aaat‚àí1.
" class="math-display" ><a 
 id="x1-18001r42"></a></div>
  </td><td class="equation-label">(42)</td></tr></table>
<!--l. 426--><p class="nopar" >
  <div class="marginpar">
<!--l. 428--><p class="indent" >  Rename gothic class to: EndPrd. Also, harmonize the notation in the notebook to that in the notes - for example, everwhere in the text we use
cNrm=lower case letter c for normalized consumption, but for some reason it is capital C in the gothic function.</div>
  <div class="marginpar">
<!--l. 430--><p class="indent" >  Ô¨Åx the problem articulated in the footnote</div>
<!--l. 432--><p class="indent" >  These <img 
src="SolvingMicroDSOPs352x.svg" alt="</span>m  " class="math";align="absmiddle"> gridpoints are ‚Äúendogenous‚Äù in contrast to the usual solution method of
specifying some ex-ante (exogenous) grid of values of <img 
src="SolvingMicroDSOPs353x.svg" alt="</span></span></span>mmm " class="math";align="absmiddle"> and then using a rootÔ¨Ånding routine
to locate the corresponding optimal consumption vector <img 
src="SolvingMicroDSOPs354x.svg" alt="</span></span></span>ccc " class="math";align="absmiddle">.
<!--l. 434--><p class="indent" >  This routine is performed in the ‚ÄúEndogenous Gridpoints‚Äù section of the notebook. First,
the gothic.C_Tminus1 function is called for each of the pre-specÔ¨Åed values of end-of-period
assets stored in <img 
src="SolvingMicroDSOPs355x.svg" alt="</span>aVec " class="math";align="absmiddle">. These values of consumption and assets are used to produce the
                                                                                     
                                                                                     
list of endogenous gridpoints, stored in the object mVec_egm. With the <img 
src="SolvingMicroDSOPs356x.svg" alt="</span></span></span>ccc  " class="math";align="absmiddle"> values
in hand, the notebook can generate a set of <img 
src="SolvingMicroDSOPs357x.svg" alt="</span></span></span></span></span></span>mmmt‚àí1  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs358x.svg" alt="</span></span></span></span></span></span>ccct‚àí1  " class="math";align="absmiddle"> pairs that can be
interpolated between in order to yield <img 
src="SolvingMicroDSOPs359x.svg" alt="</span></span></span></span></span></span></span></span></span>`c(t‚àí1)(m )  " class="math";align="absmiddle"> at virtually zero computational
cost!<span class="footnote-mark"><a 
href="SolvingMicroDSOPs13.html#fn12x0"><sup class="textsuperscript"><span 
class="ecrm-0600">12</span></sup></a></span><a 
 id="x1-18002f12"></a>  
<!--l. 436--><p class="indent" >  <a 
 id="PlotComparecTm1AD"></a> One might worry about whether the <img 
src="SolvingMicroDSOPs360x.svg" alt="</span></span></span>{m,  c} " class="math";align="absmiddle"> points obtained in this way will provide a
good representation of the consumption function as a whole, but in practice there are good
reasons why they work well (basically, this procedure generates a set of gridpoints that is
naturally dense right around the parts of the function with the greatest nonlinearity).
<div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-1800411"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/PlotComparecTm1AD.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†11: </span><span  
class="content"><img 
src="SolvingMicroDSOPs361x.svg" alt="</span></span></span></span></span></span></span>ct‚àí1(m )  " class="math";align="absmiddle"> (solid) versus <img 
src="SolvingMicroDSOPs362x.svg" alt="</span></span></span></span></span></span></span></span>`ct‚àí 1(m )  " class="math";align="absmiddle"> (dashed)</span></figcaption><!--tex4ht:label?: x1-1800411 -->                                   {Ô¨Åg:ComparecTm1AD}
                                                                                     
                                                                                     
  </div>
<!--l. 443--><p class="indent" >  Figure¬†<a 
href="#x1-1800411">11<!--tex4ht:ref: fig:ComparecTm1AD --></a> plots the actual consumption function <img 
src="SolvingMicroDSOPs363x.svg" alt="</span></span></span></span>ct‚àí 1   " class="math";align="absmiddle"> and the approximated consumption
function <img 
src="SolvingMicroDSOPs364x.svg" alt="</span></span></span></span></span>`ct‚àí1   " class="math";align="absmiddle"> derived by the method of endogenous grid points. Compared to the
approximate consumption functions illustrated in Figure¬†<a 
href="#x1-150078">8<!--tex4ht:ref: fig:PlotcTm1ABC --></a>, <img 
src="SolvingMicroDSOPs365x.svg" alt="</span></span></span></span></span>`c
 t‚àí1   " class="math";align="absmiddle"> is quite close to the actual
consumption function.
<!--l. 445--><p class="indent" >  <a 
 id="improving-the-a-grid"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.9  </span> <a 
 id="x1-190006.9"></a>Improving the <img 
src="SolvingMicroDSOPs366x.svg" alt="</span>a  " class="math";align="absmiddle"> Grid</h4>                                                          {subsec:improving-the-a-grid}
<!--l. 448--><p class="noindent" >Thus far, we have arbitrarily used <img 
src="SolvingMicroDSOPs367x.svg" alt="</span>a  " class="math";align="absmiddle"> gridpoints of <img 
src="SolvingMicroDSOPs368x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>{0.,1.,2.,3.,4.} " class="math";align="absmiddle"> (augmented in the last
subsection by <img 
src="SolvingMicroDSOPs369x.svg" alt="</span></span></span></span>a
-t‚àí1   " class="math";align="absmiddle">). But it has been obvious from the Ô¨Ågures that the approximated <img 
src="SolvingMicroDSOPs370x.svg" alt="</span></span></span></span></span></span></span>`c
 (t‚àí1)‚áÅ   " class="math";align="absmiddle">
function tends to be farthest from its true value at low values of <img 
src="SolvingMicroDSOPs371x.svg" alt="</span>a  " class="math";align="absmiddle">. Combining this
with our insight that <img 
src="SolvingMicroDSOPs372x.svg" alt="</span></span></span></span>at‚àí 1   " class="math";align="absmiddle"> is a lower bound, we are now in position to deÔ¨Åne a
more deliberate method for constructing gridpoints for <img 
src="SolvingMicroDSOPs373x.svg" alt="</span>a  " class="math";align="absmiddle"> ‚Äì a method that yields
values that are more densely spaced at low values of <img 
src="SolvingMicroDSOPs374x.svg" alt="</span>a  " class="math";align="absmiddle"> where the function is more
nonlinear.
<!--l. 450--><p class="indent" >  A pragmatic choice that works well is to Ô¨Ånd the values such that (1) the last value exceeds
the lower bound by the same amount <img 
src="SolvingMicroDSOPs375x.svg" alt="</span></span>¬Øa  " class="math";align="absmiddle"> as our original maximum gridpoint (in our case, 4.);
(2) we have the same number of gridpoints as before; and (3) the multi-exponential growth rate
(that is, <img 
src="SolvingMicroDSOPs376x.svg" alt="</span></span></span></span>  ...
eee   " class="math";align="absmiddle"> for some number of exponentiations <img 
src="SolvingMicroDSOPs377x.svg" alt="</span>n  " class="math";align="absmiddle"> ‚Äì our default is 3) from each point to
the next point is constant (instead of, as previously, imposing constancy of the absolute gap
between points).
<!--l. 452--><p class="indent" >  <a 
 id="GothVInvVSGothCEEE"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-1900112"></a>
                                                                                     
                                                                                     
<div  
class="centerline">                                         <img 
src="./Figures/GothVInvVSGothCEEE.png" alt="pict"  
 width="433.62pt" >                                         </div>
<figcaption class="caption" ><span class="id">Figure¬†12: </span><span  
class="content"><img 
src="SolvingMicroDSOPs378x.svg" alt="</span></span></span></span></span></span></span></span></span>c(t‚àí1) (a)
     ‚áÅ  " class="math";align="absmiddle"> versus <img 
src="SolvingMicroDSOPs379x.svg" alt="</span></span></span></span></span></span></span></span></span></span>`c(t‚àí1) (a)
     ‚áÅ  " class="math";align="absmiddle">, Multi-Exponential <img 
src="SolvingMicroDSOPs380x.svg" alt="</span>aVec " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-1900112 -->
                                                                                        {Ô¨Åg:GothVInvVSGothCEE}
                                                                                     
                                                                                     
  </div>
<!--l. 461--><p class="indent" >  <a 
 id="GothVVSGothCInvEEE"></a>  <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-1900213"></a>
                                                                                     
                                                                                     
<!--l. 463--><p class="noindent" > <img 
src="./Figures/GothVVSGothCInvEEE.png" alt="pict"  
 width="433.62pt" >
<figcaption class="caption" ><span class="id">Figure¬†13: </span><span  
class="content"><img 
src="SolvingMicroDSOPs381x.svg" alt="</span></span></span></span></span></span></span></span></span></span>va(t‚àí1)‚áÅ (a)  " class="math";align="absmiddle"> vs. <img 
src="SolvingMicroDSOPs382x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>``va(t‚àí1)‚áÅ(a)  " class="math";align="absmiddle">, Multi-Exponential <img 
src="SolvingMicroDSOPs383x.svg" alt="</span>aVec " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-1900213 -->
                                                                                        {Ô¨Åg:GothVVSGothCInvEE}
                                                                                     
                                                                                     
  </div>
<!--l. 469--><p class="indent" >  Section ‚ÄúImprove the <img 
src="SolvingMicroDSOPs384x.svg" alt="</span></span>Ggrid  " class="math";align="absmiddle">‚Äù begins by deÔ¨Åning a function which takes as arguments the
speciÔ¨Åcations of an initial grid of assets and returns the new grid incorporating the
multi-exponential approach outlined above.
<!--l. 472--><p class="indent" >  Notice that the graphs depicted in Figures¬†<a 
href="#x1-1900112">12<!--tex4ht:ref: fig:GothVInvVSGothCEE --></a> and <a 
href="#x1-1900213">13<!--tex4ht:ref: fig:GothVVSGothCInvEE --></a> are notably closer to their respective
truths than the corresponding Ô¨Ågures that used the original grid.
  <h4 class="subsectionHead"><span class="titlemark">6.10  </span> <a 
 id="x1-200006.10"></a>Program Structure</h4>
<!--l. 476--><p class="noindent" >In section ‚ÄúSolve for <img 
src="SolvingMicroDSOPs385x.svg" alt="</span></span></span></span></span>ct(m )  " class="math";align="absmiddle"> in Multiple Periods,‚Äù the natural and artiÔ¨Åcial borrowing
constraints are combined with the endogenous gridpoints method to approximate the optimal
consumption function for a speciÔ¨Åc period. Then, this function is used to compute the
approximated consumption in the previous period, and this process is repeated for some
speciÔ¨Åed number of periods.
<!--l. 478--><p class="indent" >  The essential structure of the program is a loop that iteratively solves for consumption
functions by working backward from an assumed Ô¨Ånal period, using the dictionary
cFunc_life to store the interpolated consumption functions up to the beginning period.
Consumption in a given period is utilized to determine the endogenous gridpoints for the
preceding period. This is the sense in which the computation of optimal consumption is done
recursively.
<!--l. 480--><p class="indent" >  For a realistic life cycle problem, it would also be necessary at a minimum to calibrate a
nonconstant path of expected income growth over the lifetime that matches the empirical
proÔ¨Åle; allowing for such a calibration is the reason we have included the <img 
src="SolvingMicroDSOPs386x.svg" alt="</span></span></span>{ùí¢ }Tt  " class="math";align="absmiddle"> vector in our
computational speciÔ¨Åcation of the problem.
<!--l. 486--><p class="indent" >  <a 
 id="results"></a>
  <h4 class="subsectionHead"><span class="titlemark">6.11  </span> <a 
 id="x1-210006.11"></a>Results</h4>
<!--l. 489--><p class="noindent" >The code creates the relevant <img 
src="SolvingMicroDSOPs387x.svg" alt="</span></span></span></span></span></span>`ct(m )  " class="math";align="absmiddle"> functions for any period in the horizon, at the given
values of <img 
src="SolvingMicroDSOPs388x.svg" alt="</span>m  " class="math";align="absmiddle">. Figure <a 
href="#x1-2100114">14<!--tex4ht:ref: fig:PlotCFuncsConverge --></a> shows <img 
src="SolvingMicroDSOPs389x.svg" alt="</span></span></span></span></span></span></span></span>`cT‚àín (m )  " class="math";align="absmiddle"> for <img 
src="SolvingMicroDSOPs390x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span>n = {20, 15,10,5,1} " class="math";align="absmiddle">. At least one
feature of this Ô¨Ågure is encouraging: the consumption functions converge as the
horizon extends, something that <a 
href="#XBufferStockTheory">Carroll</a>¬†(<a 
href="#XBufferStockTheory">2023b</a>) shows must be true under certain
parametric conditions that are satisÔ¨Åed by the baseline parameter values being used
here.
<!--l. 491--><p class="indent" >  <a 
 id="PlotCFuncsConverge"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-2100114"></a>
                                                                                     
                                                                                     
<!--l. 493--><p class="noindent" > <img 
src="./Figures/PlotCFuncsConverge.png" alt="pict"  
 width="433.62pt" >
<figcaption class="caption" ><span class="id">Figure¬†14: </span><span  
class="content">Converging <img 
src="SolvingMicroDSOPs391x.svg" alt="</span></span></span></span></span></span></span></span>`cT‚àí n(m )  " class="math";align="absmiddle"> Functions as <img 
src="SolvingMicroDSOPs392x.svg" alt="</span>n  " class="math";align="absmiddle"> Increases</span></figcaption><!--tex4ht:label?: x1-2100114 -->                             {Ô¨Åg:PlotCFuncsConverge}
                                                                                     
                                                                                     
  </div>
<!--l. 5--><p class="indent" >  <a 
 id="the-infinite-horizon"></a>
  <h3 class="sectionHead"><span class="titlemark">7  </span> <a 
 id="x1-220007"></a>The InÔ¨Ånite Horizon</h3>                                                              {sec:the-inÔ¨Ånite-horizon}
<!--l. 8--><p class="noindent" >All of the solution methods presented so far have involved period-by-period iteration from an
assumed last period of life, as is appropriate for life cycle problems. However, if the parameter
values for the problem satisfy certain conditions (detailed in <a 
href="#XBufferStockTheory">Carroll</a>¬†(<a 
href="#XBufferStockTheory">2023b</a>)), the
consumption rules (and the rest of the problem) will converge to a Ô¨Åxed rule as the
horizon (remaining lifetime) gets large, as illustrated in Figure¬†<a 
href="#x1-2100114">14<!--tex4ht:ref: fig:PlotCFuncsConverge --></a>. Furthermore,
Deaton¬†(<a 
href="#XdeatonLiqConstr">1991</a>), Carroll¬†(<a 
href="#Xcarroll:brookings">1992</a>;¬†<a 
href="#XcarrollBSLCPIH">1997</a>) and others have argued that the ‚ÄòbuÔ¨Äer-stock‚Äô saving
behavior that emerges under some further restrictions on parameter values is a good
approximation of the behavior of typical consumers over much of the lifetime. Methods for
Ô¨Ånding the converged functions are therefore of interest, and are dealt with in this
section.
<!--l. 10--><p class="indent" >  Of course, the simplest such method is to solve the problem as speciÔ¨Åed above for a large
number of periods. This is feasible, but there are much faster methods.
<!--l. 14--><p class="indent" >  <a 
 id="convergence"></a>
  <h4 class="subsectionHead"><span class="titlemark">7.1  </span> <a 
 id="x1-230007.1"></a>Convergence</h4>                                                                    {subsec:convergence}
<!--l. 17--><p class="noindent" >In solving an inÔ¨Ånite-horizon problem, it is necessary to have some metric that determines
when to stop because a solution that is ‚Äògood enough‚Äô has been found.
<!--l. 21--><p class="indent" >  A natural metric is deÔ¨Åned by the unique ‚Äòtarget‚Äô level of wealth that <a 
href="#XBufferStockTheory">Carroll</a>¬†(<a 
href="#XBufferStockTheory">2023b</a>)
proves will exist in problems of this kind  <a 
href="https://llorracc.github.io/BufferStockTheory#GICNrm" >under certain conditions</a>: The <img 
src="SolvingMicroDSOPs393x.svg" alt="</span></span>ÀÜm  " class="math";align="absmiddle"> such
that
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs394x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>ùîºt [mt+1 ‚àïmt ] = 1 if mt = ÀÜm
" class="math-display" ><a 
 id="x1-23001r43"></a></div>
  </td><td class="equation-label">(43)</td></tr></table>
<!--l. 25--><p class="nopar" >where the accent is meant to signify that this is the value that other <img 
src="SolvingMicroDSOPs395x.svg" alt="</span>m  " class="math";align="absmiddle">‚Äôs ‚Äòpoint
to.‚Äô
                                                                                     
                                                                                     
<!--l. 29--><p class="indent" >  Given a consumption rule <img 
src="SolvingMicroDSOPs396x.svg" alt="</span></span></span>c(m )  " class="math";align="absmiddle"> it is straightforward to Ô¨Ånd the corresponding <img 
src="SolvingMicroDSOPs397x.svg" alt="</span></span>ÀÜm  " class="math";align="absmiddle">. So for
our problem, a solution is declared to have converged if the following criterion is met:
<img 
src="SolvingMicroDSOPs398x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span>|mÀÜt+1 ‚àí  ÀÜmt| &#x003C; ùúñ  " class="math";align="absmiddle">, where <img 
src="SolvingMicroDSOPs399x.svg" alt="</span>ùúñ  " class="math";align="absmiddle"> is a very small number and deÔ¨Ånes our degree of convergence
tolerance.
<!--l. 35--><p class="indent" >  Similar criteria can obviously be speciÔ¨Åed for other problems. However, it is always wise to
plot successive function diÔ¨Äerences and to experiment a bit with convergence criteria to verify
that the function has converged for all practical purposes.
<!--l. 5--><p class="indent" >  <a 
 id="multiple-control-variables"></a>
  <h3 class="sectionHead"><span class="titlemark">8  </span> <a 
 id="x1-240008"></a>Multiple Control Variables</h3>                                                        {sec:multiple-control-variables}
<!--l. 7--><p class="noindent" >We now consider how to solve problems with multiple control variables. SpeciÔ¨Åcally, we
will examine a consumer who has both a choice of how much to consume and a
choice of how much of their unconsumed resources to invest in risky versus safe
assets.
<!--l. 10--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">8.1  </span> <a 
 id="x1-250008.1"></a>Theory</h4>                                                                          {subsec:MCTheory}
<!--l. 12--><p class="noindent" >The portfolio-share control-variable is captured by the archaic Greek character  <a 
href="https://en.wikipedia.org/wiki/Stigma_(ligature)" >‚Äòstigma‚Äô</a>: <img 
src="SolvingMicroDSOPs400x.svg" alt="</span>œÇ  " class="math";align="absmiddle">
represents the share of their available assets the agent invests in the risky asset
(conventionally, the stock market). Designating the return factor for the risky asset as <img 
src="SolvingMicroDSOPs401x.svg" alt="</span>R  " class="math";align="absmiddle"> and
the share of the portfolio invested in <img 
src="SolvingMicroDSOPs402x.svg" alt="</span>R  " class="math";align="absmiddle"> as <img 
src="SolvingMicroDSOPs403x.svg" alt="</span>œÇ  " class="math";align="absmiddle">, the realized portfolio rate of return <img 
src="SolvingMicroDSOPs404x.svg" alt="</span>‚Ñú  " class="math";align="absmiddle"> as a
function of the share <img 
src="SolvingMicroDSOPs405x.svg" alt="</span>œÇ  " class="math";align="absmiddle"> is:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs406x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>‚Ñú (œÇ) = R + (R ‚àí R )œÇ.
" class="math-display" ><a 
 id="x1-25001r44"></a></div>
  </td><td class="equation-label">(44)</td></tr></table>
<!--l. 15--><p class="nopar" >If we imagine the portfolio share decision as being made simultaneously with the <img 
src="SolvingMicroDSOPs407x.svg" alt="</span>c  " class="math";align="absmiddle">
decision, the traditional way of writing the problem is (substituting the budget
constraint):
  <table 
class="equation"><tr><td>
                                                                                     
                                                                                     
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs408x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>v (m ) = max   u (c) + ùîº [Œ≤v    ((m  ‚àí c)‚Ñú (œÇ) + ùúÉ  )]
 t       {c,œÇ}              t+1                 t+1
" class="math-display" ><a 
 id="x1-25002r45"></a></div>
  </td><td class="equation-label">(45)</td></tr></table>
<!--l. 19--><p class="nopar" >where we have deliberately omitted the period-designating subscripts for <img 
src="SolvingMicroDSOPs409x.svg" alt="</span>œÇ  " class="math";align="absmiddle"> and the return
factors to highlight the point that, once the consumption and <img 
src="SolvingMicroDSOPs410x.svg" alt="</span>œÇ  " class="math";align="absmiddle"> decisions have been made, it
makes no diÔ¨Äerence to this equation whether the risky return factor <img 
src="SolvingMicroDSOPs411x.svg" alt="</span>R  " class="math";align="absmiddle"> is revealed a
nanosecond before the end of the current period or a nanosecond after the beginning of the
successor period.
<!--l. 94--><p class="indent" >  <a 
 id="stages-within-a-period"></a>
  <h4 class="subsectionHead"><span class="titlemark">8.2  </span> <a 
 id="x1-260008.2"></a>Stages Within a Period</h4>                                                          {subsec:stageswithin}
<!--l. 97--><p class="noindent" >In most cases it is possible to take multiple-control problems and turn them into a sequence of
single-control ‚Äòstages‚Äô which can be solved sequentially. For this problem we will call the
‚Äòconsumption stage‚Äô <img 
src="SolvingMicroDSOPs412x.svg" alt="</span>c  " class="math";align="absmiddle"> and the ‚Äòportfolio stage‚Äô <img 
src="SolvingMicroDSOPs413x.svg" alt="</span>œÇ  " class="math";align="absmiddle">. Our earlier point that, substantively, the
timing of the realization of the return shocks does not matter means that these could
come in either order in the period: We designate the ‚Äòportfolio choice Ô¨Årst, then
consumption‚Äô version by <img 
src="SolvingMicroDSOPs414x.svg" alt="</span></span></span>[œÇ,c]  " class="math";align="absmiddle"> and the ‚Äòconsumption choice Ô¨Årst, then portfolio‚Äô scheme as
<img 
src="SolvingMicroDSOPs415x.svg" alt="</span></span></span>[c,œÇ]  " class="math";align="absmiddle">.
<!--l. 99--><p class="indent" >  In a problem with multiple stages, if we want to refer to a sub-step of a particular stage ‚Äì
say, the Arrival step of the portfolio stage ‚Äì we simply add a stage-indicator subscript (in
square brackets) to the notation we have been using until now. That is, the Arrival stage of
the portfolio problem would be <img 
src="SolvingMicroDSOPs416x.svg" alt="</span></span></span></span></span>v‚Üº [œÇ]   " class="math";align="absmiddle">.{SB, AL, MNW: An alternative notational choice would
be <img 
src="SolvingMicroDSOPs417x.svg" alt="</span></span></span></span></span>v[‚ÜºœÇ]   " class="math";align="absmiddle">.} (The version where both choices are made simultaneously could be designated as a
single stage named <img 
src="SolvingMicroDSOPs418x.svg" alt="</span></span></span>[cœÇ]  " class="math";align="absmiddle">) with arrival value function <img 
src="SolvingMicroDSOPs419x.svg" alt="</span></span></span></span></span>v‚Üº [cœÇ]   " class="math";align="absmiddle">.{SB, AL, MNW: with arrival
value function <img 
src="SolvingMicroDSOPs420x.svg" alt="</span></span></span></span></span></span></span>v    .
 [‚Üºc œÇ]  " class="math";align="absmiddle">}
<!--l. 101--><p class="indent" >  <a 
 id="revised-consumers-problem"></a>
  <h5 class="subsubsectionHead"><span class="titlemark">8.2.1  </span> <a 
 id="x1-270008.2.1"></a>The (Revised) Consumer‚Äôs Problem</h5>                                            {subsubsec:revised-consumers-problem}
<!--l. 104--><p class="noindent" >A slight modiÔ¨Åcation to the consumer‚Äôs problem speciÔ¨Åed earlier is necessary to make the
stages of the problem completely modular. The diÔ¨Éculty with the earlier formulation is that it
assumed that asset returns occurred in the middle step of the consumption problem. Our
revised version of the consumption problem takes as its input state the amount of
bank balances that have resulted from any prior portfolio decision. The problem is
therefore:
                                                                                     
                                                                                     
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs421x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> v[c](m ) = max   u (c) + v[c]‚áÅ(m- ‚àí-c)
            c               ‚óü ‚óù‚óúa ‚óû
               ‚åä      m   ‚åã
                     ‚óú‚óû‚óü‚óù
v‚Üº [c](b) = ùîº ‚Üº[c]‚åàv [c](b + ùúÉ)‚åâ
" class="math-display" ><a 
 id="x1-27001r46"></a></div>
  </td><td class="equation-label">(46)</td></tr></table>
<!--l. 4--><p class="nopar" >
<!--l. 114--><p class="indent" >  <a 
 id="subsubsec:investors-problem"></a>
  <h5 class="subsubsectionHead"><span class="titlemark">8.2.2  </span> <a 
 id="x1-280008.2.2"></a>The Investor‚Äôs Problem</h5>                                                        {subsubsec:investors-problem}
<!--l. 117--><p class="noindent" >Consider the standalone problem of an ‚Äòinvestor‚Äô whose continuation-value function <img 
src="SolvingMicroDSOPs422x.svg" alt="</span></span></span></span></span>v[œÇ]
  ‚áÅ   " class="math";align="absmiddle">
depends on how much wealth <img 
src="SolvingMicroDSOPs423x.svg" alt="</span></span>¬¥w  " class="math";align="absmiddle"> they end up after the realization of the stochastic <img 
src="SolvingMicroDSOPs424x.svg" alt="</span>R  " class="math";align="absmiddle">
return.
<!--l. 119--><p class="indent" >  Using the <img 
src="SolvingMicroDSOPs425x.svg" alt="</span>Àò  " class="math";align="absmiddle"> accent to designate the optimized value of the accented control, the Decision
stage of this problem yields the portfolio share function:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs426x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                   ‚åä        w¬¥   ‚åã
                         ‚óú--‚óû‚óü--‚óù
ÀòœÇ(w) = argmax  ùîº[œÇ]‚åàv[œÇ]‚áÅ (w‚Ñú (œÇ))‚åâ ,
          œÇ
" class="math-display" ><a 
 id="x1-28001r47"></a></div>
  </td><td class="equation-label">(47)</td></tr></table>
<!--l. 3--><p class="nopar" >and the Arrival value function is the expectation of the Continuation-value function over the
wealth that results from the portfolio returns obtained under the choice of portfolio share
made in the Decision step of the problem, <img 
src="SolvingMicroDSOPs427x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>Àò‚Ñú  = R + ÀòœÇ(w )(R  ‚àí R )  " class="math";align="absmiddle">:
  <table 
class="equation"><tr><td>
                                                                                     
                                                                                     
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs428x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>              [        Àò ]
v‚Üº [œÇ](w ) = ùîº[œÇ] v[œÇ]‚áÅ (w‚Ñú )  .
" class="math-display" ><a 
 id="x1-28002r48"></a></div>
  </td><td class="equation-label">(48)</td></tr></table>
<!--l. 129--><p class="nopar" >
<!--l. 137--><p class="indent" >  The reward for all this notational investment is that it is now clear that exactly the same
code for solving the portfolio share problem can be used in two distinct problems: a
‚Äòbeginning-of-period-returns‚Äô model and an ‚Äòend-of-period-returns‚Äô model.
<!--l. 139--><p class="indent" >  <a 
 id="beginning-returns"></a>
  <h5 class="subsubsectionHead"><span class="titlemark">8.2.3  </span> <a 
 id="x1-290008.2.3"></a>The ‚Äòbeginning-of-period returns‚Äô Problem</h5>                                     {subsubsec:beginning-returns}
<!--l. 141--><p class="noindent" >The beginning-returns problem eÔ¨Äectively just inserts a portfolio choice that happens at a
stage immediately before the consumption stage in the optimal consumption problem
described in (<a 
href="#x1-27001r46">46<!--tex4ht:ref: eq:vBalances --></a>), for which we had a beginning-of-stage value function <img 
src="SolvingMicroDSOPs429x.svg" alt="</span></span></span></span></span></span>v‚Üº [c](b)  " class="math";align="absmiddle">. The agent
makes their portfolio share decision within the stage but (obviously) before the risky
returns <img 
src="SolvingMicroDSOPs430x.svg" alt="</span>R  " class="math";align="absmiddle"> for the period have been realized. So the problem‚Äôs portfolio-choice
stage also takes <img 
src="SolvingMicroDSOPs431x.svg" alt="</span>k  " class="math";align="absmiddle"> as its initial state and solves the investor‚Äôs problem outlined in
section¬†<a 
href="#x1-280008.2.2">8.2.2<!--tex4ht:ref: subsubsec:investors-problem --></a>:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs432x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>v‚Üº [œÇ](k ) = ùîº‚Üº [œÇ][v[œÇ]‚áÅ(‚óük‚óùÀò‚Ñú‚óú‚óû)]
                       b

 v[œÇ]‚áÅ (b) = v‚Üº[c](b)
" class="math-display" ><a 
 id="x1-29001r49"></a></div>
  </td><td class="equation-label">(49)</td></tr></table>
<!--l. 145--><p class="nopar" >
<!--l. 147--><p class="indent" >  Since in this setup bank balances have been determined before the consumption problems
starts, we need to rewrite the consumption stage as a function of bank balances that will
have resulted from the portfolio investment <img 
src="SolvingMicroDSOPs433x.svg" alt="</span>b  " class="math";align="absmiddle">, combined with the income shocks
<img 
src="SolvingMicroDSOPs434x.svg" alt="</span>ùúÉ  " class="math";align="absmiddle">:
                                                                                     
                                                                                     
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs435x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                                ‚óú‚óûm‚óü‚óù
v‚Üº[c](b) = max  u(c) + ùîº ‚Üº [c][v[c]‚áÅ(b + ùúÉ‚àí c)]
           c                    ‚óü--‚óù‚óú--‚óû
                                    a
" class="math-display" ><a 
 id="x1-29002r50"></a></div>
  </td><td class="equation-label">(50)</td></tr></table>
<!--l. 150--><p class="nopar" >and since the consumption stage is the last stage in the period, the (undated) <img 
src="SolvingMicroDSOPs436x.svg" alt="</span>a  " class="math";align="absmiddle"> that emerges
from this equation is equivalent to the <img 
src="SolvingMicroDSOPs437x.svg" alt="</span></span>a
  t  " class="math";align="absmiddle"> characterizing the end of the period. The ‚Äòstate
transition‚Äô equation between <img 
src="SolvingMicroDSOPs438x.svg" alt="</span>t  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs439x.svg" alt="</span></span>t + 1  " class="math";align="absmiddle"> is simply <img 
src="SolvingMicroDSOPs440x.svg" alt="</span></span></span></span></span></span>kt+1 = at  " class="math";align="absmiddle"> and the continuation-value
function transition is <img 
src="SolvingMicroDSOPs441x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>vt‚áÅ (k) := Œ≤v ‚Üº(t+1)(k )  " class="math";align="absmiddle"> which reÔ¨Çects the above-mentioned point that
there is no substantive diÔ¨Äerence between the two problems (their <img 
src="SolvingMicroDSOPs442x.svg" alt="</span></span></span></span></span>v[c](m )  " class="math";align="absmiddle"> value functions and
<img 
src="SolvingMicroDSOPs443x.svg" alt="</span></span></span>c(m )  " class="math";align="absmiddle"> functions will be identical).
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs444x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>v[c]‚áÅ (a) =vt‚áÅ (a)
" class="math-display" ><a 
 id="x1-29003r51"></a></div>
  </td><td class="equation-label">(51)</td></tr></table>
<!--l. 154--><p class="nopar" >(and recall that <img 
src="SolvingMicroDSOPs445x.svg" alt="</span></span></span></span></span></span>vt‚áÅ (a )  " class="math";align="absmiddle"> is exogenously provided as an input to the period‚Äôs problem via the
transition equation assumed earlier: <img 
src="SolvingMicroDSOPs446x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>vt‚áÅ(a) = Œ≤v ‚Üº(t+1)(a)  " class="math";align="absmiddle">).
<!--l. 157--><p class="noindent" >
  <h5 class="subsubsectionHead"><span class="titlemark">8.2.4  </span> <a 
 id="x1-300008.2.4"></a>The ‚Äòend-of-period-returns‚Äô Problem</h5>
<!--l. 158--><p class="noindent" >If the portfolio share and risky returns are realized at the end of the period, we need to move
the portfolio choice stage to immediately before the point at which returns are realized
(and after the <img 
src="SolvingMicroDSOPs447x.svg" alt="</span>c  " class="math";align="absmiddle"> choice has been made). This creates a slight awkwardness because
the variable we have heretofore dubbed <img 
src="SolvingMicroDSOPs448x.svg" alt="</span>a  " class="math";align="absmiddle"> is no longer the end-of-period state,
                                                                                     
                                                                                     
since this money must be invested and the returns realized before the end of the
period. We want to continue using <img 
src="SolvingMicroDSOPs449x.svg" alt="</span>a  " class="math";align="absmiddle"> for ‚Äòassets-after-all-actions-are-accomplished‚Äô
but now to include the ‚Äòactions‚Äô of the market, so we will temporarily designate
the consumer‚Äôs unspent market resources by <img 
src="SolvingMicroDSOPs450x.svg" alt="</span></span></span></span></span>w = mN  rm  ‚àí c  " class="math";align="absmiddle"> because deÔ¨Åned <img 
src="SolvingMicroDSOPs451x.svg" alt="</span>w  " class="math";align="absmiddle">
earlier as the input to the investor‚Äôs problem. So, the portfolio stage of the problem
is
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs452x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>v    (w ) = ùîº   [v    ( Àò‚Ñúw )]
 ‚Üº [œÇ]       ‚Üº [œÇ] [œÇ]‚áÅ ‚óü‚óù‚óú‚óû
                      ‚â°a
" class="math-display" ><a 
 id="x1-30001r52"></a></div>
  </td><td class="equation-label">(52)</td></tr></table>
<!--l. 161--><p class="nopar" >so the continuation-value function is <img 
src="SolvingMicroDSOPs453x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span>v[œÇ]‚áÅ (‚óüa‚óù‚óú‚óû)
     ‚â°‚Ñúw  " class="math";align="absmiddle"> is still a function of <img 
src="SolvingMicroDSOPs454x.svg" alt="</span>a  " class="math";align="absmiddle"> (and the ‚Äòstate
transition‚Äô equation between <img 
src="SolvingMicroDSOPs455x.svg" alt="</span>t  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs456x.svg" alt="</span></span>t + 1  " class="math";align="absmiddle"> remains <img 
src="SolvingMicroDSOPs457x.svg" alt="</span></span></span></span></span></span>kt+1 = at  " class="math";align="absmiddle"> and the continuation-value
function transition is <img 
src="SolvingMicroDSOPs458x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>vt‚áÅ (a) := Œ≤v ‚Üº(t+1)(k )  " class="math";align="absmiddle">.
<!--l. 168--><p class="indent" >  (Note that we are assuming that there will be only one consumption function in the period,
so no stage subscript is necessary to pick out ‚Äòthe consumption function‚Äô).
<!--l. 170--><p class="noindent" >
  <h5 class="subsubsectionHead"><span class="titlemark">8.2.5  </span> <a 
 id="x1-310008.2.5"></a>Numerical Solution</h5>
<!--l. 171--><p class="noindent" >we can solve it numerically for the optimal <img 
src="SolvingMicroDSOPs459x.svg" alt="</span>œÇ  " class="math";align="absmiddle"> at a vector of <img 
src="SolvingMicroDSOPs460x.svg" alt="</span></span></span>aaa " class="math";align="absmiddle"> (<img 
src="SolvingMicroDSOPs461x.svg" alt="</span>aVec " class="math";align="absmiddle"> in the code)
and then construct an approximated optimal portfolio share function <img 
src="SolvingMicroDSOPs462x.svg" alt="</span></span></span></span></span></span>`ÀòœÇ(a)  " class="math";align="absmiddle"> as the
interpolating function among the members of the <img 
src="SolvingMicroDSOPs463x.svg" alt="</span></span></span></span></span></span></span></span></span>{aaa, œÇœÇœÇ} " class="math";align="absmiddle"> mapping. Having done this,
we can now calculate a vector of values and marginal values that correspond to
<img 
src="SolvingMicroDSOPs464x.svg" alt="</span>aVec " class="math";align="absmiddle">:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs465x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> vvv = v  [œÇ](aaa )
 a    ‚Üºa
vvv  = v‚Üº [œÇ](aaa ).
" class="math-display" ><a 
 id="x1-31001r53"></a></div>
  </td><td class="equation-label">(53)</td></tr></table>
<!--l. 175--><p class="nopar" >
<!--l. 177--><p class="indent" >  With the <img 
src="SolvingMicroDSOPs466x.svg" alt="</span></span></span></span>vvva  " class="math";align="absmiddle"> approximation described in hand, we can construct our approximation to the
consumption function using exactly the same EGM procedure that we used in solving the
problem without a portfolio choice (see (<a 
href="#x1-16004r35">35<!--tex4ht:ref: eq:cGoth --></a>)):
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs467x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>ccc ‚â° (vvva)‚àí 1‚àïœÅ,
" class="math-display" ><a 
 id="x1-31002r54"></a></div>
  </td><td class="equation-label">(54)</td></tr></table>
<!--l. 180--><p class="nopar" >which, following a procedure identical to that in the EGM subsection <a 
href="#x1-180006.8">6.8<!--tex4ht:ref: subsec:egm --></a>, yields an
approximated consumption function <img 
src="SolvingMicroDSOPs468x.svg" alt="</span></span></span></span></span></span>`ct(m )  " class="math";align="absmiddle">. Thus, again, we can construct the consumption
function at nearly zero cost (once we have calculated <img 
src="SolvingMicroDSOPs469x.svg" alt="</span></span></span></span>vvva  " class="math";align="absmiddle">).
<!--l. 183--><p class="indent" >  <a 
 id="the-point"></a>
<!--l. 185--><p class="noindent" >
  <h5 class="subsubsectionHead"><span class="titlemark">8.2.6  </span> <a 
 id="x1-320008.2.6"></a>The Point</h5>                                                                     {subsubsec:the-point}
<!--l. 187--><p class="noindent" >The upshot is that all we need to do is change some of the transition equations and we can use
the same solution code (both for the <img 
src="SolvingMicroDSOPs470x.svg" alt="</span>œÇ  " class="math";align="absmiddle">-stage and the <img 
src="SolvingMicroDSOPs471x.svg" alt="</span>c  " class="math";align="absmiddle">-stage) to solve the problem with
either assumption (beginning-of-period or end-of-period) about the timing of portfolio choice.
There is even an obvious notation for the two problems: <img 
src="SolvingMicroDSOPs472x.svg" alt="</span></span></span></span></span></span>v‚Üºt[œÇc]   " class="math";align="absmiddle"> can be the period-arrival
value function for the version where the portfolio share is chosen at the beginning of the
period, and <img 
src="SolvingMicroDSOPs473x.svg" alt="</span></span></span></span></span></span>v‚Üºt[cœÇ]   " class="math";align="absmiddle"> is period-arrival value for the the problem where the share choice is at the
end.
<!--l. 189--><p class="indent" >  What is the beneÔ¨Åt of writing eÔ¨Äectively the identical problem in two diÔ¨Äerent ways? There
are several:
      <ul class="itemize1">
      <li class="itemize">
                                                                                     
                                                                                     
      <!--l. 191--><p class="noindent" >It demonstrates that, if they are carefully constructed, Bellman problems can be
      ‚Äúmodular‚Äù
           <ul class="itemize2">
           <li class="itemize">
           <!--l. 193--><p class="noindent" >In a life cycle model one might want to assume that at at some ages agents
           have  a  portfolio  choice  and  at  other  ages  they  do  not.  The  consumption
           problem  makes  no  assumption  about  whether  there  is  a  portfolio  choice
           decision (before or after the consumption choice), so there would be zero cost
           of having an age-varying problem in which you drop in whatever choices are
           appropriate to the life cycle stage.</li></ul>
      </li>
      <li class="itemize">
      <!--l. 195--><p class="noindent" >It emphasizes the Ô¨Çexibilty of choice a modeler has to date variables arbitrarily. In
      the speciÔ¨Åc example examined here, there is a strong case for preferring the
      beginning-returns speciÔ¨Åcation because we typically think of productivity or other
      shocks at date <img 
src="SolvingMicroDSOPs474x.svg" alt="</span>t  " class="math";align="absmiddle"> aÔ¨Äecting the agent‚Äôs state variables before the agent makes that
      period‚Äôs choices. It would be awkward and confusing to have a productivity shock dated
      <img 
src="SolvingMicroDSOPs475x.svg" alt="</span></span></span>t ‚àí 1  " class="math";align="absmiddle"> eÔ¨Äectively applying for the problem being solved at <img 
src="SolvingMicroDSOPs476x.svg" alt="</span>t  " class="math";align="absmiddle"> (as in the end-returns
      speciÔ¨Åcation)
      </li>
      <li class="itemize">
      <!--l. 196--><p class="noindent" >It may help to identify more eÔ¨Écient solution methods
           <ul class="itemize2">
           <li class="itemize">
           <!--l. 198--><p class="noindent" >For example, under the traditional formulation in equation (<a 
href="#x1-25002r45">45<!--tex4ht:ref: eq:Bellmanundated --></a>) it might not
           occur to a modeler that the endogenous gridpoints solution method can be
           used, because when portfolio choice and consumption choice are considered
           simultaneously the EGM method breaks down because the portfolio choice
           part of the problem is not susceptible to EGM solution. But when the problem
           is broken into two simpler problems, it becomes clear that EGM can still be
           applied to the consumption problem even though it cannot be applied to the
           portfolio choice problem</li></ul>
      </li></ul>
<!--l. 208--><p class="noindent" >
                                                                                     
                                                                                     
  <h4 class="subsectionHead"><span class="titlemark">8.3  </span> <a 
 id="x1-330008.3"></a>Application</h4>                                                                     {subsec:MCApplication}
<!--l. 211--><p class="noindent" >In specifying the stochastic process for <img 
src="SolvingMicroDSOPs477x.svg" alt="</span></span></span>Rt+1   " class="math";align="absmiddle">, we follow the common practice of
assuming that returns are lognormally distributed, <img 
src="SolvingMicroDSOPs478x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>log R ‚àº ùí©  (œï + r ‚àí œÉ2‚àï2, œÉ2)
                    r     r  " class="math";align="absmiddle">
where <img 
src="SolvingMicroDSOPs479x.svg" alt="</span>œï  " class="math";align="absmiddle"> is the equity premium over the thin returns <img 
src="SolvingMicroDSOPs480x.svg" alt="</span>r  " class="math";align="absmiddle"> available on the riskless
asset.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs14.html#fn13x0"><sup class="textsuperscript"><span 
class="ecrm-0600">13</span></sup></a></span><a 
 id="x1-33001f13"></a>  
<!--l. 213--><p class="indent" >  As with labor income uncertainty, it is necessary to discretize the rate-of-return risk in order
to have a problem that is soluble in a reasonable amount of time. We follow the same
procedure as for labor income uncertainty, generating a set of <img 
src="SolvingMicroDSOPs483x.svg" alt="</span></span>n
 r  " class="math";align="absmiddle"> equiprobable shocks to the
rate of return; in a slight abuse of notation, we will designate the portfolio-weighted return
(contingent on the chosen portfolio share in equity, and potentially contingent on any other
aspect of the consumer‚Äôs problem) simply as <img 
src="SolvingMicroDSOPs484x.svg" alt="</span></span>‚Ñúi,j  " class="math";align="absmiddle"> (where dependence on <img 
src="SolvingMicroDSOPs485x.svg" alt="</span>i  " class="math";align="absmiddle"> is allowed to
permit the possibility of nonzero correlation between the return on the risky asset and the <img 
src="SolvingMicroDSOPs486x.svg" alt="</span>ùúÉ  " class="math";align="absmiddle">
shock to labor income (for example, in recessions the stock market falls and labor income also
declines).
<!--l. 215--><p class="indent" >  The direct expressions for the derivatives of <img 
src="SolvingMicroDSOPs487x.svg" alt="</span></span>v‚áÅ   " class="math";align="absmiddle"> are
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs488x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>             (   1  ) ‚àënùúÉ n‚àër
va‚áÅ(at,œÇt) = Œ≤  -----         ‚Ñúi,j (ct+1(‚Ñúi,jat + ùúÉi))‚àíœÅ
               nrn ùúÉ  i=1 j=1
             (      )  nùúÉ nr
 œÇ             --1--  ‚àë   ‚àë                             ‚àí œÅ
v‚áÅ(at,œÇt) = Œ≤  nrn ùúÉ         (Ri,j ‚àí R )(ct+1 (‚Ñúi,jat + ùúÉi))  .
                      i=1 j=1
" class="math-display" ><a 
 id="x1-33003r55"></a></div>
  </td><td class="equation-label">(55)</td></tr></table>
<!--l. 219--><p class="nopar" >
<!--l. 221--><p class="indent" >  Writing these equations out explicitly makes a problem very apparent: For every diÔ¨Äerent
combination of <img 
src="SolvingMicroDSOPs489x.svg" alt="</span></span></span></span></span></span>{at,œÇt} " class="math";align="absmiddle"> that the routine wishes to consider, it must perform two
double-summations of <img 
src="SolvingMicroDSOPs490x.svg" alt="</span></span></span></span></span>nr √ó n ùúÉ  " class="math";align="absmiddle"> terms. Once again, there is an ineÔ¨Éciency if it must perform
these same calculations many times for the same or nearby values of <img 
src="SolvingMicroDSOPs491x.svg" alt="</span></span></span></span></span></span>{at,œÇt} " class="math";align="absmiddle">, and again the
solution is to construct an approximation to the (inverses of the) derivatives of the <img 
src="SolvingMicroDSOPs492x.svg" alt="</span></span>v‚áÅ   " class="math";align="absmiddle">
function.
<!--l. 223--><p class="indent" >  Details of the construction of the interpolating approximations are given below; assume for
the moment that we have the approximations <img 
src="SolvingMicroDSOPs493x.svg" alt="</span></span></span></span>`va‚áÅ   " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs494x.svg" alt="</span></span></span></span>`v œÇ‚áÅ   " class="math";align="absmiddle"> in hand and we want
                                                                                     
                                                                                     
to proceed. As noted above in the discussion of (<a 
href="#x1-25002r45">45<!--tex4ht:ref: eq:Bellmanundated --></a>), nonlinear equation solvers
can Ô¨Ånd the solution to a set of simultaneous equations. Thus we could ask one to
solve
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs495x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> ‚àíœÅ     a
ct  = `vt‚áÅ (mt ‚àí ct,œÇt)
  0 = `vtœÇ (mt ‚àí ct,œÇt)
        ‚áÅ
" class="math-display" ><a 
 id="x1-33004r56"></a></div>
  </td><td class="equation-label">(56)</td></tr></table>
<!--l. 227--><p class="nopar" >simultaneously for <img 
src="SolvingMicroDSOPs496x.svg" alt="</span>c  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs497x.svg" alt="</span>œÇ  " class="math";align="absmiddle"> at the set of potential <img 
src="SolvingMicroDSOPs498x.svg" alt="</span></span>mt  " class="math";align="absmiddle"> values deÔ¨Åned in mVec. However, as
noted above, multidimensional constrained maximization problems are diÔ¨Écult and sometimes
quite slow to solve.
<!--l. 232--><p class="indent" >  There is a better way. DeÔ¨Åne the problem
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs499x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>Àòvt (at) = max   v  (at,œÇt)
  ‚áÅ         œÇt    ‚áÅ
       s.t.

    0 ‚â§ œÇt ‚â§ 1
" class="math-display" ><a 
 id="x1-33005r57"></a></div>
  </td></tr></table>
<!--l. 238--><p class="nopar" >where the tilde over <img 
src="SolvingMicroDSOPs500x.svg" alt="</span></span></span></span>Àòv (a )  " class="math";align="absmiddle"> indicates that this is the <img 
src="SolvingMicroDSOPs501x.svg" alt="</span>v  " class="math";align="absmiddle"> that has been optimized with respect
to all of the arguments other than the one still present (<img 
src="SolvingMicroDSOPs502x.svg" alt="</span></span>at  " class="math";align="absmiddle">). We solve this problem for the set
of gridpoints in <img 
src="SolvingMicroDSOPs503x.svg" alt="</span>aVec " class="math";align="absmiddle"> and use the results to construct the interpolating function
<img 
src="SolvingMicroDSOPs504x.svg" alt="</span></span></span></span></span></span></span></span></span>`a
Àòvt(at)  " class="math";align="absmiddle">.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs15.html#fn14x0"><sup class="textsuperscript"><span 
class="ecrm-0600">14</span></sup></a></span><a 
 id="x1-33006f14"></a>  
                                                                                     
                                                                                     
With this function in hand, we can use the Ô¨Årst order condition from the single-control
problem
  <table 
class="equation-star"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs508x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> ‚àíœÅ    a
ct  = `Àòvt(mt ‚àí  ct)
" class="math-display" ></div>
  </td></tr></table>
<!--l. 242--><p class="nopar" >to solve for the optimal level of consumption as a function of <img 
src="SolvingMicroDSOPs509x.svg" alt="</span></span>mt  " class="math";align="absmiddle"> using the endogenous
gridpoints method described above. Thus we have transformed the multidimensional
optimization problem into a sequence of two simple optimization problems.
<!--l. 245--><p class="indent" >  Note the parallel between this trick and the fundamental insight of dynamic programming:
Dynamic programming techniques transform a multi-period (or inÔ¨Ånite-period) optimization
problem into a sequence of two-period optimization problems which are individually much
easier to solve; we have done the same thing here, but with multiple dimensions of controls
rather than multiple periods.
<!--l. 247--><p class="indent" >  <a 
 id="implementation"></a>
  <h4 class="subsectionHead"><span class="titlemark">8.4  </span> <a 
 id="x1-340008.4"></a>Implementation</h4>
<!--l. 250--><p class="noindent" >Following the discussion from section <a 
href="#x1-250008.1">8.1<!--tex4ht:ref: subsec:MCTheory --></a>, to provide a numerical solution to the problem with
multiple control variables, we must deÔ¨Åne expressions that capture the expected marginal
value of end-of-period assets with respect to the level of assets and the share invested in risky
assets. This is addressed in ‚ÄúMultiple Control Variables.‚Äù
<!--l. 260--><p class="indent" >  <a 
 id="results-with-multiple-controls"></a>
  <h4 class="subsectionHead"><span class="titlemark">8.5  </span> <a 
 id="x1-350008.5"></a>Results With Multiple Controls</h4>                                                  {subsec:results-with-multiple-controls}
<!--l. 263--><p class="noindent" >Figure¬†<a 
href="#x1-3500115">15<!--tex4ht:ref: fig:PlotctMultContr --></a> plots the <img 
src="SolvingMicroDSOPs510x.svg" alt="</span></span></span>t ‚àí 1  " class="math";align="absmiddle"> consumption function generated by the program; qualitatively it
does not look much diÔ¨Äerent from the consumption functions generated by the program
without portfolio choice.
<!--l. 265--><p class="indent" >  But Figure¬†<a 
href="#x1-3500216">16<!--tex4ht:ref: fig:PlotRiskySharetOfat --></a> which plots the optimal portfolio share as a function of the level of assets,
exhibits several interesting features. First, even with a coeÔ¨Écient of relative risk aversion of 6,
an equity premium of only 4 percent, and an annual standard deviation in equity
returns of 15 percent, the optimal choice is for the agent to invest a proportion 1 (100
percent) of the portfolio in stocks (instead of the safe bank account with riskless return
                                                                                     
                                                                                     
<img 
src="SolvingMicroDSOPs511x.svg" alt="</span>R  " class="math";align="absmiddle">) is at values of <img 
src="SolvingMicroDSOPs512x.svg" alt="</span></span>at  " class="math";align="absmiddle"> less than about 2. Second, the proportion of the portfolio
kept in stocks is declining in the level of wealth - i.e., the poor should hold all of
their meager assets in stocks, while the rich should be cautious, holding more of
their wealth in safe bank deposits and less in stocks. This seemingly bizarre (and
highly counterfactual ‚Äì see <a 
href="#Xcarroll:richportfolios">Carroll</a>¬†(<a 
href="#Xcarroll:richportfolios">2002</a>)) prediction reÔ¨Çects the nature of the risks
the consumer faces. Those consumers who are poor in measured Ô¨Ånancial wealth
will likely derive a high proportion of future consumption from their labor income.
Since by assumption labor income risk is uncorrelated with rate-of-return risk, the
covariance between their future consumption and future stock returns is relatively
low. By contrast, persons with relatively large wealth will be paying for a large
proportion of future consumption out of that wealth, and hence if they invest too much
of it in stocks their consumption will have a high covariance with stock returns.
Consequently, they reduce that correlation by holding some of their wealth in the riskless
form.
<!--l. 267--><p class="indent" >  <a 
 id="PlotctMultContr"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-3500115"></a>
                                                                                     
                                                                                     
<!--l. 269--><p class="noindent" > <img 
src="./Figures/PlotctMultContr.png" alt="pict"  
 width="433.62pt" >
<figcaption class="caption" ><span class="id">Figure¬†15: </span><span  
class="content"><img 
src="SolvingMicroDSOPs513x.svg" alt="</span></span></span></span>c(m1 )  " class="math";align="absmiddle"> With Portfolio Choice</span></figcaption><!--tex4ht:label?: x1-3500115 -->                                               {Ô¨Åg:PlotctMultContr}
                                                                                     
                                                                                     
  </div>
<!--l. 274--><p class="indent" >  <a 
 id="PlotRiskySharetOfat"></a>  <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-3500216"></a>
                                                                                     
                                                                                     
<!--l. 276--><p class="noindent" > <img 
src="./Figures/PlotRiskySharetOfat.png" alt="pict"  
 width="433.62pt" >
<figcaption class="caption" ><span class="id">Figure¬†16: </span><span  
class="content">Portfolio Share in Risky Assets in First Period <img 
src="SolvingMicroDSOPs514x.svg" alt="</span></span></span></span>œÇ(a)  " class="math";align="absmiddle"></span></figcaption><!--tex4ht:label?: x1-3500216 -->                         {Ô¨Åg:PlotRiskySharetOfat}
                                                                                     
                                                                                     
  </div>
<!--l. 6--><p class="indent" >  <a 
 id="structural-estimation"></a>
  <h3 class="sectionHead"><span class="titlemark">9  </span> <a 
 id="x1-360009"></a>Structural Estimation</h3>                                                             {sec:structural-estimation}
<!--l. 10--><p class="noindent" >This section describes how to use the methods developed above to structurally
estimate a life-cycle consumption model, following closely the work of
<a 
href="#XcagettiWprofiles">Cagetti</a>¬†(<a 
href="#XcagettiWprofiles">2003</a>).<span class="footnote-mark"><a 
href="SolvingMicroDSOPs16.html#fn15x0"><sup class="textsuperscript"><span 
class="ecrm-0600">15</span></sup></a></span><a 
 id="x1-36001f15"></a>  
The key idea of structural estimation is to look for the parameter values (for the time
preference rate, relative risk aversion, or other parameters) which lead to the best possible
match between simulated and empirical moments.
<!--l. 21--><p class="indent" >  <a 
 id="life-cycle-model"></a>
  <h4 class="subsectionHead"><span class="titlemark">9.1  </span> <a 
 id="x1-370009.1"></a>Life Cycle Model</h4>                                                                {subsec:life-cycle-model}
<!--l. 25--><p class="noindent" >Realistic calibration of a life cycle model needs to take into account a few things that
we omitted from the bare-bones model described above. For example, the whole
point of the life cycle model is that life is Ô¨Ånite, so we need to include a realistic
treatment of life expectancy; this is done easily enough, by assuming that utility
accrues only if you live, so eÔ¨Äectively the rising mortality rate with age is treated as
an extra reason for discounting the future. Similarly, we may want to capture the
demographic evolution of the household (e.g., arrival and departure of kids). A common
way to handle that, too, is by modifying the discount factor (arrival of a kid might
increase the total utility of the household by, say, 0.2, so if the ‚Äòpure‚Äô rate of time
preference were <img 
src="SolvingMicroDSOPs515x.svg" alt="</span></span></span>1.0  " class="math";align="absmiddle"> the ‚Äòhousehold-size-adjusted‚Äô discount factor might be 1.2. We
therefore modify the model presented above to allow age-varying discount factors that
capture both mortality and family-size changes (we just adopt the factors used by
<a 
href="#XcagettiWprofiles">Cagetti</a>¬†(<a 
href="#XcagettiWprofiles">2003</a>) directly), with the probability of remaining alive between <img 
src="SolvingMicroDSOPs516x.svg" alt="</span>t  " class="math";align="absmiddle"> and
<img 
src="SolvingMicroDSOPs517x.svg" alt="</span></span></span>t + n  " class="math";align="absmiddle"> captured by <img 
src="SolvingMicroDSOPs518x.svg" alt="</span>‚Ñí " class="math";align="absmiddle"> and with <img 
src="SolvingMicroDSOPs519x.svg" alt="</span></span>ÀÜŒ≤  " class="math";align="absmiddle"> now reÔ¨Çecting all the age-varying discount factor
adjustments (mortality, family-size, etc). Using <img 
src="SolvingMicroDSOPs520x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"> (the Hebrew cognate of <img 
src="SolvingMicroDSOPs521x.svg" alt="</span>Œ≤  " class="math";align="absmiddle">)
for the ‚Äòpure‚Äô time preference factor, the value function for the revised problem
is
  <table 
class="equation"><tr><td>
  <div class="math-display" >
                                                                                     
                                                                                     
<img 
src="SolvingMicroDSOPs522x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>                              [T‚àë ‚àít                   ]
v (ppp ,mmm  ) = max   u(ccc) + ùîº        ‚Ñ∂n ‚Ñít+nŒ≤ÀÜt+n u(ccc   )
 t  t   t    {c}Tt      t     t‚áÅ          t    t     t+n
                                n=1
" class="math-display" ><a 
 id="x1-37001r57"></a></div>
  </td><td class="equation-label">(57)</td></tr></table>
<!--l. 3--><p class="nopar" >subject to the constraints
  <table 
class="equation-star"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs523x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>   aaat = mmmt ‚àí  ccct
 pppt+1 = ùí¢t+1ppptœàt+1

 yyy t+1 = pppt+1ùúÉt+1
mmmt+1 = Raaat + yyy t+1
" class="math-display" ></div>
  </td></tr></table>
<!--l. 6--><p class="nopar" >where
  <table 
class="equation-star"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs524x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>‚Ñít+tn : probability to ‚Ñíive until age t + n given alive at age t
 ÀÜt+n
Œ≤t   : age -varying discount factor between ages t and t + n
  œàt : mean -one shock  to permanent   income

   ‚Ñ∂ : time -invariant ‚Äòpure ‚Äô discount factor
" class="math-display" ></div>
  </td></tr></table>
<!--l. 6--><p class="nopar" >and all the other variables are deÔ¨Åned as in section <a 
href="#x1-20002">2<!--tex4ht:ref: sec:the-problem --></a>.
<!--l. 54--><p class="indent" >  Households start life at age <img 
src="SolvingMicroDSOPs525x.svg" alt="</span></span>s = 25  " class="math";align="absmiddle"> and live with probability 1 until retirement (<img 
src="SolvingMicroDSOPs526x.svg" alt="</span></span>s = 65  " class="math";align="absmiddle">).
Thereafter the survival probability shrinks every year and agents are dead by <img 
src="SolvingMicroDSOPs527x.svg" alt="</span></span>s = 91  " class="math";align="absmiddle"> as
                                                                                     
                                                                                     
assumed by Cagetti.
<!--l. 1--><p class="indent" >  Transitory and permanent shocks are distributed as follows:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs528x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>         (
         |{ 0      with probability ‚Ñò &#x003E; 0
   Œûs =    ùúÉs‚àï‚Ñò   with probability (1 ‚àí ‚Ñò), where logùúÉs ‚àΩ ùí© (‚àí œÉ2ùúÉ‚àï2, œÉ2ùúÉ)
         |(

logœàs ‚àΩ  ùí© (‚àí œÉ2œà‚àï2,œÉ2œà)
" class="math-display" ><a 
 id="x1-37002r58"></a></div>
  </td><td class="equation-label">(58)</td></tr></table>
<!--l. 9--><p class="nopar" >where <img 
src="SolvingMicroDSOPs529x.svg" alt="</span>‚Ñò  " class="math";align="absmiddle"> is the probability of unemployment (and unemployment shocks are turned oÔ¨Ä after
retirement).
<!--l. 72--><p class="indent" >  The parameter values for the shocks are taken from Carroll¬†(<a 
href="#Xcarroll:brookings">1992</a>), <img 
src="SolvingMicroDSOPs530x.svg" alt="</span></span></span></span></span></span>‚Ñò = 0.5‚àï100  " class="math";align="absmiddle">, <img 
src="SolvingMicroDSOPs531x.svg" alt="</span></span></span></span></span>œÉ ùúÉ = 0.1  " class="math";align="absmiddle">, and
<img 
src="SolvingMicroDSOPs532x.svg" alt="</span></span></span></span></span>œÉ œà = 0.1  " class="math";align="absmiddle">.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs17.html#fn16x0"><sup class="textsuperscript"><span 
class="ecrm-0600">16</span></sup></a></span><a 
 id="x1-37003f16"></a>   The income
growth proÔ¨Åle <img 
src="SolvingMicroDSOPs536x.svg" alt="</span></span>ùí¢t  " class="math";align="absmiddle"> is from Carroll¬†(<a 
href="#XcarrollBSLCPIH">1997</a>) and the values of <img 
src="SolvingMicroDSOPs537x.svg" alt="</span></span>‚Ñít  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs538x.svg" alt="</span></span></span>Œ≤ÀÜt  " class="math";align="absmiddle"> are obtained from Cagetti¬†(<a 
href="#XcagettiWprofiles">2003</a>)
(Figure <a 
href="#x1-3700717">17<!--tex4ht:ref: fig:TimeVaryingParam --></a>).<span class="footnote-mark"><a 
href="SolvingMicroDSOPs18.html#fn17x0"><sup class="textsuperscript"><span 
class="ecrm-0600">17</span></sup></a></span><a 
 id="x1-37005f17"></a>  
The interest rate is assumed to equal <img 
src="SolvingMicroDSOPs539x.svg" alt="</span></span></span>1.03  " class="math";align="absmiddle">. The model parameters are included in Table
<a 
href="#x1-370081">1<!--tex4ht:ref: table:StrEstParams --></a>.
<!--l. 75--><p class="indent" >  <a 
 id="PlotTimeVaryingParam"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-3700717"></a>
                                                                                     
                                                                                     
<!--l. 77--><p class="noindent" > <img 
src="./Figures/PlotTimeVaryingParam.png" alt="pict"  
 width="433.62pt" >
<figcaption class="caption" ><span class="id">Figure¬†17: </span><span  
class="content">Time Varying Parameters</span></figcaption><!--tex4ht:label?: x1-3700717 -->                                                   {Ô¨Åg:TimeVaryingParam}
                                                                                     
                                                                                     
  </div>
  <div class="table">
                                                                                     
                                                                                     
<!--l. 82--><p class="indent" >  <a 
 id="x1-370081"></a><figure class="float" 
>
                                                                                     
                                                                                     
<figcaption class="caption" ><span class="id">Table¬†1: </span><span  
class="content">Parameter Values</span></figcaption><!--tex4ht:label?: x1-370081 -->                                                             {table:StrEstParams}
<div class="center" 
>
<!--l. 84--><p class="noindent" >
<div class="pic-tabular">
<img 
src="SolvingMicroDSOPs540x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>------------------------------------
   œÉùúÉ       0.1      Carroll (1992)
   œÉœà       0.1      Carroll (1992)

   ‚Ñò       0.005     Carroll (1992)
   ùí¢s    Ô¨Ågure 17   Carroll (1997)
 ÀÜŒ≤s,‚Ñís   Ô¨Ågure 17   Cagetti (2003 )
   R       1.03     Cagetti (2003 )
------------------------------------
" ></div></div>
                                                                                     
                                                                                     
  </figure>
  </div>
<!--l. 98--><p class="indent" >  The structural estimation of the parameters <img 
src="SolvingMicroDSOPs541x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs542x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> is carried out using the procedure
speciÔ¨Åed in the following section, which is then implemented in the StructEstimation.py Ô¨Åle.
This Ô¨Åle consists of two main components. The Ô¨Årst section deÔ¨Ånes the objects required to
execute the structural estimation procedure, while the second section executes the procedure
and various optional experiments with their corresponding commands. The next section
elaborates on the procedure and its accompanying code implementation in greater
detail.
  <h4 class="subsectionHead"><span class="titlemark">9.2  </span> <a 
 id="x1-380009.2"></a>Estimation</h4>
<!--l. 108--><p class="noindent" >When economists say that they are performing ‚Äústructural estimation‚Äù of a model like this, they
mean that they have devised a formal procedure for searching for values for the parameters <img 
src="SolvingMicroDSOPs543x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle">
and <img 
src="SolvingMicroDSOPs544x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> at which some measure of the model‚Äôs outcome (like ‚Äúmedian wealth by age‚Äù) is as
close as possible to an empirical measure of the same thing. Here, we choose to match the
median of the wealth to permanent income ratio across 7 age groups, from age <img 
src="SolvingMicroDSOPs545x.svg" alt="</span></span></span>26 ‚àí 30  " class="math";align="absmiddle"> up to
<img 
src="SolvingMicroDSOPs546x.svg" alt="</span></span></span>56 ‚àí 60  " class="math";align="absmiddle">.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs19.html#fn18x0"><sup class="textsuperscript"><span 
class="ecrm-0600">18</span></sup></a></span><a 
 id="x1-38001f18"></a>  
The choice of matching the medians rather the means is motivated by the fact that the wealth
distribution is much more concentrated at the top than the model is capable of
explaining using a single set of parameter values. This means that in practice one
must pick some portion of the population who one wants to match well; since the
model has little hope of capturing the behavior of Bill Gates, but might conceivably
match the behavior of Homer Simpson, we choose to match medians rather than
means.
<!--l. 130--><p class="indent" >  As explained in section <a 
href="#x1-30003">3<!--tex4ht:ref: sec:normalization --></a>, it is convenient to work with the normalized version of the model
which can be written in Bellman form as:
  <table 
class="equation-star"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs547x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>v (m  ) = max   u (c ) + ‚Ñ∂‚Ñí    ÀÜŒ≤   ùîº [(œà   ùí¢   )1‚àíœÅv   (m   )]
 t   t     ct      t       t+1  t+1  t   t+1 t+1     t+1   t+1
       s.t.

     at = mt ‚àí ct
            (    R    )
  mt+1 =  at  --------- +  ùúÉt+1
            ‚óü-œàt+1‚óùùí¢‚óút+1-‚óû
               ‚â° ‚Ñõt+1
" class="math-display" ></div>
  </td></tr></table>
<!--l. 7--><p class="nopar" >with the Ô¨Årst order condition:
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs548x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>uc(ct) = ‚Ñ∂ ‚Ñít+1ÀÜŒ≤t+1R ùîºt[uc(œàt+1ùí¢t+1ct+1 (at‚Ñõt+1 + ùúÉt+1))].
" class="math-display" ><a 
 id="x1-38003r59"></a></div>
  </td><td class="equation-label">(59)</td></tr></table>
<!--l. 4--><p class="nopar" >
<!--l. 150--><p class="indent" >  The Ô¨Årst substantive step in this estimation procedure is to solve for the consumption
functions at each age. We need to discretize the shock distribution and solve for the policy
functions by backward induction using equation (<a 
href="#x1-38003r59">59<!--tex4ht:ref: eq:FOCLifeCycle --></a>) following the procedure in sections <a 
href="#x1-100006">6<!--tex4ht:ref: sec:solving-the-next --></a> and
‚ÄòRecursion.‚Äô The latter routine is slightly complicated by the fact that we are considering a
life-cycle model and therefore the growth rate of permanent income, the probability of death,
the time-varying discount factor and the distribution of shocks will be diÔ¨Äerent across the
years. We thus must ensure that at each backward iteration the right parameter values are
used.
<!--l. 163--><p class="indent" >  Correspondingly, the Ô¨Årst part of the StructEstimation.py Ô¨Åle begins by deÔ¨Åning the
agent type by inheriting from the baseline agent type IndShockConsumerType, with the
modiÔ¨Åcation to include time-varying discount factors. Next, an instance of this ‚Äúlife-cycle‚Äù
consumer is created for the estimation procedure. The number of periods for the life cycle of a
given agent is set and, following Cagetti, ¬†(<a 
href="#XcagettiWprofiles">2003</a>), we initialize the wealth to income ratio of
agents at age <img 
src="SolvingMicroDSOPs549x.svg" alt="</span>25  " class="math";align="absmiddle"> by randomly assigning the equal probability values to <img 
src="SolvingMicroDSOPs550x.svg" alt="</span></span></span>0.17  " class="math";align="absmiddle">, <img 
src="SolvingMicroDSOPs551x.svg" alt="</span></span></span>0.50  " class="math";align="absmiddle"> and
<img 
src="SolvingMicroDSOPs552x.svg" alt="</span></span></span>0.83  " class="math";align="absmiddle">. In particular, we consider a population of agents at age 25 and follow their
consumption and wealth accumulation dynamics as they reach the age of <img 
src="SolvingMicroDSOPs553x.svg" alt="</span>60  " class="math";align="absmiddle">, using the
appropriate age-speciÔ¨Åc consumption functions and the age-varying parameters. The simulated
medians are obtained by taking the medians of the wealth to income ratio of the <img 
src="SolvingMicroDSOPs554x.svg" alt="</span>7  " class="math";align="absmiddle"> age
                                                                                     
                                                                                     
groups.
<!--l. 165--><p class="indent" >  To complete the creation of the consumer type needed for the simulation, a history of shocks
is drawn for each agent across all periods by invoking the make_shock_history function. This
involves discretizing the shock distribution for as many points as the number of agents we
want to simulate and then randomly permuting this shock vector as many times as we need to
simulate the model for. In this way, we obtain a time varying shock for each agent. This is
much more time eÔ¨Écient than drawing at each time from the shock distribution a shock for
each agent, and also ensures a stable distribution of shocks across the simulation periods even
for a small number of agents. (Similarly, in order to speed up the process, at each backward
iteration we compute the consumption function and other variables as a vector at
once.)
<!--l. 167--><p class="indent" >  With the age-varying consumption functions derived from the life-cycle agent, we can
proceed to generate simulated data and compute the corresponding medians. Estimating the
model involves comparing these simulated medians with empirical medians, measuring the
model‚Äôs success by calculating the diÔ¨Äerence between the two. However, before performing the
necessary steps of solving and simulating the model to generate simulated moments, it‚Äôs
important to note a diÔ¨Éculty in producing the target moments using the available
data.
<!--l. 169--><p class="indent" >  SpeciÔ¨Åcally, deÔ¨Åning <img 
src="SolvingMicroDSOPs555x.svg" alt="</span>Œæ  " class="math";align="absmiddle"> as the set of parameters to be estimated (in the current case
<img 
src="SolvingMicroDSOPs556x.svg" alt="</span></span></span></span></span></span>Œæ = {œÅ, ‚Ñ∂} " class="math";align="absmiddle">), we could search for the parameter values which solve
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs557x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    ‚àë 7
min     |œÇœÑ ‚àí sœÑ(Œæ)|
  Œæ œÑ=1
" class="math-display" ><a 
 id="x1-38004r60"></a></div>
  </td><td class="equation-label">(60)</td></tr></table>
<!--l. 7--><p class="nopar" >where <img 
src="SolvingMicroDSOPs558x.svg" alt="</span></span>œÇœÑ  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs559x.svg" alt="</span></span>sœÑ  " class="math";align="absmiddle"> are respectively the empirical and simulated medians of the wealth to
permanent income ratio for age group <img 
src="SolvingMicroDSOPs560x.svg" alt="</span>œÑ  " class="math";align="absmiddle">. A drawback of proceeding in this way is that it
treats the empirically estimated medians as though they reÔ¨Çected perfect measurements of the
truth. Imagine, however, that one of the age groups happened to have (in the consumer
survey) four times as many data observations as another age group; then we would expect the
median to be more precisely estimated for the age group with more observations; yet (<a 
href="#x1-38004r60">60<!--tex4ht:ref: eq:naivePowell --></a>)
assigns equal importance to a deviation between the model and the data for all age
groups.
<!--l. 193--><p class="indent" >  We can get around this problem (and a variety of others) by instead minimizing a slightly
more complex object:
                                                                                     
                                                                                     
  <table 
class="equation"><tr><td>
  <div class="math-display" >
<img 
src="SolvingMicroDSOPs561x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    ‚àëN
min     œâi|œÇœÑi ‚àí sœÑ(Œæ)|
 Œæ   i
" class="math-display" ><a 
 id="x1-38005r61"></a></div>
  </td><td class="equation-label">(61)</td></tr></table>
<!--l. 3--><p class="nopar" >where <img 
src="SolvingMicroDSOPs562x.svg" alt="</span></span>œâi  " class="math";align="absmiddle">  is the weight of household <img 
src="SolvingMicroDSOPs563x.svg" alt="</span>i  " class="math";align="absmiddle"> in the entire
population,<span class="footnote-mark"><a 
href="SolvingMicroDSOPs20.html#fn19x0"><sup class="textsuperscript"><span 
class="ecrm-0600">19</span></sup></a></span><a 
 id="x1-38006f19"></a>  
and <img 
src="SolvingMicroDSOPs564x.svg" alt="</span></span></span>œÇiœÑ  " class="math";align="absmiddle"> is the empirical wealth to permanent income ratio of household <img 
src="SolvingMicroDSOPs565x.svg" alt="</span>i  " class="math";align="absmiddle"> whose head
belongs to age group <img 
src="SolvingMicroDSOPs566x.svg" alt="</span>œÑ  " class="math";align="absmiddle">. <img 
src="SolvingMicroDSOPs567x.svg" alt="</span></span>œâ
  i  " class="math";align="absmiddle"> is needed because unequal weight is assigned to each observation
in the Survey of Consumer Finances (SCF). The absolute value is used since the formula is
based on the fact that the median is the value that minimizes the sum of the absolute
deviations from itself.
<!--l. 216--><p class="indent" >  With this in mind, we turn our attention to the computation of the weighted median
wealth target moments for each age cohort using this data from the 2004 Survery of
Consumer Finances on household wealth. The objects necessary to accomplish this
task are weighted_median and get_targeted_moments. The actual data are taken
from several waves of the SCF and the medians and means for each age category
are plotted in Ô¨Ågure <a 
href="#x1-3800818">18<!--tex4ht:ref: fig:MeanMedianSCF --></a>. More details on the SCF data are included in appendix
<a 
href="#x1-42000A">A<!--tex4ht:ref: app:scf-data --></a>.
<!--l. 224--><p class="indent" >  <a 
 id="PlotMeanMedianSCFcollegeGrads"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-3800818"></a>
                                                                                     
                                                                                     
<!--l. 227--><p class="noindent" > <img 
src="./Figures/PlotMeanMedianSCFcollegeGrads.png" alt="pict"  
 width="433.62pt" >
<figcaption class="caption" ><span class="id">Figure¬†18: </span><span  
class="content">Wealth to Permanent Income Ratios from SCF (means (dashed) and medians
(solid))</span></figcaption><!--tex4ht:label?: x1-3800818 -->                                                                                {Ô¨Åg:MeanMedianSCF}
                                                                                     
                                                                                     
  </div>
<!--l. 232--><p class="indent" >  We now turn our attention to the the two key functions in this section of the code Ô¨Åle. The
Ô¨Årst, simulate_moments, executes the solving (solve) and simulation (simulation)
steps for the deÔ¨Åned life-cycle agent. Subsequently, the function uses the agents‚Äô
tracked levels of wealth based on their optimal consumption behavior to compute
and store the simulated median wealth to income ratio for each age cohort. The
second function, smmObjectiveFxn, calls the simulate_moments function to create
the objective function described in (<a 
href="#x1-38005r61">61<!--tex4ht:ref: eq:StructEstim --></a>), which is necessary to perform the SMM
estimation.
<!--l. 246--><p class="indent" >  Thus, for a given pair of the parameters to be estimated, the single call to the function
smmObjectiveFxn executes the following:
      <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-38010x1">
      <!--l. 249--><p class="noindent" >solves for the consumption functions for the life-cycle agent
      </li>
<li 
  class="enumerate" id="x1-38012x2">
      <!--l. 250--><p class="noindent" >simulates the data and computes the simulated medians
      </li>
<li 
  class="enumerate" id="x1-38014x3">
      <!--l. 251--><p class="noindent" >returns the value of equation (<a 
href="#x1-38005r61">61<!--tex4ht:ref: eq:StructEstim --></a>)</li></ol>
<!--l. 254--><p class="indent" >  We delegate the task of Ô¨Ånding the coeÔ¨Écients that minimize the smmObjectiveFxn
function to the minimize_nelder_mead function, which is deÔ¨Åned elsewhere and called in the
second part of this Ô¨Åle. This task can be quite slow and rather problematic if the
smmObjectiveFxn function has very Ô¨Çat regions or sharp features. It is thus wise to verify the
accuracy of the solution, for example by experimenting with a variety of alternative starting
values for the parameter search.
<!--l. 256--><p class="indent" >  The Ô¨Ånal object deÔ¨Åned in this Ô¨Årst part of the StructEstimation.py
Ô¨Åle is calculateStandardErrorsByBootstrap. As the name suggsts,
the purpose of this function is to compute the standard errors by
bootstrap.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs21.html#fn20x0"><sup class="textsuperscript"><span 
class="ecrm-0600">20</span></sup></a></span><a 
 id="x1-38015f20"></a>  
This involves:
      <ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-38018x1">
      <!--l. 262--><p class="noindent" >drawing new shocks for the simulation
                                                                                     
                                                                                     
      </li>
<li 
  class="enumerate" id="x1-38020x2">
      <!--l. 263--><p class="noindent" >drawing a random sample (with replacement) of actual data from the SCF
      </li>
<li 
  class="enumerate" id="x1-38022x3">
      <!--l. 264--><p class="noindent" >obtaining new estimates for <img 
src="SolvingMicroDSOPs568x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs569x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"></li></ol>
<!--l. 266--><p class="noindent" >We repeat the above procedure several times (Bootstrap) and take the standard deviation for
each of the estimated parameters across the various bootstrap iterations.
  <h5 class="subsubsectionHead"><span class="titlemark">9.2.1  </span> <a 
 id="x1-390009.2.1"></a>An Aside to Computing Sensitivity Measures</h5>                                   {subsubsec:sensmeas}
<!--l. 272--><p class="noindent" >A common drawback in commonly used structural estimation procedures is a lack of
transparency in its estimates. As <a 
href="#Xandrews2017measuring">Andrews, Gentzkow, and Shapiro</a>¬†(<a 
href="#Xandrews2017measuring">2017</a>) notes, a
researcher employing such structural empirical methods may be interested in how
alternative assumptions (such as misspeciÔ¨Åcation or measurement bias in the data)
would ‚Äúchange the moments of the data that the estimator uses as inputs, and how
changes in these moments aÔ¨Äect the estimates.‚Äù The authors provide a measure of
sensitivity for given estimator that makes it easy to map the eÔ¨Äects of diÔ¨Äerent
assumptions on the moments into predictable bias in the estimates for non-linear
models.
<!--l. 274--><p class="indent" >  In the language of <a 
href="#Xandrews2017measuring">Andrews, Gentzkow, and Shapiro</a>¬†(<a 
href="#Xandrews2017measuring">2017</a>), section <a 
href="#x1-360009">9<!--tex4ht:ref: sec:structural-estimation --></a> is aimed at providing
an estimator <img 
src="SolvingMicroDSOPs570x.svg" alt="</span></span></span></span></span></span>Œæ = {œÅ, ‚Ñ∂} " class="math";align="absmiddle"> that has some true value <img 
src="SolvingMicroDSOPs571x.svg" alt="</span></span>Œæ0   " class="math";align="absmiddle"> by assumption. Under the assumption
<img 
src="SolvingMicroDSOPs572x.svg" alt="</span></span>a0   " class="math";align="absmiddle"> of the researcher, the empirical targets computed from the SCF is measured accurately.
These moments of the data are precisely what determine our estimate <img 
src="SolvingMicroDSOPs573x.svg" alt="</span></span> ÀÜ
Œæ " class="math";align="absmiddle">, which minimizes
(<a 
href="#x1-38005r61">61<!--tex4ht:ref: eq:StructEstim --></a>). Under alternative assumptions <img 
src="SolvingMicroDSOPs574x.svg" alt="</span>a  " class="math";align="absmiddle">, such that a given cohort is mismeasured in the
survey, a diÔ¨Äerent estimate is computed. Using the plug-in estimate provided by the authors,
we can see quantitatively how our estimate changes under these alternative assumptions <img 
src="SolvingMicroDSOPs575x.svg" alt="</span>a  " class="math";align="absmiddle">
which correspond to mismeasurement in the median wealth to income ratio for a given age
cohort.
<!--l. 276--><p class="noindent" >
  <h4 class="subsectionHead"><span class="titlemark">9.3  </span> <a 
 id="x1-400009.3"></a>Results</h4>
<!--l. 277--><p class="noindent" >The second part of the Ô¨Åle StructEstimation.py deÔ¨Ånes a function main which produces
our <img 
src="SolvingMicroDSOPs576x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs577x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"> estimates with standard errors using 10,000 simulated agents by
setting the positional arguments estimate_model and compute_standard_errors to
                                                                                     
                                                                                     
true.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs22.html#fn21x0"><sup class="textsuperscript"><span 
class="ecrm-0600">21</span></sup></a></span><a 
 id="x1-40001f21"></a>   Results are
reported in Table <a 
href="#x1-400052">2<!--tex4ht:ref: tab:EstResults --></a>.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs23.html#fn22x0"><sup class="textsuperscript"><span 
class="ecrm-0600">22</span></sup></a></span><a 
 id="x1-40003f22"></a>  
  <div class="table">
                                                                                     
                                                                                     
<!--l. 1--><p class="indent" >  <a 
 id="x1-400052"></a><figure class="float" 
>
                                                                                     
                                                                                     
<figcaption class="caption" ><span class="id">Table¬†2: </span><span  
class="content">Estimation Results</span></figcaption><!--tex4ht:label?: x1-400052 -->                                                            {tab:EstResults}
<div class="pic-tabular">
<img 
src="SolvingMicroDSOPs580x.svg" alt="</span></span></span></span></span></span></span></span></span></span></span></span></span></span>-------------------
----œÅ--------‚Ñ∂-----
  3.69      0.88
 (0.047)  (0.002)
-------------------
" ></div>
                                                                                     
                                                                                     
  </figure>
  </div>
<!--l. 309--><p class="indent" >  The literature on consumption and saving behavior over the lifecycle in the presenece of labor income
uncertainty<span class="footnote-mark"><a 
href="SolvingMicroDSOPs24.html#fn23x0"><sup class="textsuperscript"><span 
class="ecrm-0600">23</span></sup></a></span><a 
 id="x1-40006f23"></a>  
warns us to be careful in disentangling the eÔ¨Äect of time preference and risk aversion when
describing the optimal behavior of households in this setting. Since the precautionary saving
motive dominates in the early stages of life, the coeÔ¨Écient of relative risk aversion (as well
as expected labor income growth) has a larger eÔ¨Äect on optimal consumption and
saving behavior through their magnitude relative to the interest rate. Over time,
life-cycle considerations (such as saving for retirement) become more important and the
time preference factor plays a larger role in determining optimal behavior for this
cohort.
<!--l. 311--><p class="indent" >  Using the positional argument compute_sensitivity, Figure <a 
href="#x1-4000819">19<!--tex4ht:ref: fig:PlotSensitivityMeasure --></a> provides a plot of the
plug-in estimate of the sensitivity measure described in <a 
href="#x1-390009.2.1">9.2.1<!--tex4ht:ref: subsubsec:sensmeas --></a>. As you can see from the Ô¨Ågure
the inverse relationship between <img 
src="SolvingMicroDSOPs581x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs582x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"> over the life-cycle is retained by the sensitivity
measure. SpeciÔ¨Åcally, under the alternative assumption that a particular cohort is
mismeasured in the SCF dataset, we see that the y-axis suggests that our estimate of <img 
src="SolvingMicroDSOPs583x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> and
<img 
src="SolvingMicroDSOPs584x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"> change in a predictable way.
<!--l. 313--><p class="indent" >  Suppose that there are not enough observations of the oldest cohort of households in the
sample. Suppose further that the researcher predicts that adding more observations of these
households to correct this mismeasurement would correspond to a higher median wealth to
income ratio for this cohort. In this case, our estimate of the time preference factor should
increase: the behavior of these older households is driven by their time preference, so a
higher value of <img 
src="SolvingMicroDSOPs585x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"> is required to match the aÔ¨Äected wealth to income targets under
this alternative assumption. Since risk aversion is less important in explaining the
behavior of this cohort, a lower value of <img 
src="SolvingMicroDSOPs586x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> is required to match the aÔ¨Äected empirical
moments.
<!--l. 315--><p class="indent" >  To recap, the sensitivity measure not only matches our intuition about the inverse
relationship between <img 
src="SolvingMicroDSOPs587x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs588x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle"> over the life-cycle, but provides a quantitative estimate of
what would happen to our estimates of these parameters under the alternative assumption
that the data is mismeasured in some way.
<!--l. 317--><p class="indent" >  <a 
 id="PlotSensitivityMeasure"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-4000819"></a>
                                                                                     
                                                                                     
<!--l. 319--><p class="noindent" > <img 
src="./Figures/Sensitivity-.svg" alt="PIC"  
style="width:96.76%">
<figcaption class="caption" ><span class="id">Figure¬†19:  </span><span  
class="content">Sensitivty  of  Estimates  <img 
src="SolvingMicroDSOPs589x.svg" alt="</span></span></span></span>{œÅ, ‚Ñ∂} " class="math";align="absmiddle"> regarding  Alternative  Mismeasurement
Assumptions.</span></figcaption><!--tex4ht:label?: x1-4000819 -->                                                                          {Ô¨Åg:PlotSensitivityMeasure}
                                                                                     
                                                                                     
  </div>
<!--l. 324--><p class="indent" >  By setting the positional argument make_contour_plot to true, Figure <a 
href="#x1-4000920">20<!--tex4ht:ref: fig:PlotContourMedianStrEst --></a> shows the
contour plot of the smmObjectiveFxn function and the parameter estimates. The contour plot
shows equally spaced isoquants of the smmObjectiveFxn function, i.e.¬†the pairs of <img 
src="SolvingMicroDSOPs590x.svg" alt="</span>œÅ  " class="math";align="absmiddle"> and <img 
src="SolvingMicroDSOPs591x.svg" alt="</span>‚Ñ∂  " class="math";align="absmiddle">
which lead to the same deviations between simulated and empirical medians (equivalent
values of equation (<a 
href="#x1-38005r61">61<!--tex4ht:ref: eq:StructEstim --></a>)). Interestingly, there is a large rather Ô¨Çat region; or, more
formally speaking, there exists a broad set of parameter pairs which leads to similar
simulated wealth to income ratios. Intuitively, the Ô¨Çatter and larger is this region,
the harder it is for the structural estimation procedure to precisely identify the
parameters.
<!--l. 327--><p class="indent" >  <a 
 id="PlotContourMedianStrEst"></a> <div class="figure" 
>
                                                                                     
                                                                                     
<a 
 id="x1-4000920"></a>
                                                                                     
                                                                                     
<!--l. 329--><p class="noindent" > <img 
src="./Figures/SMMcontour-.svg" alt="PIC"  
style="width:96.76%">
<figcaption class="caption" ><span class="id">Figure¬†20: </span><span  
class="content">Contour Plot (larger values are shown lighter) with <img 
src="SolvingMicroDSOPs592x.svg" alt="</span></span></span></span>{œÅ,‚Ñ∂ } " class="math";align="absmiddle"> Estimates (red
dot).</span></figcaption><!--tex4ht:label?: x1-4000920 -->                                                                                   {Ô¨Åg:PlotContourMedianStrEst}
                                                                                     
                                                                                     
  </div>
<!--l. 5--><p class="indent" >  <a 
 id="conclusion"></a>
  <h3 class="sectionHead"><span class="titlemark">10  </span> <a 
 id="x1-4100010"></a>Conclusion</h3>
<!--l. 8--><p class="noindent" >Many choices can be made for solving microeconomic dynamic stochastic optimization
problems. The set of techniques, and associated code, described in these notes represents an
approach that I have found to be powerful, Ô¨Çexible, and eÔ¨Écient, but other problems may
require other techniques. For a much broader treatment of many of the issues considered here,
see Judd¬†(<a 
href="#Xjudd:book">1998</a>).
                                                                                     
                                                                                     
  <div  
class="centerline">                                             Appendices                            </div>
<!--l. 6--><p class="indent" >  <a 
 id="scf-data"></a>
  <h3 class="sectionHead"><span class="titlemark">A  </span> <a 
 id="x1-42000A"></a>SCF Data</h3>                                                                        {app:scf-data}
<!--l. 9--><p class="noindent" >Data used in the estimation is constructed using the SCF 1992, 1995, 1998,
2001 and 2004 waves. The deÔ¨Ånition of wealth is net worth including housing
wealth, but excluding pensions and social securities. The data set contains
only households whose heads are aged 26-60 and excludes singles, following
Cagetti¬†(<a 
href="#XcagettiWprofiles">2003</a>).<span class="footnote-mark"><a 
href="SolvingMicroDSOPs25.html#fn24x0"><sup class="textsuperscript"><span 
class="ecrm-0600">24</span></sup></a></span><a 
 id="x1-42001f24"></a>  
Furthermore, the data set contains only households whose heads are college graduates. The
total sample size is 4,774.
<!--l. 11--><p class="indent" >  In the waves between 1995 and 2004 of the SCF, levels of normal income are reported. The
question in the questionnaire is &#x0022;About what would your income have been if it had been a
normal year?&#x0022; We consider the level of normal income as corresponding to the model‚Äôs
theoretical object <img 
src="SolvingMicroDSOPs593x.svg" alt="</span>P  " class="math";align="absmiddle">, permanent noncapital income. Levels of normal income are not
reported in the 1992 wave. Instead, in this wave there is a variable which reports whether
the level of income is normal or not. Regarding the 1992 wave, only observations
which report that the level of income is normal are used, and the levels of income of
remaining observations in the 1992 wave are interpreted as the levels of permanent
income.
<!--l. 13--><p class="indent" >  Normal income levels in the SCF are before-tax Ô¨Ågures. These before-tax permanent income
Ô¨Ågures must be rescaled so that the median of the rescaled permanent income of each age
group matches the median of each age group‚Äôs income which is assumed in the simulation.
This rescaled permanent income is interpreted as after-tax permanent income. Rescaling is
crucial since in the estimation empirical proÔ¨Åles are matched with simulated ones which are
generated using after-tax permanent income (remember the income process assumed in the
main text). Wealth / permanent income ratio is computed by dividing the level of
wealth by the level of (after-tax) permanent income, and this ratio is used for the
estimation.<span class="footnote-mark"><a 
href="SolvingMicroDSOPs26.html#fn25x0"><sup class="textsuperscript"><span 
class="ecrm-0600">25</span></sup></a></span><a 
 id="x1-42003f25"></a>  
                                                                                     
                                                                                     
  <h3 class="likesectionHead"><a 
 id="x1-43000"></a>References</h3>
<!--l. 6--><p class="noindent" >
  <div class="thebibliography">
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xandrews2017measuring"></a><span class="bibsp">¬†¬†¬†</span></span>Andrews,  Isaiah,  Matthew  Gentzkow,  and  Jesse¬†M  Shapiro  (2017):
  ‚ÄúMeasuring  the  sensitivity  of  parameter  estimates  to  estimation  moments,‚Äù  The
  Quarterly Journal of Economics, 132(4), 1553‚Äì1592.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XAttanasioBanksMeghirWeber"></a><span class="bibsp">¬†¬†¬†</span></span>Attanasio, O.P., J.¬†Banks, C.¬†Meghir, and G.¬†Weber (1999): ‚ÄúHumps and
  Bumps in Lifetime Consumption,‚Äù Journal of Business and Economic Statistics, 17(1),
  22‚Äì35.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XcagettiWprofiles"></a><span class="bibsp">¬†¬†¬†</span></span>Cagetti,  Marco  (2003):  ‚ÄúWealth  Accumulation  Over  the  Life  Cycle  and
  Precautionary Savings,‚Äù Journal of Business and Economic Statistics, 21(3), 339‚Äì353.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xcarroll:brookings"></a><span class="bibsp">¬†¬†¬†</span></span>Carroll, Christopher¬†D. (1992): ‚ÄúThe BuÔ¨Äer-Stock Theory of Saving: Some
  Macroeconomic Evidence,‚Äù Brookings Papers on Economic Activity, 1992(2), 61‚Äì156,
  <a 
href="https://www.econ2.jhu.edu/people/ccarroll/BufferStockBPEA.pdf" class="url" >https://www.econ2.jhu.edu/people/ccarroll/BufferStockBPEA.pdf</a>.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XcarrollBSLCPIH"></a><span class="bibsp">¬†¬†¬†</span></span>__________¬†  (1997):  ‚ÄúBuÔ¨Äer  Stock  Saving  and  the  Life  Cycle/Permanent  Income
  Hypothesis,‚Äù Quarterly Journal of Economics, CXII(1), 1‚Äì56.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xcarroll:richportfolios"></a><span class="bibsp">¬†¬†¬†</span></span>__________¬†                                  (2002):                                      ‚ÄúPortfolios
  of the Rich,‚Äù in Household Portfolios: Theory and Evidence. MIT Press, Cambridge,
  MA, <a 
href="https://www.econ2.jhu.edu/people/ccarroll/richportfolios.pdf" class="url" >https://www.econ2.jhu.edu/people/ccarroll/richportfolios.pdf</a>.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XcarrollEGM"></a><span class="bibsp">¬†¬†¬†</span></span>__________¬†   (2006):   ‚ÄúThe   Method   of   Endogenous   Gridpoints   for   Solving
  Dynamic  Stochastic  Optimization  Problems,‚Äù  Economics  Letters,  91(3),  312‚Äì320,
  <a 
href="https://www.econ2.jhu.edu/people/ccarroll/EndogenousGridpoints.pdf" class="url" >https://www.econ2.jhu.edu/people/ccarroll/EndogenousGridpoints.pdf</a>.
  </p>
                                                                                     
                                                                                     
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XSolvingMicroDSOPs"></a><span class="bibsp">¬†¬†¬†</span></span>__________¬†  (2023a):  ‚ÄúSolving  Microeconomic  Dynamic  Stochastic  Optimization
  Problems,‚Äù Econ-ARK REMARK.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XBufferStockTheory"></a><span class="bibsp">¬†¬†¬†</span></span>__________¬† (2023b):  ‚ÄúTheoretical  Foundations  of  BuÔ¨Äer  Stock  Saving,‚Äù  Revise and
  Resubmit, Quantitative Economics.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XckConcavity"></a><span class="bibsp">¬†¬†¬†</span></span>Carroll,               Christopher¬†D.,               and               Miles¬†S.
  Kimball (1996): ‚ÄúOn the Concavity of the Consumption Function,‚Äù Econometrica,
  64(4), 981‚Äì992, <a 
href="https://www.econ2.jhu.edu/people/ccarroll/concavity.pdf" class="url" >https://www.econ2.jhu.edu/people/ccarroll/concavity.pdf</a>.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xcarroll&samwick:nature"></a><span class="bibsp">¬†¬†¬†</span></span>Carroll, Christopher¬†D., and Andrew¬†A. Samwick (1997): ‚ÄúThe Nature
  of Precautionary Wealth,‚Äù Journal of Monetary Economics, 40(1), 41‚Äì71.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XdeatonLiqConstr"></a><span class="bibsp">¬†¬†¬†</span></span>Deaton, Angus¬†S. (1991): ‚ÄúSaving and Liquidity Constraints,‚Äù Econometrica, 59,
  1221‚Äì1248, <a 
href="https://www.jstor.org/stable/2938366" class="url" >https://www.jstor.org/stable/2938366</a>.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XdeatonUnderstandingC"></a><span class="bibsp">¬†¬†¬†</span></span>__________¬† (1992): Understanding Consumption. Oxford University Press, New York.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XdenHaanMarcet:parameterized"></a><span class="bibsp">¬†¬†¬†</span></span>den                      Haan,                      Wouter¬†J,                      and
  Albert Marcet (1990): ‚ÄúSolving the Stochastic Growth Model by Parameterizing
  Expectations,‚Äù Journal of Business and Economic Statistics, 8(1), 31‚Äì34, Available at
  <a 
href="http://ideas.repec.org/a/bes/jnlbes/v8y1990i1p31-34.html" class="url" >http://ideas.repec.org/a/bes/jnlbes/v8y1990i1p31-34.html</a>.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XgpLifecycle"></a><span class="bibsp">¬†¬†¬†</span></span>Gourinchas, Pierre-Olivier, and Jonathan Parker (2002): ‚ÄúConsumption
  Over the Life Cycle,‚Äù Econometrica, 70(1), 47‚Äì89.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XhorowitzBootstrap"></a><span class="bibsp">¬†¬†¬†</span></span>Horowitz, Joel¬†L. (2001): ‚ÄúThe Bootstrap,‚Äù in Handbook of Econometrics, ed. by
  James¬†J. Heckman, and Edward Leamer, vol.¬†5. Elsevier/North Holland.
                                                                                     
                                                                                     
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xjudd:book"></a><span class="bibsp">¬†¬†¬†</span></span>Judd, Kenneth¬†L. (1998): Numerical Methods in Economics. The MIT Press,
  Cambridge, Massachusetts.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xkopecky2010finite"></a><span class="bibsp">¬†¬†¬†</span></span>Kopecky,   Karen¬†A.,   and   Richard¬†M.H.   Suen  (2010):   ‚ÄúFinite   State
  Markov-Chain Approximations To Highly Persistent Processes,‚Äù Review of Economic
  Dynamics, 13(3), 701‚Äì714, <a 
href="http://www.karenkopecky.net/RouwenhorstPaper.pdf" class="url" >http://www.karenkopecky.net/RouwenhorstPaper.pdf</a>.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xmerton:restat"></a><span class="bibsp">¬†¬†¬†</span></span>Merton, Robert¬†C. (1969): ‚ÄúLifetime Portfolio Selection under Uncertainty: The
  Continuous Time Case,‚Äù Review of Economics and Statistics, 51, 247‚Äì257.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xpalumbo:medical"></a><span class="bibsp">¬†¬†¬†</span></span>Palumbo, Michael¬†G (1999): ‚ÄúUncertain Medical Expenses and Precautionary
  Saving Near the End of the Life Cycle,‚Äù Review of Economic Studies, 66(2), 395‚Äì421,
  Available at <a 
href="http://ideas.repec.org/a/bla/restud/v66y1999i2p395-421.html" class="url" >http://ideas.repec.org/a/bla/restud/v66y1999i2p395-421.html</a>.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="Xsamuelson:portfolio"></a><span class="bibsp">¬†¬†¬†</span></span>Samuelson, Paul¬†A. (1969): ‚ÄúLifetime Portfolio Selection by Dynamic Stochastic
  Programming,‚Äù Review of Economics and Statistics, 51, 239‚Äì46.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XTanaka2013-bc"></a><span class="bibsp">¬†¬†¬†</span></span>Tanaka,    Ken‚Äôichiro,    and    Alexis¬†Akira    Toda   (2013):    ‚ÄúDiscrete
  approximations of continuous distributions by maximum entropy,‚Äù Economics letters,
  118(3), 445‚Äì450.
  </p>
  <p class="bibitem" ><span class="biblabel">
<a 
 id="XzeldesStochastic"></a><span class="bibsp">¬†¬†¬†</span></span>Zeldes,  Stephen¬†P.  (1989):  ‚ÄúOptimal  Consumption  with  Stochastic  Income:
  Deviations  from  Certainty  Equivalence,‚Äù  Quarterly Journal of Economics,  104(2),
  275‚Äì298.
</p>
  </div>
   
</body> 
</html>
                                                                                     


